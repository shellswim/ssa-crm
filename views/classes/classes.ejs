<!-- Wappler include head-page="layouts/layout2" is="dmx-app" id="classes" appconnect="local" fontawesome_5="cdn" components="{dmxBootstrap4Modal:{},dmxValidator:{},dmxFormatter:{},dmxBootbox:{},dmxDataTraversal:{},dmxBootstrap4PagingGenerator:{},dmxBootstrap4Alert:{},dmxBootstrap4TableGenerator:{},dmxBootstrap4Collapse:{},dmxStateManagement:{},dmxPreloader:{},dmxBootstrap4Tooltips:{},dmxAnimateCSS:{},dmxDatePicker:{},dmxBootstrap4Navigation:{},dmxBootstrap5Navigation:{},dmxBootstrap5Collapse:{},dmxBootstrap5Modal:{},dmxBootstrap5PagingGenerator:{},dmxBootstrap5TableGenerator:{},dmxSockets:{}}" jquery_35="cdn" moment_2="cdn with locales" bootstrap5="local" bootstrap_icons="cdn" -->
<dmx-socket id="sock_classesBaseRefresh" namespace="classes"></dmx-socket>
<dmx-local-manager id="classEnrolHolding"></dmx-local-manager>

<dmx-datetime id="dateAndTime_days" interval="days"></dmx-datetime>



<dmx-query-manager id="classesQuery"></dmx-query-manager>
<dmx-serverconnect id="checkClassTimeslot" noload url="/api/classes/checkClassTimeslot"></dmx-serverconnect>
<dmx-serverconnect id="classesBase" url="/api/classes/classesBase" dmx-param:sort="classesQuery.data.sort" dmx-param:dir="classesQuery.data.dir" dmx-param:offset="classesQuery.data.offset" dmx-param:limit="classesQuery.data.limit" dmx-param:days="ss_ClassFilters.data.dayGet" dmx-param:times="ss_ClassFilters.data.timeGet" dmx-param:levels="ss_ClassFilters.data.levelGet" dmx-param:instructors="ss_ClassFilters.data.instructorGet" dmx-on:done="run({condition:{if:`browser1.location.pathname.contains(\'classes\')`,then:{steps:[{condition:{if:`ss_ClassFilters.data.dayGet.length > 0`,then:{steps:{run:{action:`classesQuery.set(\'days\', ss_ClassFilters.data.dayGet)`}}}}},{condition:{if:`ss_ClassFilters.data.timeGet.length > 0`,then:{steps:{run:{action:`classesQuery.set(\'times\', ss_ClassFilters.data.timeGet)`}}}}},{condition:{if:`ss_ClassFilters.data.levelGet.length > 0`,then:{steps:{run:{action:`classesQuery.set(\'levels\', ss_ClassFilters.data.levelGet)`}}}}},{condition:{if:`ss_ClassFilters.data.instructorGet.length > 0`,then:{steps:{run:{action:`classesQuery.set(\'instructors\', ss_ClassFilters.data.instructorGet)`}}}}}]}}})">
</dmx-serverconnect>
<dmx-serverconnect id="getInstructors" url="/api/staff/getInstructors"></dmx-serverconnect>


<dmx-serverconnect id="getEnrolmentSingle" url="/api/classes/getEnrolmentSingle"></dmx-serverconnect>
<dmx-serverconnect id="searchClasses" url="/api/classes/searchClasses" noload dmx-param:offset=""></dmx-serverconnect>
<dmx-serverconnect id="classHumanDetailsGlobal" url="/api/classes/getClassHumanDetails_SINGLE" noload=""></dmx-serverconnect>

<dmx-serverconnect id="getClassDetails" url="/api/classes/getClassDetails" noload></dmx-serverconnect>
<div class="modal fade" id="enrolmentSearchModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header text-white bg-primary">
                <h5 class="modal-title">Create Enrolment
                </h5>

            </div>
            <div class="modal-body">

                <dmx-data-detail id="dd_classdetails_searchenrol" dmx-bind:data="classesBase.data.rp_enrols" key="id">
                    <dmx-value id="var_enroltype" dmx-bind:value="'standard'"></dmx-value>
                </dmx-data-detail>
                <p class="mb-0" dmx-html="'<i class=&quot;bi-arrow-return-right me-2&quot;></i>'+dd_classdetails_searchenrol.data.day_name+' - '+dd_classdetails_searchenrol.data.startTimeDisplay+' '+appSettings.classLevelsByID[dd_classdetails_searchenrol.data.classLevel].name+' - '+appSettings.instructorsById[dd_classdetails_searchenrol.data.instructorid].trunc_name"><i class="bi-arrow-return-right me-2"></i>Class
                    Details
                </p>
                <section class="pb-4">
                    <div class="d-flex flex-column justify-content-start">
                        <label for="inp_searchModal" class="col-form-label">Search</label>
                        <input id="inp_searchModal" name="inp_searchModal" type="text" class="form-control form-control" style="font-size: 0.9rem;" dmx-bind:value="var_fulltextConvert.value" dmx-on:updated="run([{runJS:{function:'fulltextConvert',args:[`value`],name:'fullTextConvert'}},{run:{action:`queryManager.set(\'searchtextfilter\',fullTextConvert);searchAll_ResultsModal.var_fulltextConvert.setValue(value)`}},{wait:{delay:200}},{run:{action:`getAllStudentsAndFamilies.load({searchtextfilter: query.searchtextfilter})`}}])" autocomplete="off">
                        <p class="mb-0 form-text">Start searching for families and students to show below.</p>
                    </div>

                </section>
                <section>
                    <div class="row row-cols-1 gx-0" id="rp_families" is="dmx-repeat" dmx-bind:repeat="getAllStudentsAndFamilies.data.studentsAndFamilies" key="family">
                        <div class="col mb-3">
                            <div class="row gx-0" dmx-animate-enter.duration:500="fadeInUp" dmx-animate-leave.duration:300="fadeOut">

                                <div class="col p-3 border rounded-3">
                                    <div class="row">

                                        <div class="col-auto"><a href="#" class="btn mx-1 btn-outline-light text-body border-2"><i class="bi-people fs-4"></i></a></div>
                                        <div class="col d-flex flex-column align-items-start justify-content-center">
                                            <h5 class="fw-light mb-0">{{primaryGuardian.firstName+' '+primaryGuardian.lastName}}<br></h5>
                                            <p class="fw-light mb-0 mt-1 small text-muted" style="">{{guardians.values(`' ' + firstName +' '+lastName`)}}</p>



                                        </div>

                                    </div>
                                    <div class="row pt-2 mt-2 border-top">
                                        <div class="col">
                                            <table class="table small align-middle">
                                                <thead class="fw-bold border-bottom">
                                                    <tr>
                                                        <th scope="row" class="collapse-cell"></th>
                                                        <th>Student</th>
                                                        <th>Level</th>
                                                        <th>Gender</th>
                                                        <th>Dob</th>
                                                        <th>Age</th>
                                                    </tr>
                                                </thead>
                                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="students" id="tb_es_repeatStudents">
                                                    <tr>
                                                        <td class="collapse-cell">
                                                            <button id="addEnrolment" class="btn btn-sm btn-outline-secondary me-2" dmx-on:click="run([{run:{action:`enrolmentSearchModal.hide()`}},{run:{action:`newEnrolmentModal.show()`}},{run:{action:`newEnrolmentModal.var_studentDetailsObject.setValue({\'id\': id, \'firstName\': firstName, \'lastName\': lastName, \'fullName\': firstName + \' \' + lastName, \'level\': level});classEnrolHolding.set(\'class\',enrolmentSearchModal.dd_classdetails_searchenrol.data);classEnrolHolding.set(\'student\',$value)`}}])" dmx-show="dd_classdetails_searchenrol.var_enroltype.value === 'standard'"><i class="bi-person-plus-fill fs-6"></i>
                                                            </button>
                                                            <button id="addWaitlist" class="btn btn-sm me-2 btn-outline-dark" dmx-show="dd_classdetails_searchenrol.var_enroltype.value === 'waitlist'"><i class="bi-clock-history fs-6"></i>
                                                            </button>
                                                        </td>
                                                        <td dmx-text="firstName +' '+lastName">Jane Doe</td>
                                                        <td dmx-text="level">Ducklings</td>
                                                        <td dmx-text="gender">Female</td>
                                                        <td dmx-text="dob.formatDate('dd-MM-yyyy')">13-12-2019</td>
                                                        <td dmx-text="age">1y 11m</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>



                                </div>
                            </div>
                        </div>

                    </div>
                </section>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal" dmx-on:click="inp_searchModal.setValue(null)">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" is="dmx-bs5-modal" tabindex="-1" role="dialog" id="newEnrolmentModal" nocloseonclick="true" dmx-on:hidden-bs-modal="classEnrolHolding.remove('class');classEnrolHolding.remove('student')">
    <dmx-value id="var_studentDetailsObject"></dmx-value>
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" dmx-text="'Enrol: '+classEnrolHolding.data.student.firstName+' '+classEnrolHolding.data.student.lastName">Enrol: Jane Doe<br>
                </h5>
                <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="mb-0" dmx-text="classEnrolHolding.data.class.day_name+' - '+classEnrolHolding.data.class.startTimeDisplay+' '+appSettings.classLevelsByID[classEnrolHolding.data.class.classLevel].name+' - '+appSettings.instructorsById[instructorid].trunc_name">Class Details</p>
                <form is="dmx-serverconnect-form" id="createEnrolmentForm" method="post" action="/api/classes/createEnrolment" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-param:isvalid="1" dmx-on:success="run([{run:{action:`notifies1.success(var_studentDetailsObject.value.getValueOrKey(\'fullName\')+\' enroled successfully to - \'+classHumanDetailsGlobal.data.classHumanDetails.day+\' \'+classHumanDetailsGlobal.data.classHumanDetails.level+\' - with \'+classHumanDetailsGlobal.data.classHumanDetails.instructor)`}},{run:{action:`createEnrolmentForm.reset()`}},{run:{action:`newEnrolmentModal.hide()`}},{run:{action:`classesBase.load({days: classesQuery.data.days, times: classesQuery.data.times},true)`}},{run:{action:`enrolmentSearchModal.inp_searchModal.setValue(null);queryManager.remove(\'searchtextfilter\')`}}])">
                    <input type="hidden" class="form-control" id="inp_classId" name="classId" aria-describedby="inp_classId_help" placeholder="Enter Class" dmx-bind:value="classEnrolHolding.data.class.id">
                    <input type="hidden" class="form-control" id="inp_student" name="student" aria-describedby="inp_student_help" placeholder="Enter Student" dmx-bind:value="classEnrolHolding.data.student.id">
                    <div class="row gx-3">
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_startDate" class="col-form-label form-label">Start date:</label>
                                <input type="date" class="form-control" id="inp_startDate" name="startDate" aria-describedby="inp_startDate_help" placeholder="Enter Start date" dmx-bind:value="dateAndTime_days.datetime.formatDate('yyyy-MM-dd')">
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_dropDate" class="col-form-label form-label">Drop date</label>
                                <input type="date" class="form-control" id="inp_dropDate" name="dropDate" aria-describedby="inp_dropDate_help" placeholder="Enter Drop date">
                            </div>
                        </div>
                    </div>
                    <div class="row gx-3">
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_enrolmentType" class="col-form-label form-label">Enrolment type</label>
                                <select id="sel_enrolmentType" class="form-select" name="enrolmentType" dmx-bind:options="classesBase.data.enrolmentTypes.where('id', 4, '!==')" optiontext="type" optionvalue="id" dmx-bind:value="1"></select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" dmx-on:click="run([{run:{action:`newEnrolmentModal.hide()`}},{wait:{delay:200}},{run:{action:`enrolmentSearchModal.show()`}}])" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="createEnrolmentForm" class="btn btn-primary">Create Enrolment</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="createClassModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="createClassForm.reset()">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header align-items-center bg-primary text-light">
                <h5 class="modal-title">Create New Class</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">


                <form id="createClassForm" is="dmx-serverconnect-form" method="post" action="/api/classes/createClass" dmx-on:success="classesBase.load();createClassModal.hide()">



                    <div class="row">
                        <div class="col">
                            <h5 class="text-uppercase mb-2 pb-2 border-bottom">Schedule</h5>
                        </div>
                    </div>

                    <fieldset dmx-bind:disabled="ncm_timeslotError.collapsed ? false : true">
                        <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">


                            <dmx-value id="var_selectedTimeDecimal"></dmx-value>
                            <dmx-value class="d-none" id="var_classDurationSum" dmx-bind:value="(ncm_startTimeSelect.value.toNumber() + ncm_durationSelect.value.toNumber())" dmx-on:updated="startEndTimeCalc.run()"></dmx-value>
                            <dmx-value id="var_startTimeDisplay" dmx-on:updated="hd_inputClassStartDisplay.setValue(value)"></dmx-value>
                            <dmx-value id="var_endTimeDisplay"></dmx-value>
                            <script is="dmx-flow" id="startEndTimeCalc" type="text/dmx-flow">
                                {
                                condition: {
                                    if: "{{ncm_startTimeSelect.value !== \"\" && ncm_durationSelect.value !== \"\"}}",
                                    then: {
                                    steps: {
                                        runJS: {
                                            function: "decimalToTime",
                                            args: ["{{var_classDurationSum.value}}"],
                                            name: "endTimeCalc",
                                            output: true
                                        }
                                    }
                                    }
                                }
                            }
                        </script>
                            <script is="dmx-flow" id="timeToDisplay" type="text/dmx-flow" dmx-on:done="run({run:{action:`var_startTimeDisplay.setValue(timeToDisplay.data.displayTime)`}})">
                                {
                                runJS: {
                                    function: "selectedTimeToDisplay",
                                    args: ["{{var_selectedTimeDecimal.value}}"],
                                    name: "displayTime",
                                    output: true
                                }
                            }
                        </script>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="ncm_daySelect" class="col-form-label form-label">Day</label>
                                    <select id="ncm_daySelect" class="form-select" dmx-bind:options="classesBase.data.days.days" optiontext="name" optionvalue="id">
                                        <option selected="" value="" disabled="">Select Day</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="ncm_startTimeSelect" class="col-form-label form-label">Start Time:</label>
                                    <select id="ncm_startTimeSelect" class="form-select" dmx-bind:options="appSettings.ct_array" optiontext="display" optionvalue="decimal" dmx-on:changed="var_selectedTimeDecimal.setValue(value);timeToDisplay.run()">
                                        <option selected="" value="">Select Start Time</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="ncm_durationSelect" class="col-form-label form-label">Duration</label>
                                    <select id="ncm_durationSelect" class="form-select" dmx-bind:options="appSettings.duration_array" optiontext="display" optionvalue="value">
                                        <option selected="" value="">Select Class Duration</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">

                                <div class="mb-3">
                                    <label for="ncm_endTimeInput" class="col-form-label form-label">End Time:</label>
                                    <input type="text" class="form-control" id="ncm_endTimeInput" aria-describedby="input1_help" disabled="true" dmx-bind:value="startEndTimeCalc.data.endTimeCalc">
                                    <small id="bs4-form-group-help8" class="form-text text-muted">Calculated from class start and duration.</small>
                                </div>
                            </div>
                        </div>

                        <hr>
                        <div class="row">
                            <div class="col">
                                <h5 class="text-uppercase mb-2 pb-2 border-bottom">Class Details</h5>
                            </div>
                        </div>

                        <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">


                            <div class="col">
                                <div class="mb-3">
                                    <label for="ncm_daySelect" class="col-form-label form-label">Instructor</label>
                                    <select id="ncm_instructorSelect" class="form-select" dmx-bind:value="getInstructors.data.getInstructors" required="" dmx-bind:options="getInstructors.data.getInstructors.sort(firstName)" optionvalue="id" optiontext="firstName+' '+lastName.trunc(1, true, '.')">
                                        <option selected="" value="">Select Instructor</option>
                                    </select>
                                </div>

                            </div>



                        </div>
                        <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="ncm_daySelect" class="col-form-label form-label">Class Level</label>
                                    <select id="ncm_classLevelSelect" class="form-select" required="" dmx-bind:options="getLevels.data.query" optiontext="name " optionvalue="id" dmx-on:updated="run([{runJS:{function:'getSelectText',args:['#ncm_classLevelSelect'],name:'getSelectText'}},{run:{action:`createClassModal.createClassForm.inp_hd_classType.setValue(appSettings.classLevels[getSelectText].classType);createClassModal.createClassForm.var_classTypeName.setValue(appSettings.classLevels[getSelectText].classType_longName)`}}])">
                                        <option selected="" value="">Select Level</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3 mb-0">
                                    <label for="classType" class="col-form-label form-label">Class Type</label>
                                    <input type="text" class="form-control" id="classType" name="classTypeLongName" aria-describedby="input1_help" readonly="true" dmx-bind:value="var_classTypeName.value" disabled="true">
                                    <small id="bs4-form-group-help7" class="form-text text-muted">Auto-updated after class level selected.</small>

                                </div>
                                <dmx-value id="var_classTypeName"></dmx-value>

                            </div>
                        </div>
                        <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="inp_max" class="col-form-label form-label">Max Students</label>
                                    <input type="text" class="form-control" id="inp_max" name="max" aria-describedby="input1_help" placeholder="E.g. 1" required="" data-rule-number="" data-msg-number="Numbers only.">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <div class="row" id="r_timeslotCheckError">
                        <div class="col">
                            <input id="inp_hd_classType" name="classType" class="form-control" type="hidden"><input id="hd_inputClassDay" name="day" type="hidden" class="form-control" dmx-bind:value="ncm_daySelect.value">
                            <input id="hd_inputClassStart" name="startTimeDecimal" type="hidden" class="form-control" dmx-bind:value="ncm_startTimeSelect.value">
                            <input id="hd_inputClassEnd" name="endTimeDecimal" type="hidden" class="form-control" dmx-bind:value="var_classDurationSum.value">
                            <input id="hd_inputClassStartDisplay" name="startTimeDisplay" type="hidden" class="form-control" dmx-bind:value="var_startTimeDisplay.value">
                            <input id="hd_inputClassEndDisplay" name="endTimeDisplay" type="hidden" class="form-control" dmx-bind:value="ncm_endTimeInput.value">
                            <input id="hd_inputInstructor" name="instructor" type="hidden" class="form-control" dmx-bind:value="ncm_instructorSelect.value">
                            <input id="hd_inputLevel" name="classLevel" type="hidden" class="form-control" dmx-bind:value="ncm_classLevelSelect.value">
                        </div>
                    </div>

                </form>

                <div class="collapse" id="ncm_timeslotError" is="dmx-bs5-collapse" dmx-bind:show="checkClassTimeslot.data.classTSAvailability > 0">
                    <hr>
                    <div class="d-flex align-items-stretch flex-column">
                        <div class="card text-white bg-danger">

                            <div class="card-header">
                                <h5 class="mb-0">{{checkClassTimeslot.data.classTSAvailability[0].instructorName}} already has classes at this time.</h5>
                            </div>
                            <div class="card-body bg-light">
                                <div class="d-flex">
                                    <div class="table-responsive">
                                        <table class="table table-sm mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Id</th>
                                                    <th>Day</th>
                                                    <th>Level</th>
                                                    <th>Start</th>
                                                    <th>End</th>
                                                    <th>Instructor</th>
                                                </tr>
                                            </thead>
                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="checkClassTimeslot.data.classTSAvailability" id="tableRepeat2">
                                                <tr>
                                                    <td dmx-text="id"></td>
                                                    <td dmx-text="dayName"></td>
                                                    <td dmx-text="levelName"></td>
                                                    <td dmx-text="startTimeDisplay"></td>
                                                    <td dmx-text="endTimeDisplay"></td>
                                                    <td dmx-text="instructorName"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">

                                    <button id="changeClassDetailsBtn" class="btn btn-outline-light" dmx-on:click="run([{run:{action:`createClassModal.ncm_timeslotError.hide()`}},{wait:{delay:300}},{run:{action:`checkClassTimeslot.reset()`}}])"><i class="fas fa-undo-alt  fa-fw me-1"></i>Change</button><button id="submitFormAnywayBtn" class="btn btn-outline-light"><i class="fas fa-plus-circle fa-fw me-1"></i>Create Anyway
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <p></p>
            <div class="modal-footer">
                <fieldset dmx-bind:disabled="ncm_timeslotError.collapsed ? false : true">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>

                    <button class="btn btn-primary" dmx-on:click="run({condition:{if:`content.createClassModal.ncm_timeslotError.collapsed`,then:{steps:[{run:{action:`checkClassTimeslot.load({instructor: createClassForm.hd_inputInstructor.value, day: createClassForm.hd_inputClassDay.value, starttimedecimal: createClassForm.hd_inputClassStart.value, endtimedecimal: createClassForm.hd_inputClassEnd.value, classid: \'\', isactive: \'1\'})`}},{wait:{delay:200}},{condition:{if:`content.checkClassTimeslot.data.classTSAvailability.length > 0`,then:{steps:{run:{action:`createClassModal.ncm_timeslotError.show()`}}},else:{steps:{run:{action:`createClassModal.createClassForm.submit()`}}}}}]},else:{steps:{run:{action:`createClassModal.createClassForm.submit()`}}}}})">Create
                        Class</button>
                </fieldset>
            </div>
        </div>
    </div>
</div>
<div class="modal fade draggable-modal" id="editClassModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:show-bs-modal="run([{run:{action:`editClassForm.ec_startEndTimeCalc.run()`}},{run:{action:`editClassForm.ec_timeToDisplay.run()`}},{runJS:{function:'addDraggable',args:['open']}}])" dmx-on:hidden-bs-modal="run([{run:{action:`checkClassTimeslot.reset()`}},{run:{action:`editClassForm.reset()`}},{run:{action:`getClassDetails.reset()`}},{runJS:{function:'addDraggable',args:['close']}}])">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header align-items-center bg-secondary text-white">
                <dmx-value id="ec_var_classTitle"></dmx-value>
                <h5 class="modal-title text-start" dmx-text="'Edit Class: '+dd_editClass.data.day_name+' - '+dd_editClass.data.startTimeDisplay+' '+appSettings.classLevelsByID[dd_editClass.data.classLevel].name+' - ' + appSettings.instructorsById[dd_editClass.data.instructorid].trunc_name">Edit Class: Monday - 10 AM Duckling - Ron S.</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <dmx-data-detail id="dd_editClass" dmx-bind:data="classesBase.data.rp_enrols" key="id">
                    <form id="editClassForm" is="dmx-serverconnect-form" method="post" action="/api/classes/updateClass" dmx-on:success="editClassModal.hide();classesBase.load({sort: classesQuery.data.sort, dir: classesQuery.data.dir, offset: classesQuery.data.offset, limit: classesQuery.data.limit, days: classesQuery.data.days, times: classesQuery.data.times, levels: classesQuery.data.levels, instructors: classesQuery.data.instructors})" dmx-param:classid="getClassDetails.data.getClassDetails.id">
                        <fieldset dmx-bind:disabled="ecm_timeslotError.collapsed ? false : true">

                            <div class="row">
                                <div class="col">
                                    <h5 class="text-uppercase">Schedule</h5>
                                </div>
                            </div>

                            <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">



                                <dmx-value id="ec_var_selectedTimeDecimal"></dmx-value>
                                <dmx-value class="d-none" id="ec_var_classDurationSum" dmx-bind:value="(ecm_startTimeSelect.value.toNumber() + ecm_durationSelect.value.toNumber())" dmx-on:updated="ec_startEndTimeCalc.run()"></dmx-value>
                                <dmx-value id="ec_var_startTimeDisplay" dmx-on:updated="ec_hd_inputClassStartDisplay.setValue(value)"></dmx-value>
                                <dmx-value id="ec_var_endTimeDisplay"></dmx-value>
                                <script is="dmx-flow" id="ec_startEndTimeCalc" type="text/dmx-flow" dmx-on:done="ecm_endTimeInput.setValue(ec_startEndTimeCalc.data.endTimeCalc)">
                                    {
                                    condition: {
                                        if: "{{ecm_startTimeSelect.value !== \"\" && ecm_durationSelect.value !== \"\"}}",
                                        then: {
                                        steps: {
                                            runJS: {
                                                function: "decimalToTime",
                                                args: ["{{ec_var_classDurationSum.value}}"],
                                                name: "endTimeCalc",
                                                output: true
                                            }
                                        }
                                        }
                                    }
                                }
                            </script>
                                <script is="dmx-flow" id="ec_timeToDisplay" type="text/dmx-flow" dmx-on:done="run({run:{action:`ec_var_startTimeDisplay.setValue(ec_timeToDisplay.data.displayTime);editClassModal.editClassForm.ec_var_startTimeDisplay.setValue(ec_timeToDisplay.data.displayTime)`}})">
                                    {
                                    runJS: {
                                        function: "selectedTimeToDisplay",
                                        args: ["{{ec_var_selectedTimeDecimal.value}}"],
                                        name: "displayTime",
                                        output: true
                                    }
                                }
                            </script>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="ecm_daySelect" class="col-form-label form-label">Day</label>
                                        <select id="ecm_daySelect" class="form-select" dmx-bind:options="classesBase.data.days.days" optiontext="name" optionvalue="id" dmx-bind:value="getClassDetails.data.getClassDetails.day">
                                            <option selected="" value="" disabled="">Select Day</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="ecm_startTimeSelect" class="col-form-label form-label">Start Time:</label>
                                        <select id="ecm_startTimeSelect" class="form-select" dmx-bind:options="appSettings.ct_array" optiontext="display" optionvalue="decimal" dmx-on:updated="ec_var_selectedTimeDecimal.setValue(value);ec_timeToDisplay.run()" dmx-bind:value="getClassDetails.data.getClassDetails.startTimeDecimal">
                                            <option selected="" value="">Select Start Time</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="ecm_durationSelect" class="col-form-label form-label">Duration</label>
                                        <select id="ecm_durationSelect" class="form-select" dmx-bind:options="appSettings.duration_array" optiontext="display" optionvalue="value" dmx-bind:value="(getClassDetails.data.getClassDetails.endTimeDecimal - getClassDetails.data.getClassDetails.startTimeDecimal)">
                                            <option selected="" value="">Select Class Duration</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col">

                                    <div class="mb-3">
                                        <label for="ecm_endTimeInput1" class="col-form-label form-label">End Time:</label>
                                        <input type="text" class="form-control" id="ecm_endTimeInput" aria-describedby="input1_help" disabled="true" dmx-bind:value="dd_classDetails.data.endTimeDisplay">
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col">
                                    <h5 class="text-uppercase">Class Details</h5>

                                </div>
                            </div>
                            <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="ecm_daySelect1" class="col-form-label form-label">Instructor</label>
                                        <select id="ecm_instructorSelect" class="form-select" dmx-bind:value="getClassDetails.data.getClassDetails.instructor" required="" dmx-bind:options="getInstructors.data.getInstructors" optionvalue="id" optiontext="firstName+' '+lastName.trunc(1, true, '.')">
                                            <option selected="" value="">Select Instructor</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="ecm_daySelect1" class="col-form-label form-label">Class Level</label>
                                        <select id="ecm_classLevelSelect" class="form-select" dmx-bind:value="getClassDetails.data.getClassDetails.classLevel" required="" dmx-bind:options="getLevels.data.query" optiontext="name" optionvalue="id">
                                            <option selected="" value="">Select Level</option>
                                        </select>
                                    </div>
                                </div>

                            </div>
                            <hr>


                        </fieldset>
                        <div class="row justify-content-end">
                            <div class="col d-flex w-100 justify-content-start flex-column">
                                <h5 class="text-uppercase mb-3 ">Additional</h5>
                                <div class="mb-3 flex-row" id="input1_group" is="dmx-checkbox-group">

                                    <div class="col-sm-10 align-self-center ps-0">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="ec_checkboxIsActive" dmx-bind:checked="getClassDetails.data.getClassDetails.isactive" dmx-bind:value="checked ? true : false" required="" value="true">
                                            <label class="form-check-label clickable fw-bold" for="ec_checkboxIsActive" dmx-text="ec_checkboxIsActive.checked ? &quot;Active&quot; : &quot;Inactive&quot;" dmx-class:text-primary="ec_checkboxIsActive.checked">Active</label>
                                        </div><small id="bs4-form-group-help1" class="form-text text-muted mt-2">You can deactivate this class by setting the toggle to the "off" position.</small>


                                    </div>
                                </div>
                                <small id="bs4-form-group-help2" class="form-text text-muted text-end">ClassID: {{classHumanDetails.data.classHumanDetails.id}}</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">

                                <input id="ec_hd_inputClassID" name="classid" type="hidden" class="form-control" dmx-bind:value="getClassDetails.data.getClassDetails.id">
                                <input id="ec_hd_inputClassDay" name="day" type="hidden" class="form-control" dmx-bind:value="ecm_daySelect.value"><input id="ec_hd_inputClassStart" name="startTimeDecimal" type="hidden" class="form-control" dmx-bind:value="ecm_startTimeSelect.value">
                                <input id="ec_hd_inputClassEnd" name="endTimeDecimal" type="hidden" class="form-control" dmx-bind:value="ec_var_classDurationSum.value">
                                <input id="ec_hd_inputClassStartDisplay" name="startTimeDisplay" type="hidden" class="form-control" dmx-bind:value="ec_var_startTimeDisplay.value">
                                <input id="ec_hd_inputClassEndDisplay" name="endTimeDisplay" type="hidden" class="form-control" dmx-bind:value="ecm_endTimeInput.value">
                                <input id="ec_hd_inputInstructor" name="instructor" type="hidden" class="form-control" dmx-bind:value="ecm_instructorSelect.value">
                                <input id="ec_hd_inputLevel" name="classLevel" type="hidden" class="form-control" dmx-bind:value="ecm_classLevelSelect.value">
                                <input id="ec_hd_inputIsActive" name="isactive" class="form-control" dmx-bind:value="input1_group.ec_checkboxIsActive.checked ? 1 : 0" type="hidden">
                            </div>
                        </div>
                    </form>
                    <div class="collapse" id="ecm_timeslotError" is="dmx-bs5-collapse" dmx-bind:show="checkClassTimeslot.data.classTSAvailability > 0">
                        <hr>
                        <div class="d-flex align-items-stretch flex-column">
                            <div class="card text-white bg-danger">

                                <div class="card-header">
                                    <h5 class="mb-0">{{checkClassTimeslot.data.classTSAvailability[0].instructorName}} already has classes at this time.</h5>
                                </div>
                                <div class="card-body bg-light">
                                    <div class="d-flex">
                                        <div class="table-responsive">
                                            <table class="table table-sm mb-0">
                                                <thead>
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Day</th>
                                                        <th>Level</th>
                                                        <th>Start</th>
                                                        <th>End</th>
                                                        <th>Instructor</th>
                                                    </tr>
                                                </thead>
                                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="checkClassTimeslot.data.classTSAvailability" id="tableRepeat1">
                                                    <tr>
                                                        <td dmx-text="id"></td>
                                                        <td dmx-text="dayName"></td>
                                                        <td dmx-text="levelName"></td>
                                                        <td dmx-text="startTimeDisplay"></td>
                                                        <td dmx-text="endTimeDisplay"></td>
                                                        <td dmx-text="instructorName"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button id="btn3" class="btn btn-outline-light" dmx-on:click="run([{run:{action:`editClassModal.ecm_timeslotError.hide()`}},{wait:{delay:300}},{run:{action:`checkClassTimeslot.reset()`}}])"><i class="fas fa-undo-alt  fa-fw me-1"></i>Change</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </dmx-data-detail>



            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn text-light btn-primary" dmx-on:click="run({condition:{if:`content.editClassModal.ecm_timeslotError.collapsed`,then:{steps:[{run:{action:`checkClassTimeslot.load({instructor: ec_hd_inputInstructor.value, day: ec_hd_inputClassDay.value, starttimedecimal: ec_hd_inputClassStart.value, endtimedecimal: ec_hd_inputClassEnd.value, classid: ec_hd_inputClassID.value, isactive: ec_hd_inputIsActive})`}},{wait:{delay:200}},{condition:{if:`content.checkClassTimeslot.data.classTSAvailability.length > 0`,then:{steps:{run:{action:`editClassModal.ecm_timeslotError.show()`}}},else:{steps:{run:{action:`editClassModal.editClassForm.submit()`}}}}}]},else:{steps:{run:{action:`editClassModal.editClassForm.submit()`}}}}})">Edit
                    Class</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="classTransferSearchModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" style="z-index: 99999;">
    <div class="modal-dialog modal-dialog-scrollable modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header text-light bg-primary ">
                <h5 class="modal-title">Enrolment Transfer Search:</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="tsm_searchClassForm">
                    <div class="row gx-3 row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-xs-1">
                        <div class="col">
                            <div class="mb-3">
                                <label for="cb_tr_addTransferReason" class="col-form-label form-label">Day</label>
                                <select id="tr_selDay" class="form-select" dmx-bind:options="classesBase.data.days.days" optiontext="name" optionvalue="id" name="day">
                                    <option value="">Select Day</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="input2" class="col-form-label form-label">Time</label>
                                <select id="tr_selTime" class="form-select" dmx-bind:options="appSettings.ct_array" optiontext="display" optionvalue="decimal" name="startdecimal">
                                    <option selected="" value="">Select Time</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="input3" class="col-form-label form-label">Level</label>
                                <select id="tr_selLevel" class="form-select" dmx-bind:options="getLevels.data.query" optiontext="name" optionvalue="id" name="classlevel">
                                    <option value="">Select Level</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="input4" class="col-form-label form-label">Instructor</label>
                                <select id="tr_selInstructor" class="form-select" dmx-bind:options="getAllStaff.data.instructors.getInstructors" optiontext="firstName+' '+lastName.trunc(1, true, '.')" optionvalue="id" name="instructor">
                                    <option value="">Select Instructor</option>
                                </select>
                            </div>

                        </div>
                    </div>
                    <div class="row justify-content-end no-gutters"><button id="tr_searchButton" class="btn btn-light" dmx-on:click="searchClasses.load({instructor: tr_selInstructor.value, startdecimal: tr_selTime.value, day: tr_selDay.value, classlevel: tr_selLevel.value})"><i class="fas fa-search me-1"></i>Search</button></div>

                </form>
                <hr>
                <div class="row">
                    <div class="col">
                        <header>
                            <h5 class="fw-light mb-0">Search Results:</h5>
                            <small class="text-muted">Only the top 10 results are shown. If the class you're searching for isn't shown, please narrow down the search even further.</small>
                        </header>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr class="fw-bold small">
                                        <th class="border-0">Day</th>
                                        <th class="border-0">Class Time</th>
                                        <th class="border-0">Class Level</th>
                                        <th class="border-0">Instructor</th>
                                        <th scope="row" class="border-0">Availability</th>
                                        <th scope="row" class="border-0"></th>
                                    </tr>
                                </thead>
                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="searchClasses.data.classesSearch" id="tableRepeat3">
                                    <tr>
                                        <td dmx-text="day" class="align-middle"></td>
                                        <td dmx-text="startTimeDisplay.replace(' AM', '').replace(' PM', '') +' - '+endTimeDisplay" class="align-middle"></td>
                                        <td dmx-text="classLevel" class="align-middle"></td>
                                        <td dmx-text="instructorFirst +' '+instructorLast.trunc(1, true, '.')" class="align-middle"></td>
                                        <td class="align-middle" dmx-text="availability"></td>
                                        <td class="text-end align-middle"><button id="transferButton" class="btn btn-light btn-sm" wappler-command="editContent" dmx-hide="availability == 'FULL' || availability == 'OVERBOOKED'" dmx-on:click="transferEnrolmentModal.transferEnrolmentForm.var_transferToClass.setValue({'id': classid, 'day': day, 'level': classLevel, 'instructor': instructorFirst + ' ' + instructorLast.trunc(1, true, '.'), 'time': startTimeDisplay});classTransferSearchModal.hide()"><i class="fas fa-random me-1"></i>Transfer
                                            </button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="transferEnrolmentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="getEnrolmentSingle.reset();transferEnrolmentForm.reset();classTransferSearchModal.tsm_searchClassForm.reset()" dmx-style:opacity="">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header text-light bg-secondary">
                <h5 class="modal-title">Transfer Enrolment: {{getEnrolmentSingle.data.student.firstName+' '+getEnrolmentSingle.data.student.lastName}}<br></h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" id="transferEnrolmentForm" method="post" action="/api/classes/transferEnrolment" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-on:success="transferEnrolmentModal.hide();notifies1.success(getEnrolmentSingle.data.student.firstName+' '+getEnrolmentSingle.data.student.lastName+'\'s enrolment successfully transferred.');classesBase.load()" dmx-param:fromenrolmentid="{{getEnrolmentSingle.data.enrolment.id}}">

                    <div class="row" id="row_transferringFrom">
                        <div class="col">
                            <p class="text-muted rounded-small border p-2">
                                <strong>Transferring From:<br></strong>
                                {{getEnrolmentSingle.data.class.dayName+' '+getEnrolmentSingle.data.class.levelName+' - '+getEnrolmentSingle.data.class.startTimeDisplay+' - '+getEnrolmentSingle.data.class.instructorFirstName+' '+getEnrolmentSingle.data.class.instructorLastName.trunc(1, true, '.')}}
                            </p>

                        </div>
                        <div class="col-break w-100"></div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_dropDate" class="col-form-label form-label">Drop date (current class)</label>
                                <input type="date" class="form-control" id="inp_dropDate" name="dropDate" aria-describedby="inp_dropDate_help" placeholder="Enter Drop date" dmx-bind:value="getEnrolmentSingle.data.enrolment.dropDate.formatDate('yyyy-MM-dd')" required="">
                            </div>
                        </div>
                        <div class="col-break w-100"></div>
                        <div class="col">
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" value="" id="cb_tr_addTransferReason" name="input1">
                                    <label class="form-check-label" for="cb_tr_addTransferReason">Add transfer reason?</label>
                                </div>
                            </div>


                            <div class="collapse" id="transferReasonCollapse" is="dmx-bs5-collapse" dmx-bind:show="cb_tr_addTransferReason.checked">
                                <div class="mb-3">
                                    <label class="col-form-label form-label" for="cb_tr_futureDropDate">Transfer Reason:</label>
                                    <textarea id="inp_tr_dropReason" type="textarea" class="form-control border p-2 rounded-small" rows="4"></textarea>
                                    <input id="inp_hd_dropReason" name="dropReason" type="hidden" class="form-control" dmx-bind:value="inp_tr_dropReason.value == &quot;&quot; ? 'Transferred to: ' +getEnrolmentSingle.data.class.dayName+' '+getEnrolmentSingle.data.class.levelName+' - '+getEnrolmentSingle.data.class.startTimeDisplay+' - '+getEnrolmentSingle.data.class.instructorFirstName+' '+getEnrolmentSingle.data.class.instructorLastName.trunc(1, true, '.') : inp_tr_dropReason.value">
                                </div>
                            </div>

                        </div>
                        <hr>
                    </div>

                    <div class="row" id="row_transferringTo">

                        <div class="col">

                            <div class="row no-gutters">
                                <dmx-value id="var_transferToClass"></dmx-value>
                                <div class="col-break w-100"></div>

                            </div>
                            <hr>
                            <div class="row gx-3">
                                <div class="col mb-2">
                                    <p class="text-muted rounded-small border p-2 border-success" dmx-hide="var_transferToClass.value == null"><strong>Transferring To:<br></strong>
                                        {{var_transferToClass.value.day + ' ' + var_transferToClass.value.level + ' - ' + var_transferToClass.value.time + ' - ' + var_transferToClass.value.instructor }}</p>
                                    <p class="text-muted rounded-small border border-danger p-2" dmx-show="var_transferToClass.value == null"><strong>Transferring To:<br></strong><i class="fas fa-exclamation-triangle text-danger"></i>&nbsp;<span class="text-danger">Please select a class to transfer to.</span></p>
                                    <button id="btn_changeTransfer" class="btn btn-outline-primary btn-sm float-end" dmx-hide="var_transferToClass.value == null" dmx-on:click="classTransferSearchModal.show()"><i class="fas fa-sync me-1 fa-xs fa-fw"></i>Change</button>
                                    <button id="btn_addTransfer" class="btn btn-outline-primary btn-sm float-end" dmx-hide="var_transferToClass.value != null" dmx-on:click="classTransferSearchModal.show()"><i class="fas fa-plus  me-1 fa-fw fa-sm"></i>Add Class</button>
                                </div>
                                <div class="col-break w-100"></div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="inp_tr_startDate" class="col-form-label form-label">Start date</label>
                                        <input type="date" class="form-control" id="inp_tr_startDate" name="startDateTo" aria-describedby="inp_startDate_help" placeholder="Enter Start date" required="">
                                    </div>
                                </div>
                            </div>
                            <div class="row gx-3">
                                <div class="col">
                                    <div class="mb-3 mt-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" value="" id="cb_tr_futureDropDate" name="input2">
                                            <label class="form-check-label" for="cb_tr_futureDropDate">Add future drop date?</label>
                                        </div>
                                    </div>
                                    <div class="collapse" id="futureDropdateCollapse" is="dmx-bs5-collapse" dmx-bind:show="cb_tr_addTransferReason.checked">
                                        <div class="mb-3">
                                            <label class="col-form-label form-label" for="cb_tr_futureDropDate">Future Drop Date:</label>
                                            <input id="inp_futureDropDate" name="dropDateTo" class="form-control" type="date">
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row gx-3">
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="sel_tr_enrolmentType" class="col-form-label form-label">Enrolment Type:</label>
                                        <select id="sel_tr_enrolmentType" class="form-select" name="enrolmentTypeTo" dmx-bind:options="classesBase.data.enrolmentTypes" optiontext="type" optionvalue="id" dmx-bind:value="getEnrolmentSingle.data.enrolment.enrolmentType"></select>
                                    </div>
                                </div>
                            </div>
                            <small id="bs4-form-group-help6" class="form-text text-muted text-end">EnrolmentID: {{getEnrolmentSingle.data.enrolment.id}}</small>

                        </div>
                        <input id="inp_hd_toClassId" name="toClassId" type="hidden" class="form-control" dmx-bind:value="var_transferToClass.value.id">
                        <input id="inp_hd_studentId" name="student" type="hidden" class="form-control" dmx-bind:value="getEnrolmentSingle.data.student.id">
                    </div>
                </form>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" dmx-on:click="transferEnrolmentModal.hide();notifies1.info('Enrolment transfer cancelled.')" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-primary" form="editEnrolmentForm" dmx-on:click="transferEnrolmentForm.submit()">Transfer</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editEnrolmentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="editEnrolmentForm.reset()">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header text-light bg-secondary">
                <h5 class="modal-title">Edit Enrolment: {{getEnrolmentSingle.data.student.firstName+' '+getEnrolmentSingle.data.student.lastName}}<br>
                </h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">


                <div class="row">
                    <div class="col">
                        <p class="text-muted">
                            {{getEnrolmentSingle.data.class.dayName+' '+getEnrolmentSingle.data.class.levelName+' - '+getEnrolmentSingle.data.class.startTimeDisplay+' - '+getEnrolmentSingle.data.class.instructorFirstName+' '+getEnrolmentSingle.data.class.instructorLastName.trunc(1, true, '.')}}
                        </p>
                        <hr>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <form is="dmx-serverconnect-form" id="editEnrolmentForm" method="post" action="/api/classes/editEnrolment" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-on:success="classesBase.load(true);editEnrolmentModal.hide();notifies1.success(getEnrolmentSingle.data.student.firstName+' '+getEnrolmentSingle.data.student.lastName+'\'s enrolment successfully edited.');classesBase.load()">
                            <fieldset dmx-bind:disabled="">
                                <input type="hidden" class="form-control" id="inp_id" name="id" aria-describedby="inp_id_help" placeholder="Enter Id" data-msg-required="" dmx-bind:value="getEnrolmentSingle.data.enrolment.id">
                                <div class="row gx-3">
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="inp_startDate" class="form-label">Start date</label>
                                            <input type="date" class="form-control" id="inp_startDate" name="startDate" aria-describedby="inp_startDate_help" placeholder="Enter Start date" dmx-bind:value="getEnrolmentSingle.data.enrolment.startDate.formatDate('yyyy-MM-dd')">
                                        </div>
                                    </div>
                                </div>
                                <div class="row gx-3">
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="inp_dropDate" class="form-label">Drop date</label>
                                            <input type="date" class="form-control" id="inp_dropDate" name="dropDate" aria-describedby="inp_dropDate_help" placeholder="Enter Drop date" dmx-bind:value="getEnrolmentSingle.data.enrolment.dropDate.formatDate('yyyy-MM-dd')">
                                        </div>
                                        <div class="collapse" id="editEnrolmentDropReasonCollapse" is="dmx-bs5-collapse" dmx-bind:show="getEnrolmentSingle.data.enrolment.dropDate">
                                            <p><strong>Drop Reason:</strong><br>{{getEnrolmentSingle.data.enrolment.dropReason}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row gx-3">
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="sel_tr_enrolmentType" class="col-form-label form-label">Enrolment Type</label>
                                            <select id="sel_enrolmentType" class="form-select" name="enrolmentType" dmx-bind:options="classesBase.data.enrolmentTypes" optiontext="type" optionvalue="id" dmx-bind:value="getEnrolmentSingle.data.enrolment.enrolmentType">
                                            </select>
                                            <small id="select1Help" class="form-text text-muted">Enter a help text for your select.</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row gx-3">
                                    <div class="col">
                                        <input id="hdn_inp_isValid" name="isValid" type="hidden" class="form-control" dmx-bind:value="cb_isValid.checked ? 1 : 0">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" value="" id="cb_isValid" name="cb_isValid" dmx-bind:checked="getEnrolmentSingle.data.enrolment.isValid" dmx-bind:value="checked ? 1 : 0">
                                            <label class="form-check-label" for="cb_isValid">Enrolment Active?</label>
                                        </div>

                                    </div>
                                </div>
                                <small id="bs4-form-group-help5" class="form-text text-muted text-end">EnrolmentID: {{getEnrolmentSingle.data.enrolment.id}}</small>
                            </fieldset>
                        </form>

                    </div>
                </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editEnrolmentForm">Save Enrolment</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="dropEnrolmentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-light">
                <h5 class="modal-title">Drop Enrolment: {{getEnrolmentSingle.data.student.firstName+' '+getEnrolmentSingle.data.student.lastName}}</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <p>{{getEnrolmentSingle.data.class.dayName+' '+getEnrolmentSingle.data.class.levelName+' - '+getEnrolmentSingle.data.class.startTimeDisplay+' - '+getEnrolmentSingle.data.class.instructorFirstName+' '+getEnrolmentSingle.data.class.instructorLastName.trunc(1, true, '.')}}
                </p>
                <hr>
                <form id="dropEnrolmentForm" is="dmx-serverconnect-form" method="post" action="/api/classes/getEnrolmentSingle" dmx-on:success="notifies1.success('Enrolment successfully dropped: '+getEnrolmentSingle.data.student.firstName+' '+getEnrolmentSingle.data.student.lastName+' - '+getEnrolmentSingle.data.class.dayName+' '+getEnrolmentSingle.data.class.levelName+' - '+getEnrolmentSingle.data.class.startTimeDisplay+' with '+getEnrolmentSingle.data.class.instructorFirstName+' '+getEnrolmentSingle.data.class.instructorLastName.trunc(1, '.', true));dropEnrolmentModal.hide();getEnrolmentSingle.reset()">

                    <div class="mb-3">
                        <label for="classType" class="col-form-label form-label">Drop Date:</label>
                        <input id="inp_dropDate" class="form-control clickable" name="dropDate" is="dmx-date-picker" type="date" showweeknumbers="true" required="" opens="center">
                        <small id="bs4-form-group-help3" class="form-text text-muted">Please select the last day of enrolment.<br> This date is inclusive and the enrolment will be inactive from the day after the drop date.</small>

                    </div>
                    <div class="mb-3">
                        <label for="ta_dropReason" class="col-form-label form-label">Drop Reason:&nbsp;</label>
                        <textarea id="ta_dropReason" class="form-control border rounded-small p-3" rows="6" name="dropReason"></textarea>
                    </div>
                    <small id="bs4-form-group-help4" class="form-text text-muted text-end">EnrolmentID: {{getEnrolmentSingle.data.enrolment.id}}</small>

                </form>

            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button for="dropEnrolmentForm" type="submit" class="btn btn-primary">Drop Enrolment</button>
            </div>
        </div>
    </div>
</div>
<meta name="ac:route" content="/classes">

<main class="d-flex flex-grow-1">

    <div class="row flex-grow-1 g-0">

        <div class="col pt-0 pb-3 ps-3 pe-3 opacity-0" style="max-width: 1500px;">
            <dmx-preloader id="calendarloader" bgcolor="rgba(255,255,255,0.95)" color="#474747" spinner="foldingCube" dmx-show="content.classesBase.state.executing"></dmx-preloader>
            <div class="data-update-loader mx-n3 mt-n2" dmx-style:opacity.important="classesBase.state.executing ? 'flex' : 'none'" dmx-style:visibility="classesBase.state.executing ? 'visible' : 'hidden'">
            </div>
            <div class="row align-items-center">
                <div class="col d-flex justify-content-start flex-row align-items-center">
                    <h2 class="text-uppercase mb-0 fw-light me-3">Classes</h2>
                    <a href="/classes/classesCalendar" class="btn btn-outline-secondary btn-sm bg-white">Calendar View</a>
                </div>
                <div class="col d-flex justify-content-end flex-row align-items-center">
                    <div class="mb-3">
                        <select id="selectLimit" class="form-select" dmx-on:updated="queryManager.set('limit',value);queryManager.remove('offset')" width="50">
                            <option selected="" value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="150">150</option>
                            <option value="200">200</option>
                            <option value="250">250</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="rp_tabs" class="row row-cols-1 g-0" is="dmx-repeat" dmx-bind:repeat="classesBase.data.rp_enrols" key="id">
                <div class="col class-card border rounded-3 bg-white postition-relative mb-2 py-2 px-3" dmx-animate-enter.duration:350.delay:50="fadeIn" dmx-style:z-index.important="(251 - $index)" dmx-style:border-left-color.important="'#'+appSettings.classLevelsByID[classLevel].colour">
                    <div class="row row-cols-8 clickable g-0" dmx-on:click="enrolmentsCollapse.toggle()">
                        <div class="align-self-center col-1 class-info">
                            <p class="mb-0 small fw-bold" dmx-html="appSettings.classLevelsByID[classLevel].name"><strong>Duckling </strong></p>
                            <p class="mb-0 small" dmx-html="day_name">Monday</p>
                            <p class="mb-0 small" dmx-html="startTimeDisplay.replace(' AM', '').replace(' PM', '')+' - '+endTimeDisplay">9:00 - 9:30am</p>
                        </div>
                        <div class="align-self-center col-4">
                            <p class="mb-0 text-center text-uppercase" dmx-text="instructorid === null ? '&lt;&lt;NO INSTRUCTOR FOUND&gt;&gt;' : appSettings.instructorsById[instructorid].trunc_name">Instructor</p>
                        </div>

                        <div class="col align-self-center d-flex flex-row justify-content-start align-items-center">
                            <div class="row">
                                <div class="col-auto">
                                    <div class="row">
                                        <div class="col-auto align-self-center d-flex justify-content-start">
                                            <p class="mb-0 text-center small">{{enrol_active}} Active</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto align-self-center" id="cr_enrolCountMakeup">
                                            <p class="mb-0 text-center small">{{enrol_makeup}} Makeups</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="row">
                                        <div class="col-auto align-self-center" id="cr_enrolCountTrial">
                                            <p class="mb-0 text-center small">{{enrol_trial}} Trials</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto align-self-center" id="cr_waitlistCount" dmx-hide="enrol_waitlist == 0">
                                            <p class="mb-0 text-center small">{{enrol_waitlist}} Waitlisted</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="row">
                                        <div class="col-auto align-self-center" id="cr_casualCount" dmx-hide="enrol_casual == 0">
                                            <p class="mb-0 text-center small">{{enrol_casual}} Casual</p>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="border-top-0 border-bottom-0">
                        <div class="collapse" id="enrolmentsCollapse" is="dmx-bs5-collapse" dmx-bind:id="enrolmentsCollapse_{{$index}}">
                            <div class="row g-0 d-flex flex-column pb-4  pt-2 mt-2 border-top">
                                <div class="col">

                                    <div class="row row-cols-2 gx-2 my-2">
                                        <div class="col-12">
                                            <div class="row">
                                                <div class="col">
                                                    <button id="btn_newEnrolment" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-outline-primary btn-sm" dmx-on:click="enrolmentSearchModal.dd_classdetails_searchenrol.var_enroltype.setValue('standard');enrolmentSearchModal.dd_classdetails_searchenrol.select(id);enrolmentSearchModal.show()">
                                                        <i class="bi-plus-circle me-2"></i>Create Enrolment
                                                    </button>
                                                    <button id="btn_newWaitlist" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-outline-primary btn-sm" dmx-on:click="enrolmentSearchModal.dd_classdetails_searchenrol.var_enroltype.setValue('waitlist');enrolmentSearchModal.dd_classdetails_searchenrol.select(id);enrolmentSearchModal.show()">
                                                        <i class="bi-clock-history me-2"></i>New Waitlist
                                                    </button>
                                                </div>
                                                <div class="col">
                                                    <div class="row g-0">
                                                        <div class="col d-flex justify-content-end">

                                                            <button id="btn_editClass" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-sm btn-outline-secondary me-3" dmx-on:click="editClassModal.dd_editClass.select(id);editClassModal.show()">
                                                                <i class="bi-pencil-fill me-2"></i>Edit Class</button>

                                                            <button id="btn_cancelClass" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-sm btn-outline-danger" dmx-on:click="run([{run:{action:`getClassDetails.load({classid: id});editClassModal.classHumanDetails.load({classid: id})`}},{wait:{delay:200}},{run:{action:`editClassModal.show()`}}])"><i class="bi-slash-circle me-2"></i>Cancel Class</button>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>




                                    </div>
                                    <div class="row row-cols-1 g-2 mt-3 align-items-stretch row-cols-lg-2">
                                        <div class="col d-flex align-items-stretch" dmx-show="active_enrols.length > 0">
                                            <div class="row g-0 w-100">
                                                <div class="col border rounded-3 p-3">
                                                    <header class="pt-2 pb-2 mb-2 border-bottom">

                                                        <h6 class="mb-0 fw-light"><i class="bi-check-circle me-2 text-success"></i>Active Enrolments
                                                        </h6>
                                                    </header>


                                                    <div class="table-responsive">
                                                        <table class="table mb-0 table-small table-sm small">
                                                            <thead class="border-bottom">
                                                                <tr class="border-0 small fw-bold">
                                                                    <th scope="row" class="border-0 tc_td_min"></th>
                                                                    <th class="border-0" style="width: 25%; padding-left: 20px !important;">Student</th>
                                                                    <th class="border-0" style="width: 15%;">Start date</th>
                                                                    <th class="border-0" style="width: 15%;">Drop date</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="active_enrols" id="activeEnrolmentsTableRepeat" dmx-animate-enter.duration:100="fadeIn">
                                                                <tr>
                                                                    <td style="width: 1%; white-space: nowrap; padding-right: 1rem;" class="tc_td_min align-middle">
                                                                        <div class="dropdown no-caret">
                                                                            <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown" class="btn dropdown-toggle no-caret btn-outline-dark btn-sm" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="bi-pencil-fill small"></i></button>
                                                                            <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-pen me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Edit Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="far fa-arrow-alt-circle-down me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Drop Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-random me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Transfer Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+student.family" dmx-hide="student.family == '' || student.family == null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-user-friends me-1 fa-sm fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Go to Family
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td class="align-middle" dmx-text="firstName +' '+lastName" style="padding-left: 20px !important;"></td>
                                                                    <td dmx-text="startDate.formatDate('dd MMM yyyy')" class="align-middle"></td>
                                                                    <td dmx-text="dropDate.formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col d-flex align-items-stretch" dmx-show="trial_enrols.length > 0">
                                            <div class="row g-0 w-100">
                                                <div class="col border rounded-3 p-3">
                                                    <header class="pt-2 pb-2 mb-2 border-bottom ">
                                                        <h6 class="mb-0 fw-light"><i class="bi-question-circle me-2" style="color: #f90;"></i>Trial Enrolments
                                                        </h6>
                                                    </header>

                                                    <div class="table-responsive small">
                                                        <table class="table mb-0 table-small table-sm">
                                                            <thead class="border-bottom">
                                                                <tr class="border-0 small fw-bold">
                                                                    <th scope="row" class="border-0  tc_td_min"></th>
                                                                    <th class="border-0" style="width: 25%; padding-left: 20px !important;">Student</th>
                                                                    <th class="border-0" style="width: 15%;">Start date</th>
                                                                    <th class="border-0" style="width: 15%;">Drop date</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="trial_enrols" id="trialEnrolmentsTableRepeat">
                                                                <tr>
                                                                    <td class="tc_td_min">
                                                                        <div class="dropdown no-caret">
                                                                            <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown" class="btn dropdown-toggle no-caret btn-outline-dark btn-sm" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="bi-pencil-fill small"></i></button>
                                                                            <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-pen me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Edit Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="far fa-arrow-alt-circle-down me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Drop Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-random me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Transfer Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+student.family" dmx-hide="student.family == '' || student.family == null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-user-friends me-1 fa-sm fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Go to Family
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                        <!-- <button id="btn_trEnr_details" dmx-bind:id="btn_trEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                        dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap"></i></button>
                                                                    <button id="btn_trEnr_drop" dmx-bind:id="btn_trEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down"></i></button>
                                                                    <button id="btn_trEnr_transfer" dmx-bind:id="btn_trEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random"></i></button> -->
                                                                    </td>
                                                                    <td dmx-text="firstName +' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                                                    <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                    <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>


                                                </div>

                                            </div>
                                        </div>
                                        <div class="col d-flex align-items-stretch" dmx-show="makeup_enrols.length > 0">
                                            <div class="row g-0 w-100">
                                                <div class="col p-3 border rounded-3">
                                                    <header class="pt-2 pb-2 mb-2 border-bottom">
                                                        <h6 class="mb-0 fw-light"><i class="bi-arrow-repeat me-2" style="color: #319bfa;"></i>Makeup Enrolments
                                                        </h6>
                                                    </header>

                                                    <div class="table-responsive small">
                                                        <table class="table mb-0 table-small">
                                                            <thead class="border-bottom">
                                                                <tr class="border-0 small fw-bold">
                                                                    <th scope="row" class="border-0 fw-light  tc_td_min"></th>
                                                                    <th class="border-0" style="padding-left: 20px !important; width: 25%;">Student</th>
                                                                    <th class="border-0" style="width: 15%;">Start date</th>
                                                                    <th class="border-0" style="width: 15%;">Drop date</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="makeup_enrols" id="makeupEnrolmentsTableRepeat">
                                                                <tr>
                                                                    <td class=" tc_td_min align-middle">
                                                                        <div class="dropdown no-caret">
                                                                            <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown" class="btn dropdown-toggle no-caret btn-outline-dark btn-sm" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="bi-pencil-fill small"></i></button>
                                                                            <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-pen me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Edit Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="far fa-arrow-alt-circle-down me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Drop Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-random me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Transfer Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+student.family" dmx-hide="student.family == '' || student.family == null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-user-friends me-1 fa-sm fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Go to Family
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                        <!-- <button id="btn_muEnr_details" dmx-bind:id="btn_muEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                        dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap fa-fw"></i></button>
                                                                    <button id="btn_muEnr_drop" dmx-bind:id="btn_muEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down fa-fw"></i></button>
                                                                    <button id="btn_muEnr_transfer" dmx-bind:id="btn_muEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random fa-fw"></i></button> -->
                                                                    </td>
                                                                    <td dmx-text="firstName +' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                                                    <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                    <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </div>

                                            </div>

                                        </div>
                                        <div class="col d-flex align-items-stretch" dmx-show="wait_enrols.length > 0">
                                            <div class="row g-0 w-100">
                                                <div class="col p-3 border rounded-3">
                                                    <header class="pt-2 pb-2 mb-2 border-bottom">
                                                        <h6 class="mb-0 fw-light"><i class="bi-clock-history me-2" style="color: #000;"></i>Waitlisted
                                                        </h6>
                                                    </header>


                                                    <div class="table-responsive small">
                                                        <table class="table mb-0 table-small">
                                                            <thead class="border-bottom">
                                                                <tr class="small fw-bold">
                                                                    <th scope="row" class="border-0 fw-light tc_td_min"></th>
                                                                    <th class="border-0" style="width: 25%; padding-left: 20px !important;">Student</th>
                                                                    <th class="border-0" style="width: 15%;">Start date</th>
                                                                    <th class="border-0" style="width: 15%;">Drop date</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="wait_enrols" id="waitlistedTableRepeat">
                                                                <tr>
                                                                    <td class=" tc_td_min align-middle">
                                                                        <div class="dropdown no-caret">
                                                                            <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown" class="btn dropdown-toggle no-caret btn-outline-dark btn-sm" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="bi-pencil-fill small"></i></button>
                                                                            <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-pen me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Edit Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="far fa-arrow-alt-circle-down me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Drop Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-random me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Transfer Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+student.family" dmx-hide="student.family == '' || student.family == null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-user-friends me-1 fa-sm fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Go to Family
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                        <!-- <button id="btn_waEnr_details" dmx-bind:id="btn_waEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                        dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap fa-fw"></i></button>
                                                                    <button id="btn_waEnr_drop" dmx-bind:id="btn_waEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down fa-fw"></i></button>
                                                                    <button id="btn_waEnr_transfer" dmx-bind:id="btn_waEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random fa-fw"></i></button> -->
                                                                    </td>
                                                                    <td dmx-text="firstName +' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                                                    <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                    <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="col d-flex align-items-stretch" dmx-show="casual_enrols.length > 0">
                                            <div class="row g-0 w-100">
                                                <div class="col p-3 border rounded-3">
                                                    <header class="pt-2 pb-2 mb-2 border-bottom">
                                                        <h6 class="mb-0 fw-light"><i class="bi-hexagon-half me-2 text-primary" style="color: #000;"></i>Casual</h6>
                                                    </header>


                                                    <div class="table-responsive small">
                                                        <table class="table mb-0 table-small">
                                                            <thead class="border-bottom">
                                                                <tr class="small fw-bold">
                                                                    <th scope="row" class="border-0 fw-light tc_td_min"></th>
                                                                    <th class="border-0" style="width: 25%; padding-left: 20px !important;">Student</th>
                                                                    <th class="border-0" style="width: 15%;">Start date</th>
                                                                    <th class="border-0" style="width: 15%;">Drop date</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="casual_enrols" id="casualTableRepeat">
                                                                <tr>
                                                                    <td class=" tc_td_min align-middle">
                                                                        <div class="dropdown no-caret">
                                                                            <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown1" class="btn dropdown-toggle no-caret btn-outline-dark btn-sm" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="bi-pencil-fill small"></i></button>
                                                                            <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-pen me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Edit Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="far fa-arrow-alt-circle-down me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Drop Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-random me-1 fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Transfer Enrolment
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                                <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+student.family" dmx-hide="student.family == '' || student.family == null">
                                                                                    <div class="row flex-nowrap">
                                                                                        <div class="col-1">
                                                                                            <i class="fas fa-user-friends me-1 fa-sm fa-fw"></i>
                                                                                        </div>
                                                                                        <div class="col-auto">
                                                                                            Go to Family
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                        <!-- <button id="btn_waEnr_details" dmx-bind:id="btn_waEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                        dmx-on:click="getEnrolmentSingle.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap fa-fw"></i></button>
                                                                    <button id="btn_waEnr_drop" dmx-bind:id="btn_waEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down fa-fw"></i></button>
                                                                    <button id="btn_waEnr_transfer" dmx-bind:id="btn_waEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random fa-fw"></i></button> -->
                                                                    </td>
                                                                    <td dmx-text="firstName +' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                                                    <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                    <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="row row-cols-1 gy-2" is="dmx-if" id="cr_noEnrolments" dmx-bind:condition="(activeEnrolments.length + makeupEnrolments.length + trialEnrolments.length) == 0">
                                        <div class="col py-5">
                                            <h5 class="text-center fw-light m-0 text-body">
                                                This class has no enrolments or waitlists.</h5>
                                            <p class="text-center mb-0">Add an enrolment with the&nbsp;&nbsp;<i class="fas fa-plus text-white bg-primary rounded-icon fa-xs"></i>&nbsp;&nbsp;button above.</p>
                                        </div>
                                    </div>
                                </div>



                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col d-flex flex-row justify-content-center">
                    <ul class="pagination" dmx-populate="classesBase.data.classdump.data" dmx-state="queryManager" dmx-offset="offset" dmx-generator="bs5paging">
                        <li class="page-item" dmx-class:disabled="classesBase.data.classdump.data.page.current == 1" aria-label="First">
                            <a href="javascript:void(0)" class="page-link" dmx-on:click="queryManager.set('offset',classesBase.data.classdump.data.page.offset.first)"><span aria-hidden="true">&lsaquo;&lsaquo;</span></a>
                        </li>
                        <li class="page-item" dmx-class:disabled="classesBase.data.classdump.data.page.current == 1" aria-label="Previous">
                            <a href="javascript:void(0)" class="page-link" dmx-on:click="queryManager.set('offset',classesBase.data.classdump.data.page.offset.prev)"><span aria-hidden="true">&lsaquo;</span></a>
                        </li>
                        <li class="page-item" dmx-class:active="title == classesBase.data.classdump.data.page.current" dmx-class:disabled="!active" dmx-repeat="classesBase.data.classdump.data.getServerConnectPagination(2,1,'...')">
                            <a href="javascript:void(0)" class="page-link" dmx-on:click="queryManager.set('offset',(page-1)*classesBase.data.classdump.data.limit)">{{title}}</a>
                        </li>
                        <li class="page-item" dmx-class:disabled="classesBase.data.classdump.data.page.current ==  classesBase.data.classdump.data.page.total" aria-label="Next">
                            <a href="javascript:void(0)" class="page-link" dmx-on:click="queryManager.set('offset',classesBase.data.classdump.data.page.offset.next)"><span aria-hidden="true">&rsaquo;</span></a>
                        </li>
                        <li class="page-item" dmx-class:disabled="classesBase.data.classdump.data.page.current ==  classesBase.data.classdump.data.page.total" aria-label="Last">
                            <a href="javascript:void(0)" class="page-link" dmx-on:click="queryManager.set('offset',classesBase.data.classdump.data.page.offset.last)"><span aria-hidden="true">&rsaquo;&rsaquo;</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</main>