<!-- Wappler include head-page="layouts/layout2" is="dmx-app" id="familyDetails" appconnect="local" fontawesome_5="cdn" dmx-on:load="run([{run:{action:`queryManager.set(\'ledgerinfo_offset\',0)`}},{run:{action:`queryManager.set(\'ledgerinfo_limit\',5)`}},{run:{action:`fl_findRelationshipName.run()`}}])" components="{dmxBootbox:{},dmxDataTraversal:{},dmxDatePicker:{},dmxBootstrap4Modal:{},dmxValidator:{},dmxFormatter:{},dmxBootstrap5Offcanvas:{},dmxCalendar:{},dmxBootstrap5Collapse:{},dmxBootstrap5Modal:{},dmxBootstrap5Navigation:{},dmxAnimateCSS:{},dmxNotifications:{},dmxPreloader:{},dmxStateManagement:{},dmxBootstrap5TableGenerator:{},dmxMasonry:{},dmxBootstrap5Tooltips:{},dmxBrowser:{},dmxMoment:{},dmxDownload:{},dmxDatastore:{},dmxBootstrap5Alert:{},dmxBootstrap5Toasts:{},dmxMediumEditor:{},dmxSummernote:{},dmxSummernoteFileUpload:{},dmxGooglePlaces:{},dmxAutocomplete:{},dmxBootstrap5Popovers:{},dmxTyped:{},dmxSockets:{},dmxStripe:{},dmxBootstrap5PagingGenerator:{}}" moment_2="cdn with locales" bootstrap5="local" bootstrap_icons="cdn" -->
<dmx-preloader id="familyDetail_preloader" head-page="layouts/layout2" spinner="wanderingCubes" bgcolor="rgba(255,255,255,1)" style="z-index: 1051;"></dmx-preloader>
<dmx-serverconnect id="familyDetails" url="api/families/GET_FAMILY_details" dmx-param:familyid="query.familyid" dmx-on:done="getFees.load({familyid: query.familyid, monthtocount: '2021-06-01'})" dmx-param:familyuuid="query.familyid" dmx-on:success="run([{wait:{delay:300}},{run:{action:`toggle_loadingplaceholders.uncheck()`}}])" dmx-on:start="toggle_loadingplaceholders.check()" dmx-param:family_uuid="query.familyid"></dmx-serverconnect>
<script is="dmx-flow" id="checkEmailArray" type="text/dmx-flow">{
  meta: {
    $param: [
      {type: "text", name: "email"},
      {type: "array", name: "emailArr"}
    ]
  },
  exec: {
    steps: [
      {
        assign: {value: "{{$param.email}}", name: "var_email"}
      },
      {
        condition: {
          if: "{{$param.emailArr.length > 0}}",
          then: {
            steps: {
              repeat: {
                repeat: "{{$param.emailArr}}",
                outputFields: [],
                exec: {
                  steps: {
                    condition: {
                      if: "{{$value.values().contains(var_email)}}",
                      then: {
                        steps: [
                          {
                            assign: {value: "false", name: "var_continue", output: true}
                          },
                          {
                            setGlobal: {key: "var_addemail_continue_newGuardian", value: "false"}
                          }
                        ]
                      },
                      else: {
                        steps: [
                          {
                            assign: {value: "true", name: "var_continue", output: true}
                          },
                          {
                            setGlobal: {key: "var_addemail_continue_newGuardian", value: "true"}
                          }
                        ]
                      }
                    }
                  }
                },
                name: "repeat"
              }
            }
          },
          else: {
            steps: [
              {
                assign: {value: "true", name: "var_continue", output: true}
              },
              {
                setGlobal: {key: "var_addemail_continue_newGuardian", value: "true"}
              }
            ]
          }
        }
      }
    ]
  }
}</script>
<dmx-download id="downloadFile"></dmx-download>
<dmx-session-manager id="ledgerStorage"></dmx-session-manager>


<meta name="ac:route" content="/families/familydetail/:familyid">
<dmx-value id="topPriorityNotes" dmx-bind:value="familyDetails.data.familyNotes[0].maxPriority == 5 ? 'Has Critical Note/s' : familyDetails.data.familyNotes[0].maxPriority == 4 ? 'Has High Priority Note/s' : familyDetails.data.familyNotes[0].maxPriority == 3 ? 'Has Medium Note/s' : 'Has Notes';">
</dmx-value>
<dmx-notifications id="successNotifies" position="bottom" closable="true" opacity="0.95" timeout="3500" extended-timeout="300" align="full"></dmx-notifications>
<div class="section overlay" dmx-class:overlay-show="editGuardian.value === 1"></div>
<dmx-query-manager id="getFamilyID"></dmx-query-manager>
<dmx-value id="editGuardian" dmx-bind:value="0"></dmx-value>
<div class="modal" id="address_createOrEdit" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <h5 class="modal-title">Create New or Edit Existing Address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body border-bottom">
                <div class="row">
                    <div class="col">
                        <button id="confirmCreateAddressBtn" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#address_createModal"><i class="bi-plus-circle me-2"></i>Create New Address
                        </button>
                    </div>
                </div>
            </div>
            <div id="addressRepeat" is="dmx-repeat" dmx-bind:repeat="familyDetails.data.addresses">
                <div class="modal-body border-bottom">
                    <div class="row">
                        <div class="col">
                            <p class="mb-1 lh-1" dmx-text="unit" dmx-hide="unit == '' || unit == null">Unit/Suite</p>
                            <p class="mb-1 lh-1" dmx-text="street1">Street 1</p>
                            <p class="mb-1 lh-1" dmx-text="street2" dmx-hide="street2 == '' || street2 == null">Street 2
                            </p>
                            <p class="mb-1 lh-1" dmx-text="suburb">Suburb</p>
                            <p class="mb-1 lh-1" dmx-text="state_name+' '+postcode">State ZIP Postal Code</p>
                            <p class="mb-0 lh-1" dmx-text="country_name">Country</p>
                        </div>
                        <div class="d-flex justify-content-end align-items-start col-auto">
                            <button class="btn btn-sm btn-link p-0"><i class="bi-pencil me-1"></i>Edit
                            </button>
                            <form id="form_deleteAddress" is="dmx-serverconnect-form" method="post" action="/api/families/deleteAddress" dmx-bind:id="form_deleteAddress_{{$index}}" dmx-on:success="notifies1.success('Address successfully deleted.');familyDetails.load({familyid: query.familyid})" dmx-on:error="notifies1.danger('Error: '+form_deleteAddress.lastError.status+' - '+form_deleteAddress.lastError.message+' - '+form_deleteAddress.lastError.response)">
                                <input id="addressId" name="id" type="hidden" class="form-control" dmx-bind:value="id">
                                <button class="btn btn-sm btn-link p-0 ms-2 text-danger" dmx-show="familyDetails.data.addresses.length > 1" dmx-bs-tooltip="'Double click to delete.'" data-bs-trigger="hover" dmx-on:dblclick="run({'bootbox.confirm':{message:'Are you sure you want to delete this address?\n\n\n\n',title:'Confirm',then:{steps:{run:{action:`form_deleteAddress.submit()`}}}}})"><i class="bi-trash2-fill me-1"></i>Delete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="address_createModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" dmx-on:hidden-bs-modal="run([{run:{action:`form_createAddress.reset()`}},{run:{action:`form_createAddress.var_countryid.setValue(null)`}},{run:{action:`form_createAddress.var_stateid.setValue(null)`}},{runJS:{function:'gpReset',args:['address_createModal.form_createAddress.inp_residenceAutocomplete'],name:'resetAutocomplete'}}])">
    <div class="modal-dialog modal-lg modal-fullscreen-lg-down modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header text-light bg-secondary">
                <h5 class="modal-title">Create Address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" id="form_createAddress" method="post" action="/api/families/createAddress" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-on:success="familyDetails.load({familyid: query.familyid});address_createModal.hide();notifies1.success('Address created successfully.')" dmx-on:error="notifies1.danger('Error '+address_createModal.form_createAddress.lastError.status+': '+address_createModal.form_createAddress.lastError.message.trunc(100, true, '...')+' - '+address_createModal.form_createAddress.lastError.response)">
                    <div class="mb-3">
                        <label for="inp_residenceAutocomplete" class="form-label col-form-label">Search<i class="bi-question-circle-fill ms-2 clickable" dmx-bs-popover="'Search results, by default, are restricted to your country. You can change this in your settings or enter addresses manually.<br><br><span style=&quot;text-danger&quot;>It is not recommended to fill addresses manually, as typos and other errors can occur.</span>'" data-bs-trigger="hover" dmx-bind:popover-title="'Search restricted by default.'" data-bs-html="true"></i></label>
                        <input type="text" class="form-control" id="inp_residenceAutocomplete" aria-describedby="input1_help" placeholder="Search address" is="dmx-google-autocomplete" types="address" dmx-on:updated="getcountryid.load({country: address_createModal.form_createAddress.inp_residenceAutocomplete.components.country.long});getstateid.load({state: address_createModal.form_createAddress.inp_residenceAutocomplete.components.administrativeAreaLevel1.long})" dmx-bind:country="localization.data.localization.iso2">
                        <small id="input1_help" class="form-text text-muted">PO Boxes must be input manually.</small>
                    </div>
                    <div class="mb-2">
                        <label for="inp_unit" class="col-form-label">Apartment, unit, suite, or floor #</label>
                        <input type="text" class="form-control" id="inp_unit" name="unit" aria-describedby="inp_unit_help" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.subpremise.long" autocomplete="new-subpremise">
                    </div>
                    <div class="mb-2">
                        <label for="inp_street" class="col-form-label">Street</label>
                        <input type="text" class="form-control" id="inp_street" name="street1" aria-describedby="inp_street_help" required="" dmx-bind:value="(address_createModal.form_createAddress.inp_residenceAutocomplete.components.streetNumber.long) ? address_createModal.form_createAddress.inp_residenceAutocomplete.components.streetNumber.long+' '+address_createModal.form_createAddress.inp_residenceAutocomplete.components.route.long : ''" autocomplete="new-route">
                    </div>
                    <div class="row row-cols-3">
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_suburb" class="col-form-label">Suburb</label>
                                <input type="text" class="form-control" id="inp_suburb" name="suburb" aria-describedby="inp_suburb_help" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.locality.long" autocomplete="new-locality">
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_postcode" class="col-form-label">Postcode</label>
                                <input type="text" class="form-control" id="inp_postcode" name="postcode" aria-describedby="inp_postcode_help" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.postalCode.long" autocomplete="new-postal-code">
                            </div>
                        </div>
                    </div>
                    <div class="row row-cols-3">
                        <dmx-value id="var_countryid" dmx-bind:value="getcountryid.data.countryid.id"></dmx-value>
                        <dmx-value id="var_stateid" dmx-bind:value="getstateid.data.stateid.id"></dmx-value>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_country" class="col-form-label">Country</label>
                                <select id="sel_country" class="form-select" name="country" dmx-bind:value="address_createModal.form_createAddress.var_countryid.value ? address_createModal.form_createAddress.var_countryid.value : appSettings.default_country" dmx-bind:options="getCountries.data.countries" optiontext="name" optionvalue="id" dmx-on:updated="run([{wait:{delay:100}},{run:{action:`getCountryStates.load({countryid: value})`}}])" dmx-bind:readonly="!form_createAddress.switch_manualAddress.checked">
                                    <option disabled selected value="" hidden>Please select...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_state" class="col-form-label">State</label>
                                <select id="sel_state" class="form-select" name="state" dmx-bind:options="getCountryStates.data.states" optiontext="name" optionvalue="id" dmx-bind:readonly="!form_createAddress.switch_manualAddress.checked" dmx-bind:disabled="getCountryStates.data.states.length === 0" dmx-bind:value="address_createModal.form_createAddress.var_stateid.value ? address_createModal.form_createAddress.var_stateid.value : ''">
                                    <option disabled selected value="" hidden>Please select...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <input type="hidden" class="form-control" id="inp_family" name="family" aria-describedby="inp_family_help" placeholder="Enter Family" dmx-bind:value="query.familyid">
                    </div>
                    <div class="mb-3">
                        <button class="btn btn-primary" dmx-on:click="form_createAddress.submit()"><i class="bi-save2 me-2"></i>Create Address
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="createStudentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hide-bs-modal="createStudentForm.reset()" dmx-on:show-bs-modal="ns_pageCounter.setValue(1)">
    <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 text-light bg-secondary">
                <h5 class="modal-title">Create New Student</h5>
                <button type="button" class="btn-close text-white" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row g-0">
                    <div class="col mb-3">
                        <ul class="list-group list-group-horizontal d-flex">
                            <li class="list-group-item rounded-0 col-4 active" id="li_studentGeneralInformation" dmx-class:active="createStudentModal.ns_pageCounter.value == 1">
                                <center>General Info</center>
                            </li>
                            <li class="list-group-item col-4" id="li_studentClassDetails" dmx-class:active="createStudentModal.ns_pageCounter.value == 2">
                                <center>Medical Info</center>
                            </li>
                            <li class="list-group-item rounded-0 col-4" id="li_studentMedicalInformation" dmx-class:active="createStudentModal.ns_pageCounter.value == 3">
                                <center>Review</center>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <section class="position-absolute top-0 start-0 h-100 w-100 d-flex flex-column justify-content-center align-items-center bg-white visually-hidden offcanvas-validate-overlay" id="ns_validationScreen" dmx-class:visually-hidden="var_validationNewStudent.value === false">
                        <div class="spinner-border text-primary" role="status">
                        </div>
                        <p class="mt-2">Validating Information...</p>
                    </section>
                    <dmx-value id="ns_pageCounter" dmx-bind:value="1"></dmx-value>
                    <div is="dmx-animate" id="ar_nsGeneralInfo" showeffect="fadeIn" hideeffect="fadeOut" dmx-bind:visible="createStudentModal.ns_pageCounter.value == 1" dmx-hide="createStudentModal.ns_pageCounter.value != 1">
                        <section>
                            <form id="classAndLevelDetailsForm">
                                <div class="row row-cols-2 pb-3" id="ns_GeneralInfoSection">
                                    <div class="col-12">
                                        <h5 class="fw-bold border-bottom pb-1">General Information</h5>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3 small">
                                            <label for="inp_studentFirstName" class="mb-0 col-form-label-sm form-label">First Name</label>
                                            <input type="text" class="form-control" id="inp_studentFirstName" aria-describedby="input1_help" placeholder="First Name" required="">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3 small">
                                            <label for="inp_studentLastName" class="mb-0 col-form-label-sm form-label">Last Name</label>
                                            <input type="text" class="form-control" id="inp_studentLastName" aria-describedby="input2_help" placeholder="Last Name">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3 small">
                                            <label for="inp_studentDOB" class="mb-0 col-form-label-sm form-label">Date
                                                of Birth</label>
                                            <input type="date" class="form-control" id="inp_studentDOB" aria-describedby="input1_help" placeholder="Date of Birth" required="">
                                        </div>
                                    </div>
                                    <div class="col-break w-100"></div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="sel_gender" class="mb-0 col-form-label-sm form-label">Gender</label>
                                            <select id="sel_gender" class="form-select" required="">
                                                <option selected="" value="">Select Gender...</option>
                                                <option value="F">Female</option>
                                                <option value="M">Male</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row row-cols-1" id="ns_ClassDetailsSection">
                                    <div class="col-12">
                                        <h5 class="fw-bold border-bottom pb-1">Class &amp; Level Details</h5>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="inp_studentClassLevel" class="mb-0 col-form-label-sm form-label">Class Level</label>
                                            <select id="inp_studentClassLevel" class="form-select" dmx-bind:options="appSettings.classLevels_array" optiontext="name" optionvalue="uuid" required="">
                                                <option selected="" value="">Choose level...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="inp_rollsheetComment" class="mb-0 col-form-label-sm form-label">Rollsheet Comments
                                                (non-medical)</label>
                                            <textarea id="inp_rollsheetComment" class="form-control"></textarea>
                                            <small id="textarea1_Help" class="form-text text-muted">This information
                                                will be shown on the instructors rollsheets. Please add any information
                                                the class instructor needs to know.</small>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </section>
                    </div>
                    <div is="dmx-animate" id="ar_nsMedicalDetails" showeffect="fadeIn" hideeffect="fadeOut" dmx-bind:visible="createStudentModal.ns_pageCounter.value == 2" dmx-hide="createStudentModal.ns_pageCounter.value != 2">
                        <section>
                            <form id="medicalInfoForm">
                                <div class="row" id="ns_MedicalInfoSection">
                                    <div class="col-12">
                                        <h5 class="fw-bold border-bottom pb-1">Medical Information</h5>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="inp_rollsheetMedical" class="mb-0 col-form-label-sm form-label">Rollsheet Medical
                                                Information</label>
                                            <textarea id="inp_rollsheetMedical" class="form-control" rows="4"></textarea>
                                            <small id="textarea1_Help1" class="form-text text-danger">This information
                                                will be shown on the instructors rollsheets. <br>Add any important
                                                medical information the class instructor needs to
                                                know.</small>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="inp_additionalMedical" class="mb-0 col-form-label-sm form-label">Additional Medical
                                                Information</label>
                                            <textarea id="inp_additionalMedical" class="form-control" rows="8"></textarea>
                                            <small id="textarea1_Help2" class="form-text text-danger">This information
                                                will <strong>NOT </strong>be shown on the instructors
                                                rollsheets.<br></small>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </section>
                    </div>
                    <div is="dmx-animate" id="ar_nsMedicalDetails1" showeffect="fadeIn" hideeffect="fadeOut" dmx-bind:visible="createStudentModal.ns_pageCounter.value == 3" dmx-hide="createStudentModal.ns_pageCounter.value != 3">
                        <section>
                            <div class="row row-cols-1">
                                <div class="col">
                                    <h4 class="mb-4 fw-bold">Review:</h4>
                                </div>
                                <div class="col pb-3 mb-3 border-bottom">
                                    <h6 class="text-uppercase fw-bold">General Information</h6>
                                    <div class="row">
                                        <div class="col">
                                            <p class="text-muted mb-0">Student Name</p>
                                            <p dmx-text="createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.value+' '+createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.value" class="mb-2 small">John Doe</p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Date of Birth</p>
                                            <p dmx-html="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.value.toDate().formatDate('dd-MM-yyyy')" class="mb-2 small">16-06-2020</p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Gender</p>
                                            <p dmx-html="ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.value" class="mb-2 small">Male</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col pb-3 mb-3 border-bottom">
                                    <h6 class="text-uppercase fw-bold">Class &amp; Level Details</h6>
                                    <div class="row">
                                        <div class="col-12">
                                            <p class="text-muted mb-0">Class Level</p>
                                            <p dmx-html="appSettings.classLevelsByID[ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.value].name" class="small">ClassLevel<br></p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Rollsheet Comments</p>
                                            <p class="mb-2 small" dmx-html="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.value">
                                                Lorem ipsum dolor sit amet.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col col pb-3 mb-3 border-bottom">
                                    <h6 class="text-uppercase fw-bold">Medical Information</h6>
                                    <div class="row">
                                        <div class="col-12">
                                            <p class="text-muted mb-0">Rollsheet Medical Information</p>
                                            <p dmx-html="ar_nsMedicalDetails.medicalInfoForm.inp_rollsheetMedical.value" class="small">Lorem ipsum dolor sit amet.<br></p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Additional Medical Information</p>
                                            <p dmx-html="ar_nsMedicalDetails.medicalInfoForm.inp_additionalMedical.value" class="small">N/A</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="col d-flex justify-content-between mt-4 pt-4 border-top">
                        <dmx-value id="var_validationNewStudent" dmx-bind:value="false"></dmx-value>
                        <button id="ns_prevButton" class="btn btn-light me-2" dmx-bind:disabled="ns_pageCounter.value == 1" dmx-on:click="ns_pageCounter.setValue(ns_pageCounter.value - 1)"><i class="bi-arrow-left me-2"></i>Previous</button>
                        <button id="ns_nextButton" class="btn text-light btn-secondary" dmx-bind:disabled="createStudentModal.ns_pageCounter.value === 3" dmx-on:click="run([{run:{action:`ns_pageCounter.setValue(ns_pageCounter.value +1)`,disabled:true}},{condition:{if:`createStudentModal.ns_pageCounter.value === 1`,then:{steps:[{run:{action:`createStudentModal.var_validationNewStudent.setValue(true)`}},{wait:{delay:500}},{run:{action:`createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.validate()`}},{wait:{delay:500}},{condition:{if:`!createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.invalid`,then:{steps:[{run:{action:`createStudentModal.ns_pageCounter.setValue((createStudentModal.ns_pageCounter.value +1))`}},{run:{action:`createStudentModal.var_validationNewStudent.setValue(false)`}}]},else:{steps:[{run:{action:`notifies1.danger(\'Please fix errors on this page before proceeding.\')`}},{run:{action:`createStudentModal.var_validationNewStudent.setValue(false)`}}]}}}]},else:{steps:{run:{action:`createStudentModal.ns_pageCounter.setValue((createStudentModal.ns_pageCounter.value +1))`}}}}}])">Next<i class="bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top">
                <div class="d-flex w-100 justify-content-end flex-column">
                    <section class="d-flex justify-content-end"><button type="submit" class="btn btn-primary" form="createStudentForm" dmx-bind:disabled="ns_pageCounter.value != 3"><i class="bi-save2 me-2"></i>Create Student
                        </button></section>
                    <form id="createStudentForm" method="post" is="dmx-serverconnect-form" action="/api/families/student/createStudent" dmx-on:success="run([{wait:{delay:300}},{run:{action:`createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.reset();createStudentModal.ar_nsMedicalDetails.medicalInfoForm.reset();createStudentModal.ar_nsMedicalDetails1.createStudentForm.reset();createStudentModal.hide();familyDetails.load()`}}])" class="text-end w-100">
                        <input id="inp_studentFamilyId" name="familyid" type="hidden" class="form-control" dmx-bind:value="query.familyid">
                        <input type="hidden" name="firstName" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.value">
                        <input type="hidden" name="lastName" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.value">
                        <input type="hidden" name="dob" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.value">
                        <input type="hidden" name="gender" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.value">
                        <input type="hidden" name="level" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.value">
                        <input type="hidden" name="rollsheetComment" dmx-bind:value="createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.value">
                        <input type="hidden" name="rollsheetMedical" dmx-bind:value="ar_nsMedicalDetails.medicalInfoForm.inp_rollsheetMedical.value">
                        <input type="hidden" name="additionalMedical" dmx-bind:value="ar_nsMedicalDetails.medicalInfoForm.inp_additionalMedical.value">
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editStudentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:show-bs-modal="query1.set('studentid',editStudentDataDetail.data.id)" dmx-on:hidden-bs-modal="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(1)">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title"><b>EDIT STUDENT:</b> {{editStudentDataDetail.data.firstName}}
                    {{editStudentDataDetail.data.lastName}}</h5>
                <button type="button" class="btn-close text-white" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body pb-0 pt-0">
                <div class="row mb-3 pb-3 ms-n3 me-n3 w-auto">
                    <div class="col-12 w-100 ps-0 pe-0 d-flex flex-column align-items-stretch">
                        <ul class="list-group list-group-horizontal d-flex">
                            <li class="list-group-item rounded-0 col-4 clickable" id="li_studentGeneralInformation1" dmx-class:active="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.value == 1" dmx-on:click="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(1)">
                                <center>General Info</center>
                            </li>
                            <li class="list-group-item col-4 clickable" id="li_studentClassDetails1" dmx-class:active="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.value == 2" dmx-on:click="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(2)">
                                <center>Class Details</center>
                            </li>
                            <li class="list-group-item rounded-0 col-4 clickable" id="li_studentMedicalInformation1" dmx-class:active="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.value == 3" dmx-on:click="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(3)">
                                <center>Medical Info</center>
                            </li>
                        </ul>
                    </div>
                </div>
                <dmx-data-detail id="editStudentDataDetail" dmx-bind:data="getStudents.data.query" key="id">
                    <form method="post" dmx-param:studentid="editStudentModal.editStudentDataDetail.data.id" action="api/editStudent" dmx-on:success="run([{wait:{delay:300}},{run:{action:`getStudents.load({familyid: query.familyid});editStudentModal.hide();editStudentModal.editStudentForm.reset()`}},{run:{action:`successNotifies.success(\'<b>Student Successfully Updated: </b>\'+editStudentModal.editStudentDataDetail.data.firstName+\' \'+editStudentModal.editStudentDataDetail.data.lastName)`}}])" is="dmx-serverconnect-form" id="editStudentForm">
                        <dmx-value id="ns_pageCounterEdit" dmx-bind:value="1"></dmx-value>
                        <input id="inp_studentID" name="studentid" type="hidden" class="form-control" dmx-bind:value="editStudentModal.editStudentForm.editStudentDataDetail.data.id">
                        <div class="row" id="ns_GeneralInfoSection1" dmx-hide="ns_pageCounterEdit.value !== 1">
                            <div class="col-12">
                                <h6 class="fw-bold border-bottom pb-1">General Information</h6>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentFirstName_edit" class="col-form-label form-label">First
                                        Name</label>
                                    <input type="text" class="form-control" id="inp_studentFirstName_edit" name="firstName" aria-describedby="input1_help" placeholder="First Name" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.firstName">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentLastName_edit" class="col-form-label form-label">Last
                                        Name</label>
                                    <input type="text" class="form-control" id="inp_studentLastName_edit" name="lastName" aria-describedby="input2_help" placeholder="Last Name" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.lastName">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentDOB_edit" class="col-form-label form-label">Date of
                                        Birth</label>
                                    <input type="date" class="form-control" id="inp_studentDOB_edit" name="dob" aria-describedby="input1_help" placeholder="Date of Birth" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.dob.formatDate('yyyy-MM-dd')">
                                </div>
                            </div>
                            <div class="d-flex col-4 offset-0">
                                <div class="mb-3" is="dmx-radio-group" id="genderInputGroup" dmx-bind:value="editStudentModal.editStudentDataDetail.data.gender">
                                    <legend class="col-form-label">Gender</legend>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input form-control-lg" type="radio" value="M" id="inp_genderMale_edit" name="gender" required="">
                                        <label class="form-check-label mt-n1" for="inp_genderMale_edit">Male</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input form-control-lg" type="radio" value="F" id="inp_genderFemale_edit" name="gender" required="">
                                        <label class="form-check-label" for="inp_genderFemale_edit">Female</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="ns_ClassDetailsSection1" dmx-hide="ns_pageCounterEdit.value !== 2">
                            <div class="col-12">
                                <h6 class="fw-bold border-bottom pb-1">Class Details</h6>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentClassLevel_edit" class="col-form-label form-label">Class
                                        Level</label>
                                    <select id="inp_studentClassLevel_edit" class="form-select" name="level" dmx-bind:options="getLevels.data.query" optiontext="name" optionvalue="id" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.level">
                                        <option selected="" value="">Choose level...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="inp_rollsheetComment_edit" class="col-form-label form-label">Rollsheet
                                        Comments (non-medical)</label>
                                    <textarea id="inp_rollsheetComment_edit" class="form-control" name="rollsheetComment" dmx-bind:value="editStudentModal.editStudentDataDetail.data.rollSheetComments"></textarea>
                                    <small class="form-text text-muted">This information will be shown on the
                                        instructors rollsheets. Please add any information the class instructor needs to
                                        know.</small>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="ns_MedicalInfoSection1" dmx-hide="ns_pageCounterEdit.value !== 3">
                            <div class="col-12">
                                <h6 class="fw-bold border-bottom pb-1">Medical Information</h6>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="inp_rollsheetMedical_edit" class="col-form-label form-label">Rollsheet
                                        Medical Information</label>
                                    <textarea id="inp_rollsheetMedical_edit" class="form-control" name="rollsheetMedical" dmx-bind:value="editStudentModal.editStudentDataDetail.data.rollSheetMedical"></textarea>
                                    <small class="form-text text-danger">This information will be shown on the
                                        instructors rollsheets. Add any important medical information the class
                                        instructor needs to
                                        know.</small>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="inp_additionalMedical_edit" class="col-form-label form-label">Additional
                                        Medical Information</label>
                                    <textarea id="inp_additionalMedical_edit" class="form-control" name="additionalMedical" dmx-bind:value="editStudentModal.editStudentDataDetail.data.additionalMedical"></textarea>
                                    <small class="form-text text-danger">This information will <b><u style=""><i>NOT</i></u> </b>be shown on the instructors
                                        rollsheets.<br></small>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3 pb-3 pt-3 border-top">
                            <div class="col d-flex justify-content-start">
                                <button id="ns_prevButton1" class="btn btn-light me-3" dmx-bind:disabled="ns_pageCounterEdit.value == 1" dmx-on:click="ns_pageCounterEdit.setValue(ns_pageCounterEdit.value - 1)">Previous</button>
                                <button id="ns_nextButton1" class="btn btn-info" dmx-bind:disabled="ns_pageCounterEdit.value == 3" dmx-on:click="ns_pageCounterEdit.setValue(ns_pageCounterEdit.value +1)">Next</button>
                            </div>
                        </div>
                    </form>
                </dmx-data-detail>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-between w-100"><button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button><button class="btn btn-primary" form="editStudentForm" dmx-on:click="editStudentDataDetail.editStudentForm.submit();familyDetails.load({familyid: query.id});getStudents.load({familyid: query.id});editStudentModal.hide()">Save
                        &amp;
                        Exit</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="getGuardianDetailsModal" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom text-white bg-secondary">
                <i class="bi-person-circle me-2 fs-4"></i>
                <h5 class="modal-title" dmx-text="getGuardianDetailsModal.dd_guardianDetails.data.firstName+' '+getGuardianDetailsModal.dd_guardianDetails.data.lastName">
                    John Doe</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <dmx-data-detail id="dd_guardianDetails" dmx-bind:data="familyDetails.data.guardians" key="uuid">
                </dmx-data-detail>
                <div class="row">
                    <div class="col mb-4">
                        <p class="mb-1 pb-1 border-bottom text-muted fw-450">Phone Numbers</p>
                        <div id="rp_guardianPhones" is="dmx-repeat" dmx-bind:repeat="dd_guardianDetails.data.phones">
                            <div class="row g-0 py-1 align-items-center">
                                <div class="col-auto">
                                    <p class="me-2 text-black-50 mb-0" dmx-text="appSettings.contactTypes[type].type">
                                        Type:</p>
                                </div>
                                <div class="col">
                                    <p dmx-text="number" class="mb-0">0123 456 789</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col">
                        <p class="mb-1 pb-1 border-bottom text-muted fw-450">Email Addresses</p>
                        <div id="rp_guardianEmails" is="dmx-repeat" dmx-bind:repeat="dd_guardianDetails.data.emails">
                            <div class="row g-0 py-1">
                                <div class="col">
                                    <a class="d-flex flex-row align-items-center text-decoration-none" href="javascript:void(0);">
                                        <i class="fas p-1 ps-0 fa-paper-plane me-2 text-decoration-none"></i>
                                        <p dmx-text="address" class="mb-0 text-decoration-underline lh-lg">
                                            qwerty@gmail.com</p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row row-cols-1">
                    <div class="col">
                        <p class="mb-2 pb-1 border-bottom text-muted fw-450">Primary Guardian</p>
                    </div>
                    <div class="col d-flex flex-row align-items-center">
                        <i class="fas fa-check-circle me-2 fa-fw" dmx-class:text-success="dd_guardianDetails.data.primary" dmx-class:text-danger="!dd_guardianDetails.data.primary" dmx-class:fa-check-circle="dd_guardianDetails.data.primary" dmx-class:fa-times-circle="!dd_guardianDetails.data.primary"></i>
                        <p dmx-text="dd_guardianDetails.data.primary === true ? 'Yes' : 'No. Edit this guardian to make them primary.'" class="mb-0">Yes</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top">
                <div class="d-flex justify-content-between w-100"><button type="button" class="btn btn-outline-primary" dmx-on:click="updateGuardianModal.guardianDetail.select(getGuardianDetailsModal.dd_guardianDetails.data.id);updateGuardianModal.show()"><i class="bi-pencil me-2"></i>Edit
                    </button><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="updateGuardianModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-fullscreen-lg-down modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-white bg-secondary">
                <h5 class="modal-title">Update Guardian:
                    {{updateGuardianModal.guardianDetail.data.firstName+' '+updateGuardianModal.guardianDetail.data.lastName}}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <dmx-data-detail dmx-bind:data="familyDetails.data.guardians" id="guardianDetail" key="uuid">
                    <h6 class="fw-bold">General Information</h6>
                    <form action="/api/families/guardians/updateGuardian" dmx-form-type="vertical" dmx-generator="bootstrap5" dmx-param:guardianid="updateGuardianModal.guardianDetail.data.id" id="guardianDetails" is="dmx-serverconnect-form" method="post" class="mb-3 pb-3 border-bottom" dmx-on:success="run([{run:{action:`familyDetails.load({familyid: query.familyid})`}},{wait:{delay:500}},{run:{action:`notifies1.success(\'Guardian \'+updateGuardianModal.guardianDetail.data.firstName+\' \'+updateGuardianModal.guardianDetail.data.lastName+\' has been successfully updated.\');updateGuardianModal.guardianDetail.guardianDetails.upd_guardSubmit_toggle.uncheck()`}}])" dmx-on:submit="upd_guardSubmit_toggle.check()" dmx-on:error="upd_guardSubmit_toggle.uncheck();notifies1.danger('Error: '+updateGuardianModal.guardianDetail.guardianDetails.lastError.status+' '+updateGuardianModal.guardianDetail.guardianDetails.lastError.message+' '+updateGuardianModal.guardianDetail.guardianDetails.lastError.response)">
                        <div class="row small">
                            <div class="col">
                                <div class="mb-3">
                                    <label class="mb-0 form-label" for="inp_firstName">First name</label>
                                    <input aria-describedby="inp_firstName_help" class="form-control" dmx-bind:value="guardianDetail.data.firstName" id="inp_firstName" name="firstName" placeholder="Enter First name" type="text">
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label class="mb-0 form-label" for="inp_lastName">Last name</label>
                                    <input aria-describedby="inp_lastName_help" class="form-control" dmx-bind:value="guardianDetail.data.lastName" id="inp_lastName" name="lastName" placeholder="Enter Last name" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="row row-cols-2 small">
                            <div class="col align-self-end d-flex align-items-stretch flex-column justify-content-end">
                                <label class="mb-0 form-label" for="inp_relationship">Relationship</label>
                                <select class="form-select" dmx-bind:options="getRelationships.data.query" dmx-bind:value="guardianDetail.data.relationship" id="inp_relationship" name="relationship" optiontext="type" optionvalue="id"></select>
                            </div>
                            <div class="col d-flex justify-content-end align-items-end">
                                <dmx-toggle id="upd_guardSubmit_toggle"></dmx-toggle>
                                <button type="submit" for="guardianDetail.guardianDetails" class="btn btn-primary" dmx-bind:disabled="updateGuardianModal.guardianDetail.guardianDetails.upd_guardSubmit_toggle.checked">
                                    <span class="spinner-border spinner-border-sm me-2" role="status" dmx-hide="!guardianDetails.upd_guardSubmit_toggle.checked">
                                    </span>
                                    Save changes
                                </button>
                            </div>
                        </div>
                    </form>
                    <div class="row" id="guardianPhones">
                        <dmx-value id="var_validationNewGuardianPhone" dmx-bind:value="false"></dmx-value>
                        <section class="position-absolute top-0 start-0 h-100 w-100 d-flex flex-column justify-content-center align-items-center bg-white visually-hidden offcanvas-validate-overlay" id="ns_validationScreen_guardianPhones" dmx-class:visually-hidden="var_validationNewGuardianPhone.value === false">
                            <div class="spinner-border text-primary" role="status">
                            </div>
                            <p class="mt-2">Validating Phone Number...</p>
                        </section>
                        <div class="col-12">
                            <div class="row mb-2">
                                <div class="col-auto align-self-center">
                                    <h6 class="fw-bold mb-0">Phone Numbers</h6>
                                </div>
                                <div class="col d-flex flex-row justify-content-end">
                                    <button id="addPhoneButton" class="btn btn-sm btn-outline-secondary" data-bs-target="#addPhoneNumberModal" dmx-on:click="dc_newPhoneNumber.toggle()" dmx-class:active="!dc_newPhoneNumber.collapsed"><i class="bi-telephone-plus me-2"></i>Add</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="collapse" id="dc_newPhoneNumber" is="dmx-bs5-collapse">
                                    <form action="/api/createGuardianPhone" id="addPhoneForm" is="dmx-serverconnect-form" method="post" class="p-3 border rounded mb-3" dmx-on:success="dc_newPhoneNumber.toggle();addPhoneForm.reset();notifies1.success('Phone created successfully.')" dmx-on:error="notifies1.danger('Status '+lastError.status+': '+lastError.message)">
                                        <h6 class="fw-bold">Create new phone number:</h6>
                                        <div class="mb-3">
                                            <label for="sel_gender" class="col-form-label form-label col-form-label-sm">Phone Number</label>
                                            <input type="hidden" name="guardianId" dmx-bind:value="guardianDetail.data.id">
                                            <input id="addPhone" name="phone" type="text" class="form-control" placeholder="Phone Number" data-msg-required="Phone number field required." required="">
                                            <label for="sel_gender" class="col-form-label form-label col-form-label-sm">Phone
                                                Type</label><select id="addContactType" class="form-select" dmx-bind:options="getContactTypes.data.contactTypes" required="" optiontext="type" optionvalue="id" name="type" data-msg-required="Phone type is required.">
                                                <option selected="" value="">Please Select...</option>
                                            </select>
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button class="btn btn-sm btn-success" dmx-on:click="run([{run:{action:`var_validationNewGuardianPhone.setValue(true)`}},{wait:{delay:100}},{run:{action:`addPhone.validate();addContactType.validate()`}},{wait:{delay:100}},{condition:{if:`addPhone.invalid || addContactType.invalid`,then:{steps:{run:{action:`notifies1.danger(\'Something went wrong. Please fix errors specified.\')`}}},else:{steps:[{run:{action:`addPhoneForm.submit()`}},{run:{action:`addPhoneForm.reset()`}},{run:{action:`familyDetails.load({familyid: query.familyId})`}}]}}},{wait:{delay:500}},{run:{action:`guardianDetail.var_validationNewGuardianPhone.setValue(false)`}}])"><i class="bi-telephone-plus-fill me-2"></i>Add Phone</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col mb-3 pb-3 border-bottom">
                            <dmx-data-detail id="dd_guardianPhoneEdit" dmx-bind:data="familyDetails.data.getGuardiansWContacts" key="id"></dmx-data-detail>
                            <div id="rp_editPhoneNumbers" is="dmx-repeat" dmx-bind:repeat="guardianDetail.data.phoneNumbersArray">
                                <form id="editPhoneForm" dmx-bind:id="editPhoneForm_{{$index}}" method="post" is="dmx-serverconnect-form" action="/api/updateGuardianPhone" dmx-param:id="id" dmx-on:keyup.enter="preventDefault()" dmx-on:success="notifies1.success('Phone updated successfully.')">
                                    <div class="row mb-1 mt-1 pb-2 pt-1 align-items-center">
                                        <dmx-value id="var_phoneIsSame" dmx-bind:id="var_phoneIsSame_{{$index}}" dmx-bind:value="editPhone.value == phone &amp;&amp; (editPhoneType.value == type) ? true : false">
                                        </dmx-value>
                                        <dmx-value id="var_originalPhone" dmx-bind:id="var_originalPhone_$index" dmx-bind:value="phone"></dmx-value>
                                        <dmx-value id="var_originalType" dmx-bind:id="var_originalType_$index" dmx-bind:value="parseInt(type)"></dmx-value>
                                        <div class="col align-self-center">
                                            <div class="mb-0">
                                                <input dmx-bind:value="id" name="id" id="editPhoneId" dmx-bind:id="editPhoneId_{{$index}}" type="hidden">
                                                <input id="editPhone" dmx-bind:id="editPhone_{{$index}}" name="phone" type="text" class="form-control" placeholder="Phone Number" required="" dmx-bind:value="phone" data-rule-digits="">
                                            </div>
                                        </div>
                                        <div class="col align-self-center">
                                            <div class="mb-0">
                                                <select id="editPhoneType" dmx-bind:id="editPhoneType_{{$index}}" class="form-select" dmx-bind:options="getContactTypes.data.contactTypes" required="" optiontext="type" optionvalue="id" name="type" dmx-bind:value="type">
                                                    <option selected="" value="" disabled="">Please Select...</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-auto d-flex flex-row align-items-center">
                                            <button id="saveGuardPhoneEdit" dmx-bind:id="saveGuardPhoneEdit_{{$index}}" class="btn btn-primary me-1" dmx-class:invisible="var_phoneIsSame.value === true" dmx-on:click="run([{run:{action:`editPhoneForm.submit()`}},{wait:{delay:200}},{run:{action:`getGuardianContactDetails.load({guardianid: dd_guardianPhoneEdit.data.id});familyDetails.load({familyid: query.id});editPhoneNumberModal.update()`}}])"><i class="bi-save"></i></button>
                                            <button id="cancelGuardPhoneEdit" dmx-bind:id="cancelGuardPhoneEdit_{{$index}}" class="btn btn-outline-secondary me-1" dmx-on:click="editPhoneForm.reset()" dmx-class:invisible="var_phoneIsSame.value === true"><i class="bi-x-circle"></i></button>
                                            <button id="deleteGuardPhone" dmx-bind:id="deleteGuardPhone_{{$index}}" class="btn ps-1 pe-1 text-danger" dmx-on:click="run({'bootbox.confirm':{title:'Hold up!',message:`\'Are you sure you want to delete &quot;\'+phone +\'&quot;\'`,then:{steps:[{run:{action:`deleteGuardianPhone.load({id: id})`}},{wait:{delay:150}},{run:{action:`familyDetails.load({familyid: query.familyId},true)`}},{run:{action:`getGuardianContactDetails.load({guardianid: guardianId})`}},{run:{action:`editPhoneNumberModal.update()`}}]}}})"><i class="far fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div id="cr_noGuardianPhones" is="dmx-if" dmx-bind:condition="guardianDetail.data.phoneNumbersArray.length < 1">
                                <section>
                                    <div class="container p-4 border rounded">
                                        <p class="mb-0 text-center">Please add a phone number for this guardian.</p>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="guardianEmails">
                        <dmx-value id="var_validationNewGuardianEmail" dmx-bind:value="false"></dmx-value>
                        <section class="position-absolute top-0 start-0 h-100 w-100 d-flex flex-column justify-content-center align-items-center bg-white visually-hidden offcanvas-validate-overlay" id="ns_validationScreen1" dmx-class:visually-hidden="var_validationNewGuardianEmail.value === false">
                            <div class="spinner-border text-primary" role="status">
                            </div>
                            <p class="mt-2">Validating Emails...</p>
                        </section>
                        <div class="col  mb-3 pb-3 border-bottom">
                            <div class="row mb-2">
                                <div class="col align-self-center">
                                    <h6 class="fw-bold mb-0">Email Addresses</h6>
                                </div>
                                <div class="col d-flex flex-row justify-content-end">
                                    <button id="addEmailButton" class="btn btn-sm btn-outline-secondary" dmx-on:click="dc_newEmailAddress.toggle()" dmx-class:active="!dc_newEmailAddress.collapsed"><i class="bi-envelope me-2"></i>Add</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="collapse" id="dc_newEmailAddress" is="dmx-bs5-collapse">
                                    <form action="/api/createGuardianEmail" id="addEmailForm" is="dmx-serverconnect-form" method="post" class="p-3 border rounded mb-3" dmx-on:success="notifies1.success('Email successfully created.');familyDetails.load({},true)" dmx-on:error="notifies1.danger('Status '+lastError.status+': '+(lastError.response.code == 'ER_DUP_ENTRY' ? 'Email already exists.' : lastError.response.code))">
                                        <div class="mb-3">
                                            <h6 class="fw-bold">Create new email address:</h6>
                                            <label for="sel_gender" class="col-form-label form-label col-form-label-sm">Email
                                                Address</label>
                                            <input type="hidden" dmx-bind:value="guardianDetail.data.id" name="guardianId">
                                            <input id="addEmail" name="address" type="text" class="form-control" placeholder="Email" required="" data-rule-email="">
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button class="btn btn-sm btn-success" dmx-on:click="run([{run:{action:`guardianDetail.var_validationNewGuardianEmail.setValue(true)`}},{wait:{delay:100}},{run:{action:`guardianDetail.dc_newEmailAddress.addEmailForm.addEmail.validate()`}},{wait:{delay:100}},{condition:{if:`guardianDetail.dc_newEmailAddress.addEmailForm.addEmail.invalid`,then:{steps:{run:{action:`notifies1.danger(\'There are errors, please fix specified information.\')`}}},else:{steps:{run:{action:`guardianDetail.dc_newEmailAddress.addEmailForm.submit();guardianDetail.dc_newEmailAddress.addEmailForm.reset();guardianDetail.dc_newEmailAddress.toggle()`}}}}},{wait:{delay:500}},{run:{action:`guardianDetail.var_validationNewGuardianEmail.setValue(false)`}}])"><i class="bi-envelope me-2"></i>Create Email
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div id="rp_editEmails" is="dmx-repeat" dmx-bind:repeat="guardianDetail.data.emailAddressesArray">
                                <form id="editEmailForm" dmx-bind:id="editEmailForm_{{$index}}" method="post" is="dmx-serverconnect-form" dmx-param:id="id" action="/api/updateGuardianEmail" dmx-on:keyup.enter="preventDefault()" autocomplete="off">
                                    <div class="row mb-1 mt-1 pb-1 pt-1 align-items-center">
                                        <dmx-value id="var_emailIsSame" dmx-bind:id="var_emailIsSame_{{$index}}" dmx-bind:value="editEmail.value == address ? true : false"></dmx-value>
                                        <dmx-value id="var_originalEmail" dmx-bind:id="var_originalEmail_$index" dmx-bind:value="address"></dmx-value>
                                        <div class="col">
                                            <div class="mb-0">
                                                <input dmx-bind:value="id" name="id" id="editEmailId" dmx-bind:id="editEmailId_{{$index}}" type="hidden">
                                                <input id="editEmail" dmx-bind:id="editEmail_{{$index}}" name="address" type="text" class="form-control" placeholder="Email Address" required="" dmx-bind:value="address">
                                            </div>
                                        </div>
                                        <div class="col-auto d-flex flex-row align-items-center">
                                            <button id="saveGuardEmailEdit" dmx-bind:id="saveGuardEmailEdit_{{$index}}" class="btn btn-primary me-1" dmx-class:invisible="var_emailIsSame.value === true" dmx-on:click="run([{run:{action:`editEmailForm.submit()`}},{wait:{delay:200}},{run:{action:`getGuardianContactDetails.load({guardianid: dd_guardianEmailEdit.data.id});familyDetails.load({familyid: query.id});editEmailModal.update()`}}])">
                                                <i class="bi-save"></i>
                                            </button>
                                            <button id="cancelGuardEmailEdit" dmx-bind:id="cancelGuardEmailEdit_{{$index}}" class="btn btn-outline-secondary me-1" dmx-on:click="editEmailForm.reset()" dmx-class:invisible="var_emailIsSame.value === true">
                                                <i class="bi-x-circle"></i>
                                            </button>
                                            <button id="deleteGuardEmail" dmx-bind:id="deleteGuardEmail_{{$index}}" class="btn ps-1 pe-1 text-danger" dmx-on:click="run({'bootbox.confirm':{title:'Hold up!',message:`\'Are you sure you want to delete &quot;\'+address +\'&quot;\'`,then:{steps:[{run:{action:`deleteGuardianEmail.load({id: id})`}},{wait:{delay:150}},{run:{action:`familyDetails.load({familyid: query.familyId},true)`}},{run:{action:`getGuardianContactDetails.load({guardianid: guardianId})`}},{run:{action:`editEmailModal.update()`}}]}}})"><i class="far fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div id="cr_noGuardianEmails" is="dmx-if" dmx-bind:condition="guardianDetail.data.emailAddressesArray.length < 1">
                                <section>
                                    <div class="container p-4 border rounded">
                                        <p class="mb-0 text-center">Please add an email address for this guardian.</p>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                    <div class="row g-0">
                        <div class="col mb-3 pb-3 border-bottom">
                            <h6 class="fw-bold">Primary Guardian Status</h6>
                            <p class="mb-1" dmx-hide="guardianDetail.isPrimaryGuardian.value">
                                <b>{{updateGuardianModal.guardianDetail.data.firstName+' '+updateGuardianModal.guardianDetail.data.lastName}}
                                </b>is <b>NOT</b>&nbsp;currently the primary guardian for this family.
                            </p>
                            <div dmx-bind:condition="!guardianDetail.isPrimaryGuardian.value" id="conditional1" is="dmx-if">
                                <button class="btn btn-sm btn-outline-primary" form="makePrimaryGuardianForm" id="makePrimaryGuardian" type="submit"><i class="bi-check-circle me-2"></i>Make
                                    Primary Guardian
                                </button>
                            </div>
                            <p class="text-danger small" dmx-hide="guardianDetail.isPrimaryGuardian.value">NB: When you
                                set a primary guardian, most emails will default to this guardian's email addresses.
                                This may be overridden in some circumstances.</p>
                            <dmx-value dmx-bind:value="guardianDetail.data.id == familyDetails.data.familyDetails.primaryGuardian ? true : false" id="isPrimaryGuardian"></dmx-value>
                            <div dmx-bind:condition="guardianDetail.isPrimaryGuardian.value" id="conditional2" is="dmx-if">
                                <p class="d-flex align-items-center mb-0">
                                    <i class="bi-check-circle-fill text-success fs-4 me-2"></i>{{updateGuardianModal.guardianDetail.data.firstName+' '+updateGuardianModal.guardianDetail.data.lastName}}
                                    is the Primary Guardian.
                                </p>
                            </div>
                            <div class="row">
                                <form id="makePrimaryGuardianForm" action="api/updateFamilyPrimaryGuardian" dmx-on:submit="run([{wait:{delay:300}},{run:{action:`familyDetails.load({familyid: query.familyid})`}}])" dmx-param:familyid="query.familyid" is="dmx-serverconnect-form" method="post">
                                    <input dmx-bind:value="guardianDetail.data.id" id="primaryGuardian" name="primaryGuardian" type="hidden" value="">
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="guardianMisc">
                        <div class="col">
                            <h6 class="fw-bold">Miscellaneous</h6>
                        </div>
                        <div class="col d-flex justify-content-end">
                            <button id="btn2" class="btn btn-outline-primary border-0 btn-sm fw-bold" data-bs-toggle="collapse" data-bs-target="#dc_guardianMiscOptions">View</button>
                        </div>
                        <div class="col-break w-100"></div>
                        <div class="col">
                            <div class="collapse" id="dc_guardianMiscOptions" is="dmx-bs5-collapse">
                                <p>Would you like to delete this guardian?</p>
                                <form id="form_ug_deleteGuardian" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deleteGuardian" dmx-on:success="run([{run:{action:`updateGuardianModal.hide()`}},{wait:{delay:250}},{run:{action:`toasts.show({message: \'The guardian \'+updateGuardianModal.guardianDetail.data.firstName+\' \'+updateGuardianModal.guardianDetail.data.lastName+\' has been successfully deleted.\', delay: 10000, title: \'Successful.\', icon: \'/assets/images/logoBadge_50x.png\'});familyDetails.load({familyid: query.familyid})`}}])">
                                    <input id="hd_del_guardianId" name="guardianid" type="hidden" class="form-control" dmx-bind:value="guardianDetail.data.id">
                                    <button class="btn btn-danger text-light" dmx-on:click="run({confirm:{message:'Are you sure you want to delete this guardian? ',then:{steps:{run:{action:`updateGuardianModal.guardianDetail.dc_guardianMiscOptions.form_ug_deleteGuardian.submit()`}}},else:{steps:{run:{action:`notifies1.info(\'Guardian deletion cancelled.\')`}}}}})" id="deleteGuardianButton">
                                        <i class="bi-trash me-2"></i>Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </dmx-data-detail>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="paymentLineItemsModal" is="dmx-bs5-modal" tabindex="-1" dmx-on:hidden-bs-modal="run([{runJS:{function:'removeMergeTable'}},{run:{action:`ledgerStorage.remove(\'paymentLineItems\');ledgerStorage.remove(\'paymentTotal\');ledgerStorage.remove(\'paymentTitle\')`}}])" dmx-on:show-bs-modal="run({runJS:{function:'initMergeTable',args:['#paymentLineItemsTable','2, 3, 4, 5, 6, 7, 8, 9, 10, 11']}})">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-fullscreen" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">{{ledgerStorage.data.paymentTitle}}</h5>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <table class="table table-bordered align-middle visually-hidden table-hover table-sm border-dark" id="paymentLineItemsTable">
                                <thead class="table-light small">
                                    <tr>
                                        <th>Student</th>
                                        <th>Class Date</th>
                                        <th>Class</th>
                                        <th>Enrolment Total</th>
                                        <th>Paid</th>
                                    </tr>
                                </thead>
                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="ledgerStorage.data.paymentLineItems" id="rp_payLineItems" class="small">
                                    <tr>
                                        <td dmx-text="studentFirst +' '+studentLast"></td>
                                        <td dmx-text="classDate.formatDate('dd MMM y')"></td>
                                        <td dmx-text="levelName+' - '+dayName.trunc(3, true, '.')+' '+startTimeDisplay+' | '+instructorFirst +' '+instructorLast.trunc(1, 'true', '.')">
                                        </td>
                                        <td dmx-text="enrolsubtotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">
                                        </td>
                                        <td dmx-text="amount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <h6>Total payment made: {{ledgerStorage.data.paymentTotal}}</h6>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="enrChargeBreakdownModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" dmx-on:show-bs-modal="run({runJS:{function:'initMergeTable',args:['#studentChargesTable']}})" dmx-on:hidden-bs-modal="run({runJS:{function:'removeMergeTable'}})">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-xxl-down" role="document">
        <div class="modal-content">
            <dmx-serverconnect id="sc_enrChargeBreakdown" noload url="/api/families/ledger/singleEnrolmentChargeBreakdown"></dmx-serverconnect>
            <div class="modal-header bg-primary text-light">
                <h5 class="modal-title">
                    {{sc_enrChargeBreakdown.data.studentClassBreakdown[0].studentInformation.firstName+' '+sc_enrChargeBreakdown.data.studentClassBreakdown[0].studentInformation.lastName}}
                    - Class Charge Breakdown
                </h5>
            </div>
            <div class="modal-body" style="/* max-width: 1600px */ /* margin: 0 auto */">
                <h5 class="fw-bold mb-3">
                    {{' Charges for: '+sc_enrChargeBreakdown.data.studentClassBreakdown[0].startofweek.formatDate('MMMM y')}}
                </h5>
                <table class="table table-bordered align-middle visually-hidden merge-table" id="studentChargesTable">
                    <thead class="small fw-bold table-light">
                        <tr>
                            <th>Week Starting</th>
                            <th>Class</th>
                            <th>Class date</th>
                            <th>Cost</th>
                            <th>Discount</th>
                            <th>Disc. value</th>
                            <th>Disc. Info</th>
                            <th>Subtotal</th>
                            <th>Family Discount</th>
                            <th>Disc. Value</th>
                            <th>Grand Total</th>
                        </tr>
                    </thead>
                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="sc_enrChargeBreakdown.data.studentClassBreakdown" id="tableRepeat1">
                        <tr>
                            <td dmx-text="startofweek.formatDate('dd MMM, y')" class="text-nowrap"></td>
                            <td dmx-text="classInformation.startTimeDisplay+' '+classLevel.name+' | '+instructorInformation.firstName+' '+instructorInformation.lastName.trunc(1, true, '.').uppercase()" class="text-nowrap"></td>
                            <td dmx-text="classDate.formatDate('ddd dd')" class="text-nowrap"></td>
                            <td dmx-text="baseRate"></td>
                            <td dmx-text="discType === 'Percentage' ? discVal + '%' : discVal"></td>
                            <td dmx-text="discAmt"></td>
                            <td dmx-text="discVal == 0 ? '' : _procedure"></td>
                            <td dmx-text="netAmt"></td>
                            <td dmx-text="fd_type === 'Percentage' ? fd_value + '%' : fd_value"></td>
                            <td dmx-text="fd_amt"></td>
                            <td dmx-text="enrolsubtotal"></td>
                        </tr>
                    </tbody>
                </table>
                <!-- <script>
                    $(function() {
                        $('#btnTableSimplify').click((e) => {
                            mergeTable();
                            var table = $('#studentChargesTable').rowMerge({
                            excludedColumns: [2,4,5,6,7,8,9,10,11],
                            });
                            table.merge();
                        });
                    });
                </script> -->
                <div class="d-flex flex-column justify-content-start align-items-start">
                    <p class="mb-1"><b>Before discounts subtotal:
                        </b>{{sc_enrChargeBreakdown.data.classBreakdown.sum('baseRate').round(2)}}</p>
                    <p class="mb-1"><b>Value of discounts applied:
                        </b>{{(sc_enrChargeBreakdown.data.classBreakdown.sum('discAmt')+sc_enrChargeBreakdown.data.classBreakdown.sum('fd_amt')).round(2)}}
                    </p>
                    <h5><b>Grand Total: </b>{{sc_enrChargeBreakdown.data.classBreakdown.sum('enrolsubtotal')}}</h5>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="createGuardianModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="var_multiform_stepper.setValue(1);newGuardianId.setValue(null);createGuardianModalForm.reset();getNewGuardEmails.reset();familyDetails.load({familyid: query.familyid});ng_guardEmails.form_emailAddress.reset();ng_guardPhones.form_phoneNumbers.reset()">
    <div class="modal-dialog modal-lg modal-fullscreen-lg-down" role="document">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title">Create Guardian</h5>
                <button type="button" class="btn-close text-white" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body overflow-x-hidden">
                <dmx-serverconnect id="ng_getGuardDetails" url="/api/families/guardians/getGuardDetails_base">
                </dmx-serverconnect>
                <dmx-value id="var_multiform_stepper" dmx-bind:value="1"></dmx-value>
                <dmx-value id="newGuardianId" dmx-on:updated="ng_getGuardDetails.load({guardianid: value})"></dmx-value>
                <div class="container" is="dmx-if" id="cr_ng_name" dmx-bind:condition="createGuardianModal.var_multiform_stepper.value === 1">
                    <h6 class="fw-bold text-uppercase">name &amp; relationship</h6>
                    <form id="createGuardianModalForm" method="post" is="dmx-serverconnect-form" action="/api/families/guardians/createGuardian" dmx-on:success="var_multiform_stepper.setValue(2);newGuardianId.setValue(createGuardianModal.cr_ng_name.createGuardianModalForm.data.newguardianid)" dmx-on:error="notifies1.danger('An error occured! - '+createGuardianModal.cr_ng_name.createGuardianModalForm.lastError.status+' '+createGuardianModal.cr_ng_name.createGuardianModalForm.lastError.message+' - '+createGuardianModal.cr_ng_name.createGuardianModalForm.lastError.response)">
                        <input id="inp_familyid" type="hidden" class="form-control" dmx-bind:value="query.familyid" name="familyid">
                        <div class="row mb-2">
                            <div class="col">
                                <div class="mb-0 form-floating">
                                    <input id="firstName" name="firstName" type="text" class="form-control" placeholder="First Name" required="" autocomplete="off"><label for="firstName">First Name</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-0 form-floating">
                                    <input id="lastName" name="lastName" type="text" class="form-control" placeholder="Last Name" required="" autocomplete="off"><label for="lastName">Last Name</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-5">
                                <div class="mb-3 form-floating">
                                    <select id="relationship" class="form-select" name="relationship" dmx-bind:options="appSettings.relationships.relationshipArray" optiontext="name" optionvalue="id" required="">
                                        <option value="">Please select...</option>
                                    </select><label for="relationship" class="mb-0 form-label col-form-label">Relationship</label>
                                </div>
                            </div>
                            <div class="col align-self-end d-flex justify-content-end">
                                <button id="createGuardBtn" class="btn btn-primary" type="submit"><i class="bi-save me-2"></i>Create &amp; Next
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div is="dmx-animate" id="ng_guardDetails" showEffect="fadeIn" hideEffect="fadeOut" dmx-bind:visible="createGuardianModal.newGuardianId.value" dmx-bind:showduration="500" class="overflow-hidden" dmx-hide="!createGuardianModal.newGuardianId.value">
                    <section>
                        <div class="container pb-2 mb-4 border-bottom" is="dmx-animate" dmx-bind:visible="createGuardianModal.newGuardianId.value">
                            <div class="row">
                                <div class="col">
                                    <h5>Guardian Details</h5>
                                    <p class="small mb-2 pb-1 border-bottom text-danger">Made a mistake? These details
                                        can be changed after you've saved the guardian.</p>
                                    <div class="row">
                                        <div class="col-auto">
                                            <p class="small text-muted mb-1">Guardian Name:</p>
                                        </div>
                                        <div class="col">
                                            <p class="small mb-1" dmx-text="ng_getGuardDetails.data.query.firstName+' '+ng_getGuardDetails.data.query.lastName">
                                                John Doe</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto">
                                            <p class="small text-muted mb-1">Relationhip:</p>
                                        </div>
                                        <div class="col">
                                            <p class="small mb-1" dmx-text="appSettings.relationships[ng_getGuardDetails.data.query.relationship].name">
                                                Cousin Twice Removed</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <div is="dmx-animate" id="ng_guardEmails" class="overflow-hidden" dmx-bind:visible="createGuardianModal.var_multiform_stepper.value === 2" dmx-bind:showduration="500" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 2" showEffect="fadeInRight" hideEffect="fadeOut" dmx-bind:hideduration="250">
                    <section>
                        <div class="container">
                            <h6 class="fw-bold text-uppercase">Email Addresses</h6>
                            <form id="form_emailAddress" is="dmx-serverconnect-form" method="post" dmx-on:error="dc_errorEmail.show()" dmx-on:success="dc_errorEmail.hide();successNotifies.success('Email created successfully.');getNewGuardEmails.load({guardianid: createGuardianModal.newGuardianId.value});form_emailAddress.reset()" action="/api/families/guardians/checkInsertEmail">
                                <div class="row mb-2">
                                    <div class="col-10">
                                        <dmx-value id="var_checkEmailStatus" dmx-bind:value="checkEmailArray.data.var_continue"></dmx-value>
                                        <dmx-array id="arr_emailAddresses"></dmx-array>
                                        <div class="row mb-3 mb-0 small">
                                            <label for="email" class="mb-0 form-label col-form-label">Email
                                                Addresses</label>
                                            <div class="col-6"><input id="email" name="emailaddress" type="email" class="form-control" placeholder="Email" data-rule-email="" required="" data-msg-required="Email required." dmx-on:blur="email.validate()"></div>
                                            <div class="col-4"><select id="sel_emailType" class="form-select" dmx-bind:options="appSettings.contactTypes.emailContactTypes" optiontext="type" optionvalue="id" style="/* width: 140px */ /* max-width: 140px */" required="" data-msg-required="Email type required." name="type">
                                                    <option disabled selected value="">Type...</option>
                                                </select></div>
                                            <div class="col-auto">
                                                <input id="hd_guardianidEmail" name="guardianid" type="hidden" class="form-control" dmx-bind:value="createGuardianModal.newGuardianId.value">
                                                <button id="addEmailToArr" class="btn btn-primary" dmx-bind:disabled="createGuardianModalForm.email.invalid || createGuardianModalForm.email.value === '' || createGuardianModalForm.sel_emailType.invalid || createGuardianModalForm.sel_emailType.value === ''" type="submit">
                                                    <i class="bi-save2"></i>
                                                </button>
                                            </div>
                                            <legend class="col-form-label col-form-label-sm">*Press the add button to
                                                add emails.</legend>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div class="collapse bg-danger text-light rounded-3" id="dc_errorEmail" is="dmx-bs5-collapse">
                                <p class="mb-0 lh-1 py-2 px-3" dmx-html="'<i class=&quot;bi-exclamation-triangle-fill me-2&quot;></i> Error:  '+form_emailAddress.lastError.status+' - '+form_emailAddress.lastError.message+' - '+form_emailAddress.lastError.response">
                                    <i class="bi-exclamation-triangle-fill me-2"></i>Error 409: Email address already
                                    exists.
                                </p>
                            </div>
                            <div class="row mt-2">
                                <dmx-serverconnect id="getNewGuardEmails" url="/api/families/guardians/getGuardEmails" dmx-param:guardianid="createGuardianModal.newGuardianId.value"></dmx-serverconnect>
                                <div class="col-12" is="dmx-if" id="cr_ng_hasemails" dmx-bind:condition="getNewGuardEmails.data.emails.hasItems()">
                                    <table class="table table-sm small">
                                        <thead class="text-uppercase fw-bold">
                                            <tr>
                                                <th>Address</th>
                                                <th>Type</th>
                                                <th scope="row"></th>
                                            </tr>
                                        </thead>
                                        <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="getNewGuardEmails.data.emails" id="emailTableRepeat">
                                            <tr>
                                                <td dmx-text="address"></td>
                                                <td dmx-text="appSettings.contactTypes[type].type"></td>
                                                <td>
                                                    <form id="form_ng_deleteEmail" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deleteEmail" dmx-on:success="getNewGuardEmails.load({guardianid: createGuardianModal.newGuardianId.value})" dmx-on:error="">
                                                        <input id="inp_ng_del_emailid" name="emailid" type="hidden" class="form-control" dmx-bind:value="id">
                                                    </form>
                                                    <a href="javascript:void(0);" class="text-danger" dmx-on:click="run({confirm:{message:'Are you sure you want to delete this email?',then:{steps:{run:{action:`form_ng_deleteEmail.submit()`}}}}})">Delete</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-12" is="dmx-if" id="cr_ng_noemails" dmx-bind:condition="!getNewGuardEmails.data.emails.hasItems()">
                                    <p class="text-center small text-danger p-4 border rounded-3">No emails added. Add
                                        emails in the form above.</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col d-flex justify-content-end"><button id="createGuardBtn1" class="btn btn-secondary" dmx-on:click="var_multiform_stepper.setValue(3)">Next<i class="bi-arrow-right ms-2"></i></button></div>
                            </div>
                        </div>
                    </section>
                </div>
                <div is="dmx-animate" id="ng_guardPhones" showEffect="fadeInRight" hideEffect="fadeOut" dmx-bind:visible="createGuardianModal.var_multiform_stepper.value === 3" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 3" dmx-bind:showduration="500" dmx-bind:hideduration="250">
                    <section>
                        <div class="container" dmx-animate-enter.duration:250="fadeInLeft" dmx-animate-leave.duration:250="fadeOutRight" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 3" dmx-show="createGuardianModal.var_multiform_stepper.value === 3">
                            <h6 class="fw-bold text-uppercase">PHONE NUMBERS</h6>
                            <div class="row">
                                <dmx-serverconnect id="getNewGardPhones" url="/api/families/guardians/getGuardPhones" dmx-param:guardianid="createGuardianModal.newGuardianId.value"></dmx-serverconnect>
                                <div class="col-12">
                                    <dmx-array id="arr_phoneNumbers"></dmx-array>
                                    <form action="/api/families/guardians/insertPhone" method="post" id="form_phoneNumbers" is="dmx-serverconnect-form" dmx-on:success="getNewGardPhones.load();form_phoneNumbers.reset()" dmx-on:error="notifies1.danger('Error: '+createGuardianModal.cr_ng_phones.form_phoneNumbers.lastError.status+': '+createGuardianModal.cr_ng_phones.form_phoneNumbers.lastError.message+' - '+createGuardianModal.cr_ng_phones.form_phoneNumbers.lastError.response)">
                                        <div class="row mb-3 mb-0 small">
                                            <label for="phone" class="mb-0 form-label col-form-label">Phone
                                                Numbers</label>
                                            <div class="col-6"><input id="phone" name="phone" type="text" class="form-control" placeholder="Phone" required="" data-rule-digits="" data-msg-required="Phone number required.">
                                            </div>
                                            <div class="col-4"><select id="sel_phoneType" class="form-select" dmx-bind:options="appSettings.contactTypes.phoneContactTypes" optionvalue="id" optiontext="type" style="" required="" data-msg-required="Phone type required." name="type">
                                                    <option disabled selected value="">Type...</option>
                                                </select></div>
                                            <div class="col-auto"><input id="inp_guardianIdPhone" name="guardianId" type="hidden" class="form-control" dmx-bind:value="createGuardianModal.newGuardianId.value">
                                                <button id="addPhoneToArr" class="btn btn-primary" dmx-on:click="arr_phoneNumbers.addUniq(createGuardianModal.phone.value)" type="submit">
                                                    <i class="bi-save2"></i>
                                                </button>
                                            </div>
                                            <div class="input-group">
                                            </div>
                                            <legend class="col-form-label col-form-label-sm">*Press the add button to
                                                add phone numbers.</legend>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-12" is="dmx-if" id="cr_ng_hasphones" dmx-bind:condition="getNewGardPhones.data.query.hasItems()">
                                    <div class="row">
                                        <div class="col">
                                            <table class="table table-sm small">
                                                <thead class="fw-bold text-uppercase">
                                                    <tr>
                                                        <th>Phone Number</th>
                                                        <th>Type</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="getNewGardPhones.data.query" id="ng_phonesTableRepeat">
                                                    <tr>
                                                        <td dmx-text="phone"></td>
                                                        <td dmx-text="appSettings.contactTypes[type].type"></td>
                                                        <td>
                                                            <form id="form_ng_deletePhone" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deletePhone" dmx-on:success="getNewGardPhones.load({guardianid: createGuardianModal.newGuardianId.value})" dmx-on:error="notifies1.danger('Error '+createGuardianModal.ng_guardPhones.form_phoneNumbers.lastError.status+': '+createGuardianModal.ng_guardPhones.form_phoneNumbers.lastError.message+' - '+createGuardianModal.ng_guardPhones.form_phoneNumbers.lastError.response)">
                                                                <input id="inp_ng_delPhoneId" name="phoneid" type="hidden" class="form-control" dmx-bind:value="id">
                                                            </form>
                                                            <button id="delPhoneNumber" class="btn btn-link text-danger btn-sm" dmx-on:click="run({confirm:{message:'Are you sure you want to delete this phone number?',then:{steps:{run:{action:`form_ng_deletePhone.submit()`}}}}})">Delete</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12" is="dmx-if" id="cr_ng_nophones" dmx-bind:condition="!getNewGardPhones.data.query.hasItems()">
                                    <p class="text-center small text-danger p-4 border rounded-3">No phone numbers
                                        added. Add phone numbers in the form above.</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col d-flex justify-content-between align-items-end">
                                    <button class="btn btn-outline-secondary" dmx-on:click="var_multiform_stepper.setValue(2)"><i class="bi-arrow-left me-2"></i>Back</button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="modal-footer d-flex justify-content-between border-top">
                <button type="button" class="btn btn-outline-danger" dmx-on:click="run({confirm:{message:'Are you sure you want to cancel? This will delete the guardian you have just created, including any emails and phone numbers added.',then:{steps:{run:{action:`createGuardianModal.form_ng_cancelDeleteGuardian.submit()`}}},name:'confirmCancelGuardian'}})" dmx-hide="!createGuardianModal.newGuardianId.value">Cancel</button>
                <form id="form_ng_cancelDeleteGuardian" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deleteGuardian" dmx-on:success="run({run:{action:`createGuardianModal.hide();toasts.show({message: \'Successfully cancelled guardian creation.\', title: \'Cancelled.\', icon: \'/assets/images/logo/purple/favicon_purple-svg.svg\'})`}})">
                    <input id="inp_delGuardId" name="guardianid" type="hidden" class="form-control" dmx-bind:disabled="!createGuardianModal.newGuardianId.value" dmx-bind:value="createGuardianModal.newGuardianId.value">
                </form>
                <button class="btn btn-primary" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 3" dmx-on:click="createGuardianModal.hide();toasts.show({message: 'Guardian successfully created. Refresh the page if you don\'t see them in the list.', delay: 10000, title: 'Success.', icon: '/assets/images/logo/purple/favicon_purple-svg.svg'})">Finish<i class="bi-check-circle ms-2"></i></button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editStudentNote" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hide-bs-modal="editNoteForm.reset();getFamilyID.remove('noteid')">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Note</h5>
                <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" dmx-param:noteid="query.noteid" id="editNoteForm" method="post" action="api/updateStudentNote" dmx-generator="bootstrap5" dmx-form-type="horizontal" dmx-on:success="run([{run:{action:`editStudentNote.hide()`}},{wait:{delay:300}},{run:{action:`familyDetails.load({familyid: query.familyid},true)`}},{run:{action:`getStudentNote_Single.reset()`}}])">
                    <input id="inp_noteid" name="noteid" type="hidden" class="form-control" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.id">
                    <div class="mb-3">
                        <label for="fam_noteContentTextArea" class="form-label">Edit Note Content</label>
                        <textarea id="noteContentTextArea" class="form-control" required="" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.content" name="content"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="fam_selectEditNotePriority" class="form-label">Priority of Note</label>
                        <select id="selectEditNotePriority" class="form-select form-select-lg" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.priority" name="priority">
                            <option value="1">Lowest</option>
                            <option value="2">Low</option>
                            <option value="3">Medium</option>
                            <option value="4">High</option>
                            <option value="5">Critical</option>
                        </select>
                        <small id="select1Help" class="form-text text-muted">Please ensure you select the correct
                            priority for the situation.</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" form="editNoteForm" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="weeklyChargeBreakdownModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg modal-fullscreen" role="document">
        <div class="modal-content">
            <dmx-serverconnect id="sc_enrChargeBreakdown1" noload="" url="/api/families/ledger/singleEnrolmentChargeBreakdown"></dmx-serverconnect>
            <div class="modal-header bg-info text-light">
                <h5 class="modal-title">
                    <font color="#6c757d"><span style="font-size: 15.75px; color: rgba(255,255,255,0.7);">{{sc_enrChargeBreakdown.data.studentInformation.firstName+' '+sc_enrChargeBreakdown.data.studentInformation.lastName}}
                            - Class Charge Breakdown<br></span></font>
                    {{sc_enrChargeBreakdown.data.classLevel.name+' - '+sc_enrChargeBreakdown.data.classInformation.dayname+' '+sc_enrChargeBreakdown.data.classInformation.startTimeDisplay+' - '+sc_enrChargeBreakdown.data.instructorInformation.firstName+' '+sc_enrChargeBreakdown.data.instructorInformation.lastName.trunc(1, true, '.').capitalize()}}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Modal body text goes here.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal pe-0 fade" id="editPhoneNumberModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="editPhoneForm.reset()">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-light">
                <h5 class="modal-title">Edit Phone Numbers:
                    {{dd_guardianPhoneEdit.data.firstName+' '+dd_guardianPhoneEdit.data.lastName}}</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="cr_noPhoneNumbers" is="dmx-if" dmx-bind:condition="getGuardianContactDetails.data.getGuardianPhones.length === 0">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal pe-0 fade" id="editEmailModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="editPhoneForm.reset()">
    <dmx-data-detail id="dd_guardianEmailEdit" dmx-bind:data="familyDetails.data.getGuardiansWContacts" key="id">
    </dmx-data-detail>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-light bg-secondary">
                <h5 class="modal-title">Edit Emails:
                    {{' '+dd_guardianEmailEdit.data.firstName+' '+dd_guardianEmailEdit.data.lastName}}</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="cr_noEmailAddresses" is="dmx-if" dmx-bind:condition="getGuardianContactDetails.data.getGuardianEmails.length === 0">
                    <section>
                        <div class="container p-4 border rounded">
                            <p class="mb-0 text-center">There are no email addresses to edit.</p>
                        </div>
                    </section>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ledger_runCharge" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-xl modal-fullscreen-xl-down modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary-main">
                <h5 class="modal-title fw-300"><i class="bi-lightning-charge-fill me-3 fs-4"></i>Run a Charge.</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body py-0 d-flex flex-column">
                <dmx-serverconnect id="tuitionquotesettings" url="/api/families/ledger/tuitionquotesettings" dmx-param:startdate="ledger_runCharge.chargePeriod_startDate.value" dmx-on:done="arr_chargePeriods.empty()" noload>
                </dmx-serverconnect>
                <dmx-serverconnect id="tuitionquote" url="/api/families/ledger/tuitionquote" noload dmx-param:familyid="query.familyid" dmx-param:periods="ledger_runCharge.arr_chargePeriods.items" dmx-on:done="run([{wait:{delay:750}},{runJS:{function:'initMergeTable',args:['.periodChargeBreakdown','3,4,5,6,7,8,9,10,11'],name:'initMergeTable'}}])" dmx-param:family_uuid="query.familyid">
                </dmx-serverconnect>
                <dmx-array id="arr_chargePeriods" dmx-on:updated="run([{run:{action:`arr_chargePeriods.sort()`}},{run:{action:`tuitionquote.reset()`}},{runJS:{function:'removeMergeTable'}}])">
                </dmx-array>
                <div class="row border-bottom mb-2 pt-3 pb-3">
                    <div class="col-auto">
                        <label for="chargePeriod_startDate" class="col-form-label pt-0 fw-600">Show Charge Periods
                            From:</label>
                        <i class="bi-question-circle-fill ms-3 clickable user-select-none" dmx-bs-popover="'<strong>Monthly Billing Cycle:</strong><br><p>If you use monthly billing cycle, 12 months of cycles will be shown, including the month chosen here.</p><strong>Sessions/Terms Billing Cycle:</strong><br><p>Session/Terms billing cycles will show all sessions from the date inputted here inclusive of any session/term this date falls in.</p><em><small>NB: Charge periods will only output students where there was an active enrolment within the month or session/term selected.</small></em>'" data-bs-trigger="hover" data-bs-placement="left" data-bs-html="true" dmx-bind:popover-title="'Charge Periods'"></i>
                        <input id="chargePeriod_startDate" name="chargePeriod_startDate " type="text" class="form-control w-auto" is="dmx-date-picker" format="MMMM - YYYY" size="25" opens="left" dmx-bind:value="dateAndTime_days.datetime.addDays((dateAndTime_days.datetime.getDate() - 1) / -1).formatDate('yyyy-MM-dd')" dmx-on:updated="tuitionquotesettings.load({})">
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-12 d-flex">
                        <div class="row row-cols-6 w-100 gx-2 gy-3 align-items-stretch pt-2 pb-2 ps-2 pe-2">
                            <div class="col" dmx-bind:for="switch_chargePeriod_{{$index}}" id="rp_chargePeriod" dmx-repeat:rp_chargeperiod="tuitionquotesettings.data.dates">
                                <dmx-toggle id="toggle_chargePeriodHidden" dmx-bind:id="toggle_chargePeriodHidden_{{$index}}" dmx-bind:checked="ledger_runCharge.arr_chargePeriods.items.contains($value)">
                                </dmx-toggle>
                                <div class="row g-0 py-1 px-2 border rounded-3 clickable" dmx-on:click="toggle_chargePeriodHidden.toggle()">
                                    <div class="col-auto d-flex align-items-center justify-content-center">
                                        <div class="form-check form-switch mb-0">
                                            <input class="form-check-input pe-none small" type="checkbox" value="" id="switch_chargePeriod" name="chargeperiod" dmx-bind:name="chargeperiod_{{$index}}" dmx-bind:id="switch_chargePeriod_{{$index}}" dmx-bind:checked="toggle_chargePeriodHidden.checked" dmx-bind:value="$value" dmx-on:updated="run({condition:{if:`switch_chargePeriod.checked`,then:{steps:{run:{action:`ledger_runCharge.arr_chargePeriods.addUniq(switch_chargePeriod.value)`}}},else:{steps:{run:{action:`ledger_runCharge.arr_chargePeriods.remove(switch_chargePeriod.value)`}}}}})">
                                        </div>
                                    </div>
                                    <div class="col align-self-center">
                                        <p class="mb-0 user-select-none lh-1 small" dmx-text="$value.formatDate('MMMM \'yy')">2021 - December</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pb-2 col-12">
                        <div class="row align-items-start row-cols-1 g-0 gy-xs-2" id="run_selectedCharges">
                            <div class="d-flex border-end flex-row justify-content-start align-items-start col-12 border rounded-3 mt-2 pt-2 pb-2 ps-2 pe-2 mt-lg-0 mb-lg-2" dmx-show="ledger_runCharge.arr_chargePeriods.count > 0">
                                <button id="btn_processSelectedCharges" class="btn align-middle btn-secondary" dmx-bind:disabled="arr_chargePeriods.count === 0" dmx-on:click="tuitionquote.load({})" dmx-hide="ledger_runCharge.tuitionquote.data.periodCharges_repeat.hasItems()"><i class="bi-arrow-down-circle me-2"></i>Get Charges
                                </button>
                                <button id="btn_resetSelectedCharges" class="btn align-middle btn-outline-danger" dmx-bind:disabled="arr_chargePeriods.count === 0" dmx-on:click="tuitionquote.reset();arr_chargePeriods.empty()" dmx-hide="!ledger_runCharge.tuitionquote.data.periodCharges_repeat.hasItems()"><i class="bi-arrow-counterclockwise me-2"></i>Reset</button>
                            </div>
                            <div class="col align-self-center order-first order-lg-1 border rounded-3" dmx-hide="arr_chargePeriods.count == 0" dmx-animate-enter.duration:250="fadeIn">
                                <div class="row g-2 mt-lg-0 mb-lg-0 mt-0 mb-0 ms-0 me-0 ps-1 pe-1 position-relative" style="overflow: hidden;" is="dmx-repeat" id="rp_selectedcharges" dmx-bind:repeat="ledger_runCharge.arr_chargePeriods.items" key="$value.replace('-', '')">
                                    <div class="col-auto mb-2" dmx-bind:id="col_selectedCharge_{{$value}}">
                                        <button id="tag_selectedCharge" class="btn btn-sm align-middle border btn-primary-main" dmx-html="$value.formatDate('MMMM - yyyy')+'<i class=&quot;bi-x ms-2 alignmiddle&quot;></i>'" dmx-on:click="arr_chargePeriods.remove($value)">Button
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row row-cols-1 gx-0 " dmx-show="ledger_runCharge.arr_chargePeriods.count === 0 &amp;&amp; !ledger_runCharge.tuitionquote.state.executing">
                            <div class="col p-3 rounded-3 mb-2 ledger-placeholder border pe-none user-select-none" style="">
                                <p class="mb-0 fw-450">Choose time periods from the list, then click "Get Charges" to
                                    generate charges for each period.</p>
                            </div>
                        </div>
                        <section id="periodCharges_output" class="pt-2">
                            <div class="row g-0">
                                <div class="col p-5 d-flex align-items-center justify-content-start" dmx-show="ledger_runCharge.tuitionquote.state.executing">
                                    <div class="spinner-border text-primary-main me-3" role="status">
                                    </div>
                                    <h4 class="mb-0">Loading Selected Charges<span is="dmx-typed" strings="..." loop="" hidecursor="" speed="10"></span></h4>
                                </div>
                            </div>
                            <div class="row g-0">
                                <div class="col">
                                    <table class="table align-middle mt-3 table-xlg" dmx-hide="ledger_runCharge.tuitionquote.state.executing || !ledger_runCharge.tuitionquote.data.periodCharges_repeat.hasItems()">
                                        <thead class="fw-bold">
                                            <tr class="border-bottom fw-400 text-muted">
                                                <th class="collapse-cell"></th>
                                                <th>Charge Period</th>
                                                <th>Grand Total</th>
                                                <th>All Discounts<i class="fas fa-question-circle ms-2 clickable user-select-none fa-sm" dmx-bs-popover="'Includes enrolment, family and holding fee discounts.'" data-bs-trigger="hover" data-bs-placement="right" data-bs-html="true" dmx-bind:popover-title="'All Discounts'"></i></th>
                                                <th>Base Rate<i class="fas fa-question-circle ms-2 clickable user-select-none fa-sm" dmx-bs-popover="'The base rate is the price of all enrolments before enrolment discounts and family discounts have been applied.'" data-bs-trigger="hover" data-bs-placement="right" data-bs-html="true" dmx-bind:popover-title="'Base Rate'"></i>
                                                </th>
                                                <th scope="row"></th>
                                            </tr>
                                        </thead>
                                        <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="ledger_runCharge.tuitionquote.data.periodCharges_repeat" id="tb_rp_familyCharge">
                                            <tr>
                                                <td class="text-end collapse-cell"><button dmx-hide="familycharges.students.length==0" id="btn_showChargeDetails" class="btn btn-link text-ledger btn-sm" dmx-on:click="dc_chargePeriodDetails.toggle()">
                                                        <i class="bi-plus-circle me-2" dmx-class:bi-plus-circle="dc_chargePeriodDetails.collapsed" dmx-class:bi-dash-circle="!dc_chargePeriodDetails.collapsed"></i>Show
                                                        Details
                                                    </button>
                                                </td>
                                                <td dmx-html="'<p class=&quot;fw-450 fs-5 mb-0&quot;>'+familycharges.chargefor+'</p>'+(familycharges.monthlychargeexists.exists == true &amp;&amp; familycharges.monthlychargeexists.status == 200 ? '<small class=&quot;fst-italic lh-1 text-danger fw-400&quot;>Monthly charge already exists. <br> Created: '+familycharges.monthlychargeexists.created.formatDate('yyyy-MM-dd')+'.</small>': familycharges.monthlychargeexists.exists == true &amp;&amp; familycharges.monthlychargeexists.status == 409 ? '<small class=&quot;lh-1 fst-italic text-danger fw-400&quot;><i class=&quot;bi-exclamation-octagon-fill text-danger me-2&quot;></i>'+familycharges.monthlychargeexists.chargeid+'</small>':'')">
                                                </td>
                                                <td dmx-hide="familycharges.students.length == 0" dmx-text="familycharges.tuitiontotals.enrolgrandtotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)" class="fs-5 fw-600">$77.50</td>
                                                <td dmx-hide="familycharges.students.length == 0" dmx-text="((familycharges.tuitiontotals.multienrol_discount + familycharges.tuitiontotals.family_discount) + familycharges.tuitiontotals.holding_fee).round(2).formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)" class="fs-5 fw-500 text-ledger">$22.50<br></td>
                                                <td dmx-hide="familycharges.students.length == 0" dmx-text="familycharges.tuitiontotals.baseRate.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)" class="fs-5 fw-350 text-muted">$100.0</td>
                                                <td dmx-hide="familycharges.students.length>0" colspan="4" class="fst-italic text-danger">No Enrolments Found</td>
                                                <td class="collapse-cell">
                                                    <div class="row" is="dmx-if" id="cr_enrolmentsExists" dmx-bind:condition="familycharges.students.length>0"><button id="btn_processCharge" class="btn btn-primary" dmx-hide="familycharges.monthlychargeexists.exists == true && familycharges.monthlychargeexists.status == 409" dmx-on:click="ledger_processCharge.var_chargedetails.setValue($value.familycharges);ledger_processCharge.form_submitCharge.inp_chargeDate.setValue(dateAndTime_days.datetime.formatDate('yyyy-MM-dd'));ledger_runCharge.hide();ledger_processCharge.show()"><i class="bi-lightning-charge-fill me-2"></i>Charge</button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="6" class="border-0 p-0">
                                                    <div class="collapse" dmx-bind:id="dc_chargePeriodDetails_{{$index}}" id="dc_chargePeriodDetails" is="dmx-bs5-collapse" style="overflow-x: auto;">
                                                        <div class="row g-0 row-cols-1" id="rp_chargestudents" is="dmx-repeat" dmx-bind:repeat="familycharges.students">
                                                            <div class="col-12 mb-3 p-3 pe-0">
                                                                <div class="row g-0 mb-1">
                                                                    <div class="col d-flex flex-row justify-content-start align-items-center">
                                                                        <i class="fas fa-child text-primary me-1 fa-fw fa-lg"></i>
                                                                        <h5 class="mb-0 fw-600 text-primary" dmx-text="firstName+' '+lastName">Student
                                                                            Name</h5>
                                                                    </div>
                                                                </div>
                                                                <div class="row g-0 pb-1 mt-2 border-bottom" id="rp_chargeweeks_header">
                                                                    <div class="col-1 align-self-center">
                                                                        <p class="mb-0 fw-600">Week Of</p>
                                                                    </div>
                                                                    <div class="col">
                                                                        <div class="row align-items-end g-0">
                                                                            <div class="col-4">
                                                                                <p class="mb-0 fw-600">Enrolment</p>
                                                                            </div>
                                                                            <div class="col">
                                                                                <p class="mb-0 fw-600">Base Rate</p>
                                                                            </div>
                                                                            <div class="col">
                                                                                <p class="mb-0 fw-600">Total Discounts
                                                                                </p>
                                                                            </div>
                                                                            <div class="col">
                                                                                <p class="mb-0 fw-600">Holding Fee</p>
                                                                            </div>
                                                                            <div class="col">
                                                                                <p class="mb-0 fw-600">Net Total</p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row g-0 pb-1 border-bottom row-cols-1 user-select-none" id="rp_chargeweeks" is="dmx-repeat" dmx-bind:repeat="enrolments">
                                                                    <div class="col py-2 border-bottom light-grey-hover">
                                                                        <div class="row g-0">
                                                                            <div class="col-1 align-self-center">
                                                                                <p class="mb-0" dmx-text="start.formatDate('dd MMM')">
                                                                                    21 March</p>
                                                                            </div>
                                                                            <div class="col">
                                                                                <div class="row g-0 align-items-center row-cols-1" id="rp_chargeweeks_item" is="dmx-repeat" dmx-bind:repeat="items">
                                                                                    <div class="col">
                                                                                        <div class="row g-0">
                                                                                            <hr class="table-divider" dmx-hide="$index == 0">
                                                                                            <div class="col-4">
                                                                                                <p class="mb-0" dmx-text="appSettings.days_array[classday]+' - '+startTimeDisplay+' '+appSettings.classLevelsByID[classlevel_uuid].name+' - '+appSettings.instructorsById[instructor_uuid].trunc_name">
                                                                                                    Wed Duckling 9:30AM
                                                                                                    - Melanie M.</p>
                                                                                            </div>
                                                                                            <div class="col">
                                                                                                <p class="mb-0" dmx-text="pricing.baseRate.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">
                                                                                                    $18.88</p>
                                                                                            </div>
                                                                                            <div class="col d-flex flex-row">
                                                                                                <i class="fas fa-question-circle me-2 fa-fw clickable" dmx-bs-popover="'<strong>Enrolment Discount:</strong> '+pricing.multienrol_discount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)+(pricing.multienrol_discount > 0 ? '<br><strong>ED Description:</strong> ' + pricing.multienrol_discount_description : '')+'<br><strong>Family Discount:</strong> '+pricing.family_discount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)+(pricing.family_discount> 0 ? '<br><strong>FD Description:</strong> ' + pricing.familydiscount_description : '')" dmx-bind:popover-title="'Discounts'" data-bs-html="true" data-bs-trigger="hover" dmx-hide="(pricing.multienrol_discount + pricing.family_discount)===0" data-bs-placement="left"></i>
                                                                                                <p class="mb-0" dmx-text="(pricing.multienrol_discount + pricing.family_discount).formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">
                                                                                                    $3.50</p>
                                                                                            </div>
                                                                                            <div class="col">
                                                                                                <p class="mb-0" dmx-text="pricing.holding_fee.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">
                                                                                                    $1.00</p>
                                                                                            </div>
                                                                                            <div class="col">
                                                                                                <p class="mb-0" dmx-text="pricing.enrolgrandtotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">
                                                                                                    $4.30</p>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top d-flex justify-content-between">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ledger_processCharge" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" dmx-on:hidden-bs-modal="form_submitCharge.reset()">
    <div class="modal-dialog modal-fullscreen-lg-down modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-white bg-primary-main">
                <h5 class="modal-title fw-300"><i class="bi-lightning-charge-fill me-2 fs-4"></i>Process Charge</h5>
            </div>
            <div class="modal-body">
                <dmx-value id="var_chargedetails"></dmx-value>
                <h4 class="fw-380 mb-3 pb-3 border-bottom" dmx-html="'<span class=&quot;fw-500&quot;>Charge for: </span>'+var_chargedetails.value.chargefor.replace(' - ',' ')">
                    <span class="fw-500">Charge for: </span> December 2021
                </h4>
                <form is="dmx-serverconnect-form" id="form_submitCharge" method="post" action="/api/families/ledger/tuitioncharge_node" dmx-generator="bootstrap5" dmx-form-type="inline" dmx-on:success="ledger_runCharge.tuitionquote.load({},true);ledger_processCharge.hide();ledger_runCharge.show();notifies1.success('Charge successfully created.')" dmx-on:error="notifies1.danger('Error '+ledger_processCharge.form_submitCharge.lastError.status+': '+ledger_processCharge.form_submitCharge.lastError.message+' - '+ledger_processCharge.form_submitCharge.lastError.response)">
                    <input class="form-control" id="inp_chargedetails" name="charge_json" placeholder="details" dmx-bind:value="ledger_processCharge.var_chargedetails.value.jsonStringify()" type="hidden">
                    <div class="row border-bottom">
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_chargeDate" class="col-form-label">Charge Date<span class="text-danger">*</span></label>
                                <input class="form-control" id="inp_chargeDate" name="charge_date" placeholder="Charge Date (dd/mm/yyyy)" dmx-bind:placeholder="'Charge Date (' + appSettings.localization_dateformat+')'" type="text" is="dmx-date-picker" dmx-bind:value="dateAndTime_days.datetime.formatDate('yyyy-MM-dd')" dmx-bind:readonly="!cb_overrideChargeDate.checked ? true : false" dmx-bind:format="appSettings.localization_dateformat.uppercase()" format="L">
                                <div class="form-check form-switch mb-0 mt-1 align-middle">
                                    <input class="form-check-input" type="checkbox" value="" id="cb_overrideChargeDate">
                                    <label class="form-check-label text-muted small" for="cb_overrideChargeDate">Override</label>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_dueDate" class="col-form-label">Due Date<span class="text-danger">*</span></label>
                                <input class="form-control" id="inp_dueDate" name="due_date" placeholder="Due Date (dd/mm/yyyy)" required="" type="text" is="dmx-date-picker" dmx-bind:format="appSettings.localization_dateformat.uppercase()" format="DD/MM/YYYY">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_title" class="col-form-label">Charge Title:</label>
                                <input class="form-control" id="inp_title" name="title" placeholder="Charge Title" dmx-bind:value="'Family Tuition Charge: ' + var_chargedetails.value.chargefor">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="mb-3">
                                <label for="ro_inp_chargeAmount" class="col-form-label">Total Charge:</label>
                                <input class="form-control" id="ro_inp_chargeAmount" dmx-bind:value="ledger_processCharge.var_chargedetails.value.totals.enrolsgrand" disabled="true" readonly="true">
                            </div>
                        </div>
                        <div class="col align-self-end d-flex flex-row justify-content-end">
                            <div class="mb-3">
                                <button type="submit" class="btn btn-primary"><i class="bi-lightning-charge-fill me-2"></i>Process Charge
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer d-flex border-top justify-content-between">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal" dmx-on:click="var_chargedetails.setValue(null);ledger_processCharge.hide();ledger_runCharge.show()">Cancel
                    Charge</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="CREATE_ABSENCE" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" dmx-on:hidden-bs-modal="form_GENERATE_ABSENCE_records.reset()">
    <dmx-data-detail id="dd_studentDetails" dmx-bind:data="familyDetails.data.students" key="uuid"></dmx-data-detail>
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom">
                <h5 class="modal-title"><i class="far fa-calendar-times me-2 fs-4 fa-fw"></i>Create Absence:&nbsp;
                    {{dd_studentDetails.data.firstName+' '+dd_studentDetails.data.lastName}}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form_GENERATE_ABSENCE_records" method="post" is="dmx-serverconnect-form" action="/api/families/student/absences/GENERATE_ABSENCE" dmx-on:reset="run([{runJS:{function:'clearformdata',args:['form_GENERATE_ABSENCE_records']}},{run:{action:`CREATE_ABSENCE.form_GENERATE_ABSENCE_records.inp_absence_start.setValue(null)`}}])">
                    <div class="row align-items-center mb-3 pb-3 border-bottom">
                        <div class="col">
                            <p class="fw-400 fs-6 mb-0">Does this absence span multiple days?</p>
                        </div>
                        <div class="col">
                            <input id="check_absence_multiple_yes" class="btn-check" type="checkbox" name="absence_multiple">
                            <label class="btn btn-outline-secondary py-2 w-100" for="check_absence_multiple_yes">Yes</label>
                        </div>
                    </div>
                    <p class="fw-500"><i class="far fa-calendar-times fa-fw me-2"></i>Absence Dates:
                    </p>
                    <div class="row mb-3 pb-3 border-bottom">
                        <div class="col">
                            <div class="floating-form mb-0">
                                <input type="text" class="form-control clickable" dmx-bind:format="familyDetails.data.times_formats.date_format" id="inp_absence_start" name="start" aria-describedby="input1_help" placeholder="Start Date" is="dmx-date-picker"><label for="inp_absence_start" class="form-label col-form-label" dmx-text="CREATE_ABSENCE.form_GENERATE_ABSENCE_records.check_absence_multiple_yes.checked ? 'Start Date:' : 'Absence Date:'">Start
                                    Date</label>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row g-0" dmx-bind:condition="CREATE_ABSENCE.form_GENERATE_ABSENCE_records.check_absence_multiple_yes.checked" is="dmx-if" id="cr_absence_dateend">
                                <div class="mb-0 floating-form">
                                    <input type="text" class="form-control clickable" dmx-bind:format="familyDetails.data.times_formats.date_format" id="inp_absence_end" name="end_date" aria-describedby="input1_help" placeholder="End Date" is="dmx-date-picker">
                                    <label for="inp_absence_end" class="form-label col-form-label">End Date:</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="fw-500"><i class="fas fa-arrow-alt-circle-up me-2 text-makeup fa-fw"></i>Makeup Details:
                    </p>
                    <div class="row align-items-center mb-4 pb-3 border-bottom">
                        <div class="col">
                            <p class="mb-0 fw-400 fs-6 mb-1">Is this absence eligible for a makeup or holding fee?</p>
                            <p class="small text-muted mb-3"><i class="fas fa-question-circle me-1"></i>&nbsp;A Holding
                                Fee discounts the enrolments tuition for that particular week. The amount is calculated
                                by your Puddle settings.</p>
                        </div>
                        <div class="col-12">
                            <div class="row">
                                <div class="col d-flex flex-column">
                                    <input type="radio" class="btn-check" name="makeup_eligible" id="rad_abs_makeup_eligible" autocomplete="off" checked value="mu" dmx-bind:disabled="appSettings.makeup_tokens_enabled == 0">
                                    <label class="btn btn-outline-secondary" for="rad_abs_makeup_eligible">Makeup
                                        Eligible</label>
                                </div>
                                <div class="col d-flex flex-column">
                                    <input type="radio" class="btn-check" name="makeup_eligible" id="rad_abs_holdingfee_eligible" autocomplete="off" value="hf" dmx-bind:disabled="holding_fees_enabled == 0">
                                    <label class="btn btn-outline-secondary" for="rad_abs_holdingfee_eligible">Holding
                                        Fee Eligible</label>
                                </div>
                                <div class="col d-flex flex-column">
                                    <input type="radio" class="btn-check" name="makeup_eligible" id="rad_abs_not_eligible" autocomplete="off" value="0">
                                    <label class="btn btn-outline-secondary" for="rad_abs_not_eligible">Neither</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row pb-4 mb-4 border-bottom">
                        <div class="col">
                            <input id="hd_inp_absence_studentuuid" name="student_uuid" type="hidden" class="form-control" dmx-bind:value="CREATE_ABSENCE.dd_studentDetails.data.uuid">
                            <input id="hd_inp_absence_end" name="end" type="hidden" class="form-control" dmx-bind:value="CREATE_ABSENCE.form_GENERATE_ABSENCE_records.cr_absence_dateend.inp_absence_end.value">
                            <button id="btn_GENERATE_ABSENCE_records" class="btn btn-primary" type="submit" dmx-bind:disabled="!CREATE_ABSENCE.form_GENERATE_ABSENCE_records.inp_absence_start.value"><i class="fas fa-redo me-2"></i>Generate Absences</button>
                        </div>
                    </div>
                </form>
                <div class="row mt-3" is="dmx-if" id="cr_absence_table_noformdata" dmx-bind:condition="form_GENERATE_ABSENCE_records.data.absences.absence_enrolments.length > 0">
                    <div class="col">
                        <div class="table-responsive">
                            <table class="table big-small table-bordered" id="generated_absence_table">
                                <thead class="table-white fw-450 text-black-50 border-bottom text-capitalize">
                                    <tr>
                                        <th style="width: 40%;">Class:</th>
                                        <th style="width: 60%;">Absences:</th>
                                    </tr>
                                </thead>
                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="CREATE_ABSENCE.form_GENERATE_ABSENCE_records.data.absences.absence_enrolments" id="tr_studentabsences">
                                    <tr>
                                        <td dmx-html="'<strong>'+appSettings.days_array[class_details.day] +'</strong><br>'+class_details.starttime +' '+appSettings.classLevelsByID[class_details.classlevel_uuid].name +'<br>'+appSettings.instructorsById[class_details.instructor].trunc_name" class="align-middle" style="white-space: nowrap;"></td>
                                        <td class="align-middle">
                                            <div class="container-fluid p-0" is="dmx-if" id="cr_hasAbsences" dmx-bind:condition="absences.length > 0">
                                                <div class="row border-bottom gx-0">
                                                    <div class="col">
                                                        <p class="m-0 fw-450 text-muted lh-lg">Date:</p>
                                                    </div>
                                                    <div class="col">
                                                        <p class="m-0 fw-450 text-muted lh-lg">Makeup:</p>
                                                    </div>
                                                    <div class="col">
                                                        <p class="m-0 fw-450 text-muted lh-lg">Holding Fee:</p>
                                                    </div>
                                                </div>
                                                <div class="row row-cols-3 align-items-center gx-0" is="dmx-repeat" id="rp_absence_generated_details" dmx-bind:repeat="absences">
                                                    <div class="col align-self-center py-2 border-bottom">
                                                        <p class="m-0" dmx-text="absence_date.formatDate(appSettings.localization_puddle_dateformat)">
                                                            21/01/2022</p>
                                                    </div>
                                                    <div class="col py-2 align-self-center border-bottom"><i class="fas fa-check-circle fa-lg fa-fw" dmx-class:fa-check-circle="makeup_eligible === true" dmx-class:text-danger="makeup_eligible !== true" dmx-class:fa-times-circle="makeup_eligible !== true" dmx-class:text-success="makeup_eligible === true"></i></div>
                                                    <div class="col py-2 align-self-center border-bottom"><i class="fas fa-check-circle fa-lg fa-fw" dmx-class:fa-check-circle="holdingfee_eligible === true" dmx-class:text-danger="holdingfee_eligible !== true" dmx-class:fa-times-circle="holdingfee_eligible !== true" dmx-class:text-success="holdingfee_eligible === true"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row g-0" is="dmx-if" id="cr_absence_table_noabsences" dmx-bind:condition="form_GENERATE_ABSENCE_records.data.absences.absence_enrolments.length === 0">
                    <div class="col p-4 border rounded-3">
                        <p class="text-danger mb-0 fw-430 text-center fs-6">This student has no enrolments that align
                            with requested absence dates.</p>
                    </div>
                </div>
                <div id="submit_absences" class="row">
                    <div class="col">
                        <form id="form_SUBMIT_ABSENCES" method="post" is="dmx-serverconnect-form" action="/api/families/student/absences/SUMBIT_ABSENCE">
                            <input id="inp_hdn_absence_submit_studentuuid" name="student_uuid" type="hidden" class="form-control" dmx-bind:value="CREATE_ABSENCE.dd_studentDetails.data.uuid">
                            <div class="row" is="dmx-repeat" id="rp_absences_submit_enrolments" dmx-bind:repeat="CREATE_ABSENCE.form_GENERATE_ABSENCE_records.data.absences.absence_enrolments">
                                <div class="col">
                                    <input id="inp_hdn_absencesubmit_enrols_enroluuid" name="" type="hidden" class="form-control" dmx-bind:name="'enrols[' + $index + '][enroluuid]'" dmx-bind:value="enroluuid">
                                    <dmx-value id="var_enrolsindex" dmx-bind:value="$index"></dmx-value>
                                    <div class="row row-cols-1" is="dmx-repeat" id="rp_absences_perenrol" dmx-bind:repeat="absences">
                                        <div class="col">
                                            <input id="inp_hdn_absencesubmit_absencedate" name="" type="hidden" class="form-control" dmx-bind:name="'enrols['+ var_enrolsindex.value + '][absences]['+$index+'][absence_date]'" dmx-bind:value="absence_date">
                                            <input id="inp_hdn_absencesubmit_makeup_token_uuid" name="" type="hidden" class="form-control" dmx-bind:name="'enrols['+ var_enrolsindex.value + '][absences]['+$index+'][makeup_token_uuid]'" dmx-bind:value="mutoken_uuid">
                                            <input id="inp_hdn_absencesubmit_makeup_eligible" name="" type="hidden" class="form-control" dmx-bind:name="'enrols['+ var_enrolsindex.value + '][absences]['+$index+'][makeup_eligible]'" dmx-bind:value="CREATE_ABSENCE.form_GENERATE_ABSENCE_records.rad_abs_not_eligible.checked ? 'false' : CREATE_ABSENCE.form_GENERATE_ABSENCE_records.rad_abs_holdingfee_eligible.checked ? 'hf' : 'mu'">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top justify-content-between">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="form_SUBMIT_ABSENCES" class="btn btn-primary" dmx-bind:disabled="">Submit
                    Absence</button>
            </div>
        </div>
    </div>
</div>
<dmx-serverconnect id="checkEmail" noload url="/api/families/checkEmail" dmx-on:success="createGuardianModalForm.arr_emailAddresses.addUniq(createGuardianModalForm.hd_emailObj.value)">
</dmx-serverconnect>
<dmx-serverconnect id="deleteGuardianPhone" url="/api/deleteGuardianPhone" noload></dmx-serverconnect>
<dmx-serverconnect id="createGuardian" url="api/createGuardian" dmx-param:familyid="query.familyid" noload="">
</dmx-serverconnect>
<dmx-serverconnect id="deleteGuardian" url="/api/families/guardians/deleteGuardian" dmx-param:guardianid="" noload="">
</dmx-serverconnect>
<dmx-serverconnect id="deleteFamily" url="/api/deleteFamily" dmx-param:familyid="" noload></dmx-serverconnect>
<dmx-serverconnect id="deleteFamilyNote" url="api/deleteFamilyNote" dmx-param:guardianid="updateGuardianModal.data_detail1.data.id" noload="" dmx-param:noteid=""></dmx-serverconnect>
<dmx-serverconnect id="updateFamily" url="api/updateFamily" dmx-param:familyid="familyDetails.data.familyDetails.id" noload="" dmx-param:family_id="query.familyid"></dmx-serverconnect>
<dmx-serverconnect id="updatePrimaryGuardian" url="api/updateFamilyPrimaryGuardian" dmx-param:familyid="query.familyid" noload=""></dmx-serverconnect>
<dmx-serverconnect id="getGuardianContactDetails" url="/api/getGuardianContactDetails" noload></dmx-serverconnect>

<dmx-serverconnect id="deleteGuardianEmail" url="/api/deleteGuardianEmail"></dmx-serverconnect>
<div class="container d-none" id="countries_states_scs">
    <dmx-serverconnect id="getCountries" url="/api/baseActions/getCountries"></dmx-serverconnect>
    <dmx-serverconnect id="getCountryStates" url="/api/baseActions/getCountryStates" noload dmx-param:countryid="" dmx-on:success="address_createModal.form_createAddress.sel_state.setValue(getstateid.data.stateid.id)">
    </dmx-serverconnect>
    <dmx-serverconnect id="getcountryid" url="/api/baseActions/google/places/get_countryid" dmx-param:country="" noload>
    </dmx-serverconnect>
    <dmx-serverconnect id="getstateid" url="/api/baseActions/google/places/get_stateid" dmx-param:country="address_createModal.form_createAddress.inp_residenceAutocomplete.components.country.long" dmx-param:state="" noload></dmx-serverconnect>
</div>
<dmx-datetime id="currentDateVariable"></dmx-datetime>
<section class="bg-white p-5 pb-0 border-bottom">
    <div class="row">
        <div class="col d-flex flex-column">
            <div class="row row-cols-1">
                <div class="col placeholder-glow">
                    <div class="row">
                        <div class="col d-flex">
                            <h2 class="mb-1 me-3 fw-500" dmx-html="'<i class=&quot;bi-people me-2&quot;></i><span class=&quot;me-3&quot;>Family:</span>'+familyDetails.data.query_family_details.firstName+' '+familyDetails.data.query_family_details.lastName">
                                <i class="bi-people me-2"></i>Family:
                            </h2>
                            <h2 class="mb-0 fw-500 placeholder" is="dmx-if" id="ch_familyname_placeholder" dmx-bind:condition="familyDetails.state.executing">Family: Family Name</h2>
                        </div>
                    </div>




                </div>
                <div class="col align-self-end d-flex flex-column justify-content-start align-items-start mb-2 pb-2 border-bottom">
                    <div class="row">
                        <div class="col" dmx-hide="!familyDetails.data.default_address">
                            <span dmx-text="familyDetails.data.default_address.unit+' '" dmx-hide="familyDetails.data.default_address.unit == '' || familyDetails.data.default_address.unit == null" class="mb-0 text-end">Unit/Suite</span>
                            <span dmx-text="familyDetails.data.default_address.street1+', '" class="mb-0 text-end">Street 1</span>
                            <span dmx-text="familyDetails.data.default_address.street2+', '" dmx-hide="familyDetails.data.default_address.street2 == '' || familyDetails.data.default_address.street2 == null" class="mb-0 text-end">Street 2</span>
                            <span dmx-text="familyDetails.data.default_address.suburb+', '" class="mb-0 text-end">Suburb</span>
                            <span dmx-text="familyDetails.data.default_address.state_name+', '+familyDetails.data.default_address.postcode+' '+familyDetails.data.default_address.country_name" class="mb-0 text-end">State, ZIP Postal Code, Country</span>
                        </div>
                        <div class="col" dmx-hide="familyDetails.data.default_address">
                            <p class="mb-0">No postal address associated with this family.</p>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">
                <div class="col-auto">
                    <p class="rounded-3 p-2 mb-0 clickable user-select-none pri-5-solid" dmx-show="familyDetails.data.query_family_details.family_note_max===5">
                        <i class="fas fa-exclamation-circle fa-fw me-1"></i>
                        <i class="fas fa-sticky-note me-2"></i>CRITICAL note found for this family.
                    </p>
                    <p class="rounded-3 p-2 mb-0 clickable user-select-none pri-4-solid" dmx-show="familyDetails.data.query_family_details.family_note_max===4">
                        <i class="fas fa-exclamation-circle fa-fw me-1"></i>
                        <i class="fas fa-sticky-note me-2"></i>High priority note found for this family.
                    </p>
                    <p class="rounded-3 p-2 mb-0 clickable user-select-none pri-3-solid" dmx-show="familyDetails.data.query_family_details.family_note_max===3">
                        <i class="fas fa-exclamation-circle fa-fw me-1"></i>
                        <i class="fas fa-sticky-note me-2"></i>Medium priority note found for this family.
                    </p>
                    <p class="rounded-3 p-2 mb-0 clickable user-select-none pri-2-solid" dmx-show="familyDetails.data.query_family_details.family_note_max<3">
                        <i class="fas fa-exclamation-circle fa-fw me-1"></i>
                        <i class="fas fa-sticky-note me-2"></i>Notes found for this family.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col mt-3 bg-white text-body d-flex justify-content-between" style="overflow: hidden;">
                    <ul class="nav detail-tabs align-items-stretch flex-row justify-content-start gx-2 text-body" id="navtabs_parent" role="tablist">
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3 active" id="navTabs1_1_tab" role="tab" aria-controls="navTabs1_1" aria-selected="true" style="" data-bs-toggle="tab" data-bs-target="#guardians" href="#guardians" dmx-on:click="var_showPartial.setValue('overview')"><i class="bi-people me-2"></i>Overview</a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3" id="navTabs1_2_tab" role="tab" aria-controls="navTabs1_2" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#ledger" dmx-on:click="var_showPartial.setValue('ledger')"><i class="bi-credit-card me-2"></i>Ledger
                            </a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3" id="navTabs1_6_tab" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#paymentinfo" dmx-on:click="var_showPartial.setValue('payment')"><i class="fab fa-stripe-s me-2"></i>Stripe</a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3" id="navTabs1_3_tab" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#emails"><i class="bi-envelope me-2"></i>Emails
                            </a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3" id="navTabs1_4_tab" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#notes" dmx-on:click="var_showPartial.setValue('notes')"><i class="far fa-sticky-note me-2"></i>Notes
                            </a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3" id="navTabs1_5_tab" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#logs" dmx-on:click="var_showPartial.setValue('logs')"><i class="fas fa-list-ol me-2 fa-sm fa-fw"></i>Logs
                            </a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link py-3 px-3" id="navTabs1_7_tab" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#advanced_tab"><i class="fas fa-user-cog me-2"></i>Adv.</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<main class="d-flex flex-grow-1 flex-column justify-content-start p-5 pt-4 pb-5 mb-5 position-relative" style="">

    <dmx-value id="var_showPartial" dmx-bind:value="'overview'"></dmx-value>
    <section is="dmx-if" id="cr_familyoverview" dmx-bind:condition="var_showPartial.value=='overview'">
        <div class="row g-0" dmx-animate-enter.duration:200.delay:200="fadeIn">
            <div class="col p-0">
                <%- await include('/partials/families/_overview', Object.assign({}, locals)) %>
            </div>
        </div>

    </section>
    <section is="dmx-if" id="cr_familyledger" dmx-bind:condition="var_showPartial.value=='ledger'">
        <div class="row g-0" dmx-animate-enter.duration:200.delay:1000="fadeIn">
            <div class="col p-0">
                <%- await include('/partials/families/_ledger', Object.assign({}, locals)) %>
            </div>
        </div>

    </section>
    <section is="dmx-if" id="cr_familypayinfo" dmx-bind:condition="var_showPartial.value=='payment'">
        <div class="row g-0" dmx-animate-enter.duration:200.delay:1000="fadeIn">
            <div class="col p-0">
                <%- await include('/partials/families/_payments', Object.assign({}, locals)) %>
            </div>
        </div>

    </section>
    <section is="dmx-if" id="cr_familynotes" dmx-bind:condition="var_showPartial.value=='notes'">
        <div class="row g-0" dmx-animate-enter.duration:200.delay:1000="fadeIn">
            <div class="col p-0">
                <%- await include('/partials/families/_notes', Object.assign({}, locals)) %>
            </div>
        </div>

    </section>
    <section is="dmx-if" id="cr_familylogs" dmx-bind:condition="var_showPartial.value=='logs'">
        <div class="row g-0" dmx-animate-enter.duration:200.delay:1000="fadeIn">
            <div class="col p-0">
                <%- await include('/partials/families/_logs', Object.assign({}, locals)) %>
            </div>
        </div>

    </section>
</main>
<script>
    // window.addEventListener('load', function (event) {
    //     tabDeeplink(location.href.replace(/\/$/, ''), 'guardians');
    // });
</script>