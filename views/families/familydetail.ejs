<!-- Wappler include head-page="layouts/layout2" is="dmx-app" id="familyDetails" appconnect="local" fontawesome_5="cdn" dmx-on:load="fl_findRelationshipName.run()" components="{dmxBootbox:{},dmxDataTraversal:{},dmxDatePicker:{},dmxBootstrap4Modal:{},dmxValidator:{},dmxFormatter:{},dmxBootstrap5Offcanvas:{},dmxCalendar:{},dmxBootstrap5Collapse:{},dmxBootstrap5Modal:{},dmxBootstrap5Navigation:{},dmxAnimateCSS:{},dmxNotifications:{},dmxPreloader:{},dmxStateManagement:{},dmxBootstrap5TableGenerator:{},dmxMasonry:{},dmxBootstrap5Tooltips:{},dmxBrowser:{},dmxMoment:{},dmxDownload:{},dmxDatastore:{},dmxBootstrap5Alert:{},dmxBootstrap5Toasts:{},dmxMediumEditor:{},dmxSummernote:{},dmxSummernoteFileUpload:{},dmxGooglePlaces:{},dmxAutocomplete:{},dmxBootstrap5Popovers:{}}" moment_2="cdn with locales" bootstrap5="local" bootstrap_icons="cdn" jquery_35="cdn" -->
<script is="dmx-flow" id="checkEmailArray" type="text/dmx-flow">{
  meta: {
    $param: [
      {type: "text", name: "email"},
      {type: "array", name: "emailArr"}
    ]
  },
  exec: {
    steps: [
      {
        assign: {value: "{{$param.email}}", name: "var_email"}
      },
      {
        condition: {
          if: "{{$param.emailArr.length > 0}}",
          then: {
            steps: {
              repeat: {
                repeat: "{{$param.emailArr}}",
                outputFields: [],
                exec: {
                  steps: {
                    condition: {
                      if: "{{$value.values().contains(var_email)}}",
                      then: {
                        steps: [
                          {
                            assign: {value: "false", name: "var_continue", output: true}
                          },
                          {
                            setGlobal: {key: "var_addemail_continue_newGuardian", value: "false"}
                          }
                        ]
                      },
                      else: {
                        steps: [
                          {
                            assign: {value: "true", name: "var_continue", output: true}
                          },
                          {
                            setGlobal: {key: "var_addemail_continue_newGuardian", value: "true"}
                          }
                        ]
                      }
                    }
                  }
                },
                name: "repeat"
              }
            }
          },
          else: {
            steps: [
              {
                assign: {value: "true", name: "var_continue", output: true}
              },
              {
                setGlobal: {key: "var_addemail_continue_newGuardian", value: "true"}
              }
            ]
          }
        }
      }
    ]
  }
}</script>
<dmx-download id="downloadFile"></dmx-download>
<dmx-session-manager id="ledgerStorage"></dmx-session-manager>
<dmx-serverconnect id="familyLedger" url="/api/families/ledger/getLedgerDetails" dmx-param:familyid="query.familyid"></dmx-serverconnect>



<meta name="ac:route" content="/families/familydetail/:familyid">

<dmx-value id="topPriorityNotes" dmx-bind:value="familyDetails.data.familyNotes[0].maxPriority == 5 ? 'Has Critical Note/s' : familyDetails.data.familyNotes[0].maxPriority == 4 ? 'Has High Priority Note/s' : familyDetails.data.familyNotes[0].maxPriority == 3 ? 'Has Medium Note/s' : 'Has Notes';">
</dmx-value>
<dmx-notifications id="successNotifies" position="bottom" closable="true" opacity="0.95" timeout="3500" extended-timeout="300" align="full"></dmx-notifications>
<dmx-query-manager id="getFamilyID"></dmx-query-manager>



<div class="section overlay" dmx-class:overlay-show="editGuardian.value === 1"></div>
<dmx-value id="editGuardian" dmx-bind:value="0"></dmx-value>
<div class="modal" id="address_createOrEdit" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <h5 class="modal-title">Create New or Edit Existing Address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body border-bottom">
                <div class="row">
                    <div class="col">
                        <button id="confirmCreateAddressBtn" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#address_createModal"><i class="bi-plus-circle me-2"></i>Create New Address
                        </button>
                    </div>
                </div>

            </div>
            <div id="addressRepeat" is="dmx-repeat" dmx-bind:repeat="familyDetails.data.addresses">
                <div class="modal-body border-bottom">
                    <div class="row">
                        <div class="col">

                            <p class="mb-1 lh-1" dmx-text="unit" dmx-hide="unit == '' || unit == null">Unit/Suite</p>
                            <p class="mb-1 lh-1" dmx-text="street1">Street 1</p>
                            <p class="mb-1 lh-1" dmx-text="street2" dmx-hide="street2 == '' || street2 == null">Street 2</p>
                            <p class="mb-1 lh-1" dmx-text="suburb">Suburb</p>
                            <p class="mb-1 lh-1" dmx-text="state_name+' '+postcode">State ZIP Postal Code</p>
                            <p class="mb-0 lh-1" dmx-text="country_name">Country</p>
                        </div>
                        <div class="d-flex justify-content-end align-items-start col-auto">
                            <button class="btn btn-sm btn-link p-0"><i class="bi-pencil me-1"></i>Edit
                            </button>

                            <form id="form_deleteAddress" is="dmx-serverconnect-form" method="post" action="/api/families/deleteAddress" dmx-bind:id="form_deleteAddress_{{$index}}" dmx-on:success="notifies1.success('Address successfully deleted.');familyDetails.load({familyid: query.familyid})" dmx-on:error="notifies1.danger('Error: '+form_deleteAddress.lastError.status+' - '+form_deleteAddress.lastError.message+' - '+form_deleteAddress.lastError.response)">
                                <input id="addressId" name="id" type="hidden" class="form-control" dmx-bind:value="id">
                                <button class="btn btn-sm btn-link p-0 ms-2 text-danger" dmx-show="familyDetails.data.addresses.length > 1" dmx-bs-tooltip="'Double click to delete.'" data-bs-trigger="hover" dmx-on:dblclick="run({'bootbox.confirm':{message:'Are you sure you want to delete this address?\n\n\n\n',title:'Confirm',then:{steps:{run:{action:`form_deleteAddress.submit()`}}}}})"><i class="bi-trash2-fill me-1"></i>Delete
                                </button>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="address_createModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" dmx-on:hidden-bs-modal="run([{run:{action:`form_createAddress.reset()`}},{run:{action:`form_createAddress.var_countryid.setValue(null)`}},{run:{action:`form_createAddress.var_stateid.setValue(null)`}},{runJS:{function:'gpReset',args:['address_createModal.form_createAddress.inp_residenceAutocomplete'],name:'resetAutocomplete'}}])">
    <div class="modal-dialog modal-lg modal-fullscreen-lg-down modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header text-light bg-secondary">
                <h5 class="modal-title">Create Address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" id="form_createAddress" method="post" action="/api/families/createAddress" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-on:success="familyDetails.load({familyid: query.familyid});address_createModal.hide();notifies1.success('Address created successfully.')" dmx-on:error="notifies1.danger('Error '+address_createModal.form_createAddress.lastError.status+': '+address_createModal.form_createAddress.lastError.message.trunc(100, true, '...')+' - '+address_createModal.form_createAddress.lastError.response)">
                    <div class="mb-3">
                        <label for="inp_residenceAutocomplete" class="form-label col-form-label">Search<i class="bi-question-circle-fill ms-2 clickable" dmx-bs-popover="'Search results, by default, are restricted to your country. You can change this in your settings or enter addresses manually.<br><br><span style=&quot;text-danger&quot;>It is not recommended to fill addresses manually, as typos and other errors can occur.</span>'" data-bs-trigger="hover" dmx-bind:popover-title="'Search restricted by default.'" data-bs-html="true"></i></label>
                        <input type="text" class="form-control" id="inp_residenceAutocomplete" aria-describedby="input1_help" placeholder="Search address" is="dmx-google-autocomplete" types="address" dmx-on:updated="getcountryid.load({country: address_createModal.form_createAddress.inp_residenceAutocomplete.components.country.long});getstateid.load({state: address_createModal.form_createAddress.inp_residenceAutocomplete.components.administrativeAreaLevel1.long})" dmx-bind:country="localization.data.localization.iso2">
                        <small id="input1_help" class="form-text text-muted">PO Boxes must be input manually.</small>
                    </div>
                    <div class="mb-2">
                        <label for="inp_unit" class="col-form-label">Apartment, unit, suite, or floor #</label>
                        <input type="text" class="form-control" id="inp_unit" name="unit" aria-describedby="inp_unit_help" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.subpremise.long" autocomplete="new-subpremise">
                    </div>


                    <div class="mb-2">
                        <label for="inp_street" class="col-form-label">Street</label>
                        <input type="text" class="form-control" id="inp_street" name="street1" aria-describedby="inp_street_help" required="" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.streetNumber.long+' '+address_createModal.form_createAddress.inp_residenceAutocomplete.components.route.long" autocomplete="new-route">
                    </div>
                    <div class="row row-cols-3">

                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_suburb" class="col-form-label">Suburb</label>
                                <input type="text" class="form-control" id="inp_suburb" name="suburb" aria-describedby="inp_suburb_help" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.locality.long" autocomplete="new-locality">
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_postcode" class="col-form-label">Postcode</label>
                                <input type="text" class="form-control" id="inp_postcode" name="postcode" aria-describedby="inp_postcode_help" dmx-bind:value="address_createModal.form_createAddress.inp_residenceAutocomplete.components.postalCode.long" autocomplete="new-postal-code">
                            </div>
                        </div>
                    </div>
                    <div class="row row-cols-3">
                        <dmx-value id="var_countryid" dmx-bind:value="getcountryid.data.countryid.id"></dmx-value>
                        <dmx-value id="var_stateid" dmx-bind:value="getstateid.data.stateid.id"></dmx-value>

                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_country" class="col-form-label">Country</label>
                                <select id="sel_country" class="form-select" name="country" dmx-bind:value="address_createModal.form_createAddress.var_countryid.value ? address_createModal.form_createAddress.var_countryid.value : appSettings.default_country" dmx-bind:options="getCountries.data.countries" optiontext="name" optionvalue="id" dmx-on:updated="run([{wait:{delay:100}},{run:{action:`getCountryStates.load({countryid: value})`}}])" dmx-bind:readonly="!form_createAddress.switch_manualAddress.checked">
                                    <option disabled selected value="" hidden>Please select...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label for="inp_state" class="col-form-label">State</label>
                                <select id="sel_state" class="form-select" name="state" dmx-bind:options="getCountryStates.data.states" optiontext="name" optionvalue="id" dmx-bind:readonly="!form_createAddress.switch_manualAddress.checked" dmx-bind:disabled="getCountryStates.data.states.length === 0" dmx-bind:value="address_createModal.form_createAddress.var_stateid.value ? address_createModal.form_createAddress.var_stateid.value : ''">
                                    <option disabled selected value="" hidden>Please select...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <input type="hidden" class="form-control" id="inp_family" name="family" aria-describedby="inp_family_help" placeholder="Enter Family" dmx-bind:value="query.familyid">
                    </div>
                    <div class="mb-3">
                        <button class="btn btn-primary" dmx-on:click="form_createAddress.submit()"><i class="bi-save2 me-2"></i>Create Address
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="createFamilyNoteModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hide-bs-modal="familyNote.reset()">
    <div class="modal-dialog modal-lg modal-fullscreen-xl-down" role="document">
        <div class="modal-content">
            <div class="modal-header text-white bg-secondary">
                <h5 class="modal-title">Create Family Note</h5>
                <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" id="familyNote" method="post" action="api/createFamilyNote" dmx-generator="bootstrap5" dmx-form-type="horizontal" dmx-on:success="run([{run:{action:`createFamilyNoteModal.hide()`}},{wait:{delay:300}},{run:{action:`familyDetails.load({familyid: query.familyid},true);toasts.show({message: \'Family note successfully created.\', title: \'Success.\', icon: \'/assets/images/logo/purple/favicon_purple-svg.svg\'})`}}])" dmx-param:familyid="query.familyid"><input id="inp_fam_noteid" name="noteid1" type="hidden" class="form-control" dmx-bind:value="query.familyid">

                    <div class="row row-cols-2 gy-3">
                        <div class="col">
                            <label for="fam_noteSubjectInput" class="form-label col-form-label">Subject<span class="fw-bold text-danger">*</span></label>
                            <input type="text" class="form-control" id="fam_noteSubjectInput" name="subject" aria-describedby="input1_help" placeholder="Add subject...">
                        </div>

                        <div class="col">
                            <label for="fam_selectEditNotePriority" class="form-label col-form-label">Priority of Note<span class="fw-bold text-danger">*</span></label>
                            <select id="fam_selectEditNotePriority" class="form-select" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.priority" name="priority">
                                <option value="1">Lowest</option>
                                <option value="2">Low</option>
                                <option value="3">Medium</option>
                                <option value="4">High</option>
                                <option value="5">Critical</option>
                            </select>
                            <small id="select1Help1" class="form-text text-muted">Please ensure you select the correct priority for the situation.</small>
                        </div>
                        <div class="col-12">
                            <label for="fam_noteContentTextArea" class="form-label col-form-label">Note Content<span class="fw-bold text-danger">*</span></label>
                            <textarea id="fam_summernoteContent" name="content" is="dmx-summernote" dmx-bind:toolbar="[['style',['style']],['font',['bold','underline','clear']],['fontname',['fontname']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture','video']],['view',['fullscreen','codeview','help']]]" required="" height="300"></textarea>
                        </div>


                    </div>

                </form>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="familyNote" class="btn btn-primary"><i class="bi-save2 me-2"></i>Save Note
                </button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="editFamilyNoteModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hide-bs-modal="editFamilyNote.reset();getFamilyID.remove('familynoteid')">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-light">
                <h5 class="modal-title">Edit Family Note</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <dmx-data-detail id="editFamilyNoteDetail" dmx-bind:data="familyDetails.data.familyNotes" key="id">
                    <form is="dmx-serverconnect-form" id="editFamilyNote" method="post" action="api/updateFamilyNote" dmx-generator="bootstrap5" dmx-form-type="horizontal" dmx-on:success="run([{run:{action:`editFamilyNoteModal.hide()`}},{wait:{delay:300}},{run:{action:`familyDetails.load({familyid: query.familyid},true);toasts.show({message: \'Family note successfully updated.\', title: \'Success.\', icon: \'/assets/images/logo/purple/favicon_purple-svg.svg\'})`}}])" dmx-param:familynoteid="query.familynoteid">


                        <input id="inp_fam_editNoteid" name="noteid" type="hidden" class="form-control" dmx-bind:value="query.familyid">
                        <div class="row gx-3">
                            <div class="col">
                                <h5 class="mb-2 pb-2 border-bottom">Note Details</h5>
                            </div>
                        </div>
                        <div class="row gx-3">
                            <div class="col d-flex flex-column justify-content-start">
                                <div class="row row-cols-2 gy-3">
                                    <div class="col">
                                        <label for="fam_editNoteSubjectInput" class="col-form-label form-label">Subject<span class="fw-bold text-danger">*</span></label>
                                        <input type="text" class="form-control" id="fam_editNoteSubjectInput" name="subject" aria-describedby="input1_help" placeholder="Add subject..." dmx-bind:value="editFamilyNoteModal.editFamilyNoteDetail.data.subject">
                                    </div>
                                    <div class="col">
                                        <label for="fam_selectEditNotePriority1" class="col-form-label form-label">*Priority of Note<span class="fw-bold text-danger">*</span></label>
                                        <select id="fam_selectEditNotePriority1" class="form-select" dmx-bind:value="editFamilyNoteModal.editFamilyNoteDetail.data.priority" name="priority">
                                            <option value="1">Lowest</option>
                                            <option value="2">Low</option>
                                            <option value="3">Medium</option>
                                            <option value="4">High</option>
                                            <option value="5">Critical</option>
                                        </select>
                                        <small id="select1Help2" class="form-text text-muted">Please ensure you select the correct priority for the situation.</small>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <label for="fam_editNoteContentTextArea" class="col-form-label form-label">Note Content<span class="fw-bold text-danger">*</span></label>
                                        <textarea id="fam_editNoteContentTextArea" name="content" is="dmx-summernote" dmx-bind:toolbar="[['style',['style']],['font',['bold','underline','clear','fontsize']],['fontname',['fontname']],['color',['forecolor','backcolor']],['para',['ul','ol','paragraph']],['table',['table']],['view',['fullscreen','codeview','help']]]" disable-drop="true" disable-grammar="true" height="300" dmx-bind:value="editFamilyNoteModal.editFamilyNoteDetail.data.content" dialogs-in-body="true" dialogs-fade="true"></textarea>
                                    </div>


                                </div>
                            </div>
                        </div>
                        <div class="row gx-3">
                            <div class="col">
                                <h5 class="mb-2 pb-2 mt-2 pt-2 border-bottom">Additional</h5>
                            </div>
                        </div>



                        <button id="deleteFamilyNoteButton" class="btn text-start btn-danger btn-sm" dmx-on:click="run({'bootbox.confirm':{title:'Are you sure?',message:'Do you really want to delete this family note? Deleted data CANNOT be recovered.',buttons:{confirm:{label:'Delete Note',className:'btn-danger'},cancel:{label:'Cancel',className:'btn-success'}},then:{steps:[{wait:{delay:300}},{run:{action:`deleteFamilyNote.load({noteid: editFamilyNoteModal.editFamilyNoteDetail.data.id});familyDetails.load({familyid: query.familyid});editFamilyNoteModal.hide()`}}]},else:{steps:{run:{action:`successNotifies.success(\'Family note was deleted successfully.\')`}}},name:'deleteFamilyNote'}})"><i class="far fa-trash-alt me-1 fa-fw"></i>DELETE</button>
                    </form>
                </dmx-data-detail>

            </div>
            <div class="modal-footer d-flex justify-content-between">
                <div class="d-flex flex-row justify-content-between w-100">

                    <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">Close</button>
                    <button type="submit" form="editFamilyNote" class="btn btn-success">Save changes</button>

                </div>



            </div>
        </div>
    </div>
</div>
<div class="modal" id="createStudentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hide-bs-modal="createStudentForm.reset()" dmx-on:show-bs-modal="ns_pageCounter.setValue(1)">
    <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 text-light bg-secondary">
                <h5 class="modal-title">Create New Student</h5>
                <button type="button" class="btn-close text-white" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row g-0">
                    <div class="col mb-3">
                        <ul class="list-group list-group-horizontal d-flex">
                            <li class="list-group-item rounded-0 col-4 active" id="li_studentGeneralInformation" dmx-class:active="createStudentModal.ns_pageCounter.value == 1">
                                <center>General Info</center>
                            </li>
                            <li class="list-group-item col-4" id="li_studentClassDetails" dmx-class:active="createStudentModal.ns_pageCounter.value == 2">
                                <center>Medical Info</center>
                            </li>
                            <li class="list-group-item rounded-0 col-4" id="li_studentMedicalInformation" dmx-class:active="createStudentModal.ns_pageCounter.value == 3">
                                <center>Review</center>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row">

                    <section class="position-absolute top-0 start-0 h-100 w-100 d-flex flex-column justify-content-center align-items-center bg-white visually-hidden offcanvas-validate-overlay" id="ns_validationScreen" dmx-class:visually-hidden="var_validationNewStudent.value === false">
                        <div class="spinner-border text-primary" role="status">
                        </div>
                        <p class="mt-2">Validating Information...</p>
                    </section>

                    <dmx-value id="ns_pageCounter" dmx-bind:value="1"></dmx-value>
                    <div is="dmx-animate" id="ar_nsGeneralInfo" showeffect="fadeIn" hideeffect="fadeOut" dmx-bind:visible="createStudentModal.ns_pageCounter.value == 1" dmx-hide="createStudentModal.ns_pageCounter.value != 1">
                        <section>
                            <form id="classAndLevelDetailsForm">
                                <div class="row row-cols-2 pb-3" id="ns_GeneralInfoSection">
                                    <div class="col-12">
                                        <h5 class="fw-bold border-bottom pb-1">General Information</h5>
                                    </div>

                                    <div class="col">
                                        <div class="mb-3 small">
                                            <label for="inp_studentFirstName" class="mb-0 col-form-label-sm form-label">First Name</label>
                                            <input type="text" class="form-control" id="inp_studentFirstName" aria-describedby="input1_help" placeholder="First Name" required="">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3 small">
                                            <label for="inp_studentLastName" class="mb-0 col-form-label-sm form-label">Last Name</label>
                                            <input type="text" class="form-control" id="inp_studentLastName" aria-describedby="input2_help" placeholder="Last Name">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3 small">
                                            <label for="inp_studentDOB" class="mb-0 col-form-label-sm form-label">Date of Birth</label>
                                            <input type="date" class="form-control" id="inp_studentDOB" aria-describedby="input1_help" placeholder="Date of Birth" required="">
                                        </div>
                                    </div>
                                    <div class="col-break w-100"></div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="sel_gender" class="mb-0 col-form-label-sm form-label">Gender</label>
                                            <select id="sel_gender" class="form-select" required="">
                                                <option selected="" value="">Select Gender...</option>
                                                <option value="F">Female</option>
                                                <option value="M">Male</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row row-cols-1" id="ns_ClassDetailsSection">
                                    <div class="col-12">
                                        <h5 class="fw-bold border-bottom pb-1">Class &amp; Level Details</h5>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="inp_studentClassLevel" class="mb-0 col-form-label-sm form-label">Class Level</label>
                                            <select id="inp_studentClassLevel" class="form-select" dmx-bind:options="getLevels.data.query" optiontext="name" optionvalue="id" required="">
                                                <option selected="" value="">Choose level...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">

                                            <label for="inp_rollsheetComment" class="mb-0 col-form-label-sm form-label">Rollsheet Comments (non-medical)</label>
                                            <textarea id="inp_rollsheetComment" class="form-control"></textarea>
                                            <small id="textarea1_Help" class="form-text text-muted">This information will be shown on the instructors rollsheets. Please add any information the class instructor needs to know.</small>
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </section>
                    </div>
                    <div is="dmx-animate" id="ar_nsMedicalDetails" showeffect="fadeIn" hideeffect="fadeOut" dmx-bind:visible="createStudentModal.ns_pageCounter.value == 2" dmx-hide="createStudentModal.ns_pageCounter.value != 2">
                        <section>
                            <form id="medicalInfoForm">
                                <div class="row" id="ns_MedicalInfoSection">
                                    <div class="col-12">
                                        <h5 class="fw-bold border-bottom pb-1">Medical Information</h5>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="inp_rollsheetMedical" class="mb-0 col-form-label-sm form-label">Rollsheet Medical Information</label>
                                            <textarea id="inp_rollsheetMedical" class="form-control" rows="4"></textarea>
                                            <small id="textarea1_Help1" class="form-text text-danger">This information will be shown on the instructors rollsheets. <br>Add any important medical information the class instructor needs to
                                                know.</small>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label for="inp_additionalMedical" class="mb-0 col-form-label-sm form-label">Additional Medical Information</label>
                                            <textarea id="inp_additionalMedical" class="form-control" rows="8"></textarea>
                                            <small id="textarea1_Help2" class="form-text text-danger">This information will <strong>NOT </strong>be shown on the instructors rollsheets.<br></small>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </section>
                    </div>
                    <div is="dmx-animate" id="ar_nsMedicalDetails1" showeffect="fadeIn" hideeffect="fadeOut" dmx-bind:visible="createStudentModal.ns_pageCounter.value == 3" dmx-hide="createStudentModal.ns_pageCounter.value != 3">
                        <section>
                            <div class="row row-cols-1">
                                <div class="col">
                                    <h4 class="mb-4 fw-bold">Review:</h4>
                                </div>
                                <div class="col pb-3 mb-3 border-bottom">

                                    <h6 class="text-uppercase fw-bold">General Information</h6>

                                    <div class="row">
                                        <div class="col">
                                            <p class="text-muted mb-0">Student Name</p>
                                            <p dmx-text="createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.value+' '+createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.value" class="mb-2 small">John Doe</p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Date of Birth</p>
                                            <p dmx-html="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.value.toDate().formatDate('dd-MM-yyyy')" class="mb-2 small">16-06-2020</p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Gender</p>
                                            <p dmx-html="ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.value" class="mb-2 small">Male</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col pb-3 mb-3 border-bottom">
                                    <h6 class="text-uppercase fw-bold">Class &amp; Level Details</h6>
                                    <div class="row">
                                        <div class="col-12">
                                            <p class="text-muted mb-0">Class Level</p>
                                            <p dmx-html="appSettings.classLevelsByID[ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.value].name" class="small">ClassLevel<br></p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Rollsheet Comments</p>
                                            <p class="mb-2 small" dmx-html="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.value">Lorem ipsum dolor sit amet.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col col pb-3 mb-3 border-bottom">
                                    <h6 class="text-uppercase fw-bold">Medical Information</h6>
                                    <div class="row">
                                        <div class="col-12">
                                            <p class="text-muted mb-0">Rollsheet Medical Information</p>
                                            <p dmx-html="ar_nsMedicalDetails.medicalInfoForm.inp_rollsheetMedical.value" class="small">Lorem ipsum dolor sit amet.<br></p>
                                        </div>
                                        <div class="col">
                                            <p class="text-muted mb-0">Additional Medical Information</p>
                                            <p dmx-html="ar_nsMedicalDetails.medicalInfoForm.inp_additionalMedical.value" class="small">N/A</p>
                                        </div>
                                    </div>

                                </div>
                            </div>



                        </section>

                    </div>
                    <div class="col d-flex justify-content-between mt-4 pt-4 border-top">
                        <dmx-value id="var_validationNewStudent" dmx-bind:value="false"></dmx-value>
                        <button id="ns_prevButton" class="btn btn-light me-2" dmx-bind:disabled="ns_pageCounter.value == 1" dmx-on:click="ns_pageCounter.setValue(ns_pageCounter.value - 1)"><i class="bi-arrow-left me-2"></i>Previous</button>
                        <button id="ns_nextButton" class="btn text-light btn-secondary" dmx-bind:disabled="createStudentModal.ns_pageCounter.value === 3" dmx-on:click="run([{run:{action:`ns_pageCounter.setValue(ns_pageCounter.value +1)`,disabled:true}},{condition:{if:`createStudentModal.ns_pageCounter.value === 1`,then:{steps:[{run:{action:`createStudentModal.var_validationNewStudent.setValue(true)`}},{wait:{delay:500}},{run:{action:`createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.validate();createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.validate()`}},{wait:{delay:500}},{condition:{if:`!createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.invalid &amp;&amp; !createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.invalid`,then:{steps:[{run:{action:`createStudentModal.ns_pageCounter.setValue((createStudentModal.ns_pageCounter.value +1))`}},{run:{action:`createStudentModal.var_validationNewStudent.setValue(false)`}}]},else:{steps:[{run:{action:`notifies1.danger(\'Please fix errors on this page before proceeding.\')`}},{run:{action:`createStudentModal.var_validationNewStudent.setValue(false)`}}]}}}]},else:{steps:{run:{action:`createStudentModal.ns_pageCounter.setValue((createStudentModal.ns_pageCounter.value +1))`}}}}}])">Next<i class="bi-arrow-right ms-2"></i>

                        </button>
                    </div>

                </div>



            </div>
            <div class="modal-footer border-top">



                <div class="d-flex w-100 justify-content-end flex-column">
                    <section class="d-flex justify-content-end"><button type="submit" class="btn btn-primary" form="createStudentForm" dmx-bind:disabled="ns_pageCounter.value != 3"><i class="bi-save2 me-2"></i>Create Student
                        </button></section>
                    <form id="createStudentForm" method="post" is="dmx-serverconnect-form" action="/api/families/student/createStudent" dmx-on:success="run([{wait:{delay:300}},{run:{action:`createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.reset();createStudentModal.ar_nsMedicalDetails.medicalInfoForm.reset();createStudentModal.ar_nsMedicalDetails1.createStudentForm.reset();createStudentModal.hide();familyDetails.load()`}}])" class="text-end w-100">



                        <input id="inp_studentFamilyId" name="familyid" type="hidden" class="form-control" dmx-bind:value="query.familyid">
                        <input type="hidden" name="firstName" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentFirstName.value">
                        <input type="hidden" name="lastName" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentLastName.value">
                        <input type="hidden" name="dob" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentDOB.value">
                        <input type="hidden" name="gender" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.sel_gender.value">
                        <input type="hidden" name="level" dmx-bind:value="ar_nsGeneralInfo.classAndLevelDetailsForm.inp_studentClassLevel.value">
                        <input type="hidden" name="rollsheetComment" dmx-bind:value="createStudentModal.ar_nsGeneralInfo.classAndLevelDetailsForm.inp_rollsheetComment.value">
                        <input type="hidden" name="rollsheetMedical" dmx-bind:value="ar_nsMedicalDetails.medicalInfoForm.inp_rollsheetMedical.value">
                        <input type="hidden" name="additionalMedical" dmx-bind:value="ar_nsMedicalDetails.medicalInfoForm.inp_additionalMedical.value">




                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editStudentModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:show-bs-modal="query1.set('studentid',editStudentDataDetail.data.id)" dmx-on:hidden-bs-modal="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(1)">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title"><b>EDIT STUDENT:</b> {{editStudentDataDetail.data.firstName}} {{editStudentDataDetail.data.lastName}}</h5>
                <button type="button" class="btn-close text-white" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body pb-0 pt-0">
                <div class="row mb-3 pb-3 ms-n3 me-n3 w-auto">
                    <div class="col-12 w-100 ps-0 pe-0 d-flex flex-column align-items-stretch">
                        <ul class="list-group list-group-horizontal d-flex">
                            <li class="list-group-item rounded-0 col-4 clickable" id="li_studentGeneralInformation1" dmx-class:active="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.value == 1" dmx-on:click="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(1)">
                                <center>General Info</center>
                            </li>
                            <li class="list-group-item col-4 clickable" id="li_studentClassDetails1" dmx-class:active="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.value == 2" dmx-on:click="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(2)">
                                <center>Class Details</center>
                            </li>
                            <li class="list-group-item rounded-0 col-4 clickable" id="li_studentMedicalInformation1" dmx-class:active="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.value == 3" dmx-on:click="editStudentDataDetail.editStudentForm.ns_pageCounterEdit.setValue(3)">
                                <center>Medical Info</center>
                            </li>
                        </ul>
                    </div>

                </div>
                <dmx-data-detail id="editStudentDataDetail" dmx-bind:data="getStudents.data.query" key="id">
                    <form method="post" dmx-param:studentid="editStudentModal.editStudentDataDetail.data.id" action="api/editStudent" dmx-on:success="run([{wait:{delay:300}},{run:{action:`getStudents.load({familyid: query.familyid});editStudentModal.hide();editStudentModal.editStudentForm.reset()`}},{run:{action:`successNotifies.success(\'<b>Student Successfully Updated: </b>\'+editStudentModal.editStudentDataDetail.data.firstName+\' \'+editStudentModal.editStudentDataDetail.data.lastName)`}}])" is="dmx-serverconnect-form" id="editStudentForm">

                        <dmx-value id="ns_pageCounterEdit" dmx-bind:value="1"></dmx-value>
                        <input id="inp_studentID" name="studentid" type="hidden" class="form-control" dmx-bind:value="editStudentModal.editStudentForm.editStudentDataDetail.data.id">

                        <div class="row" id="ns_GeneralInfoSection1" dmx-hide="ns_pageCounterEdit.value !== 1">
                            <div class="col-12">
                                <h6 class="fw-bold border-bottom pb-1">General Information</h6>

                            </div>

                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentFirstName_edit" class="col-form-label form-label">First Name</label>
                                    <input type="text" class="form-control" id="inp_studentFirstName_edit" name="firstName" aria-describedby="input1_help" placeholder="First Name" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.firstName">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentLastName_edit" class="col-form-label form-label">Last Name</label>
                                    <input type="text" class="form-control" id="inp_studentLastName_edit" name="lastName" aria-describedby="input2_help" placeholder="Last Name" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.lastName">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentDOB_edit" class="col-form-label form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="inp_studentDOB_edit" name="dob" aria-describedby="input1_help" placeholder="Date of Birth" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.dob.formatDate('yyyy-MM-dd')">
                                </div>
                            </div>
                            <div class="d-flex col-4 offset-0">
                                <div class="mb-3" is="dmx-radio-group" id="genderInputGroup" dmx-bind:value="editStudentModal.editStudentDataDetail.data.gender">
                                    <legend class="col-form-label">Gender</legend>

                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input form-control-lg" type="radio" value="M" id="inp_genderMale_edit" name="gender" required="">
                                        <label class="form-check-label mt-n1" for="inp_genderMale_edit">Male</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input form-control-lg" type="radio" value="F" id="inp_genderFemale_edit" name="gender" required="">
                                        <label class="form-check-label" for="inp_genderFemale_edit">Female</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="ns_ClassDetailsSection1" dmx-hide="ns_pageCounterEdit.value !== 2">
                            <div class="col-12">
                                <h6 class="fw-bold border-bottom pb-1">Class Details</h6>

                            </div>


                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="inp_studentClassLevel_edit" class="col-form-label form-label">Class Level</label>
                                    <select id="inp_studentClassLevel_edit" class="form-select" name="level" dmx-bind:options="getLevels.data.query" optiontext="name" optionvalue="id" required="" dmx-bind:value="editStudentModal.editStudentDataDetail.data.level">
                                        <option selected="" value="">Choose level...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col">
                                <div class="mb-3">

                                    <label for="inp_rollsheetComment_edit" class="col-form-label form-label">Rollsheet Comments (non-medical)</label>
                                    <textarea id="inp_rollsheetComment_edit" class="form-control" name="rollsheetComment" dmx-bind:value="editStudentModal.editStudentDataDetail.data.rollSheetComments"></textarea>
                                    <small class="form-text text-muted">This information will be shown on the instructors rollsheets. Please add any information the class instructor needs to know.</small>
                                </div>

                            </div>
                        </div>
                        <div class="row" id="ns_MedicalInfoSection1" dmx-hide="ns_pageCounterEdit.value !== 3">
                            <div class="col-12">
                                <h6 class="fw-bold border-bottom pb-1">Medical Information</h6>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="inp_rollsheetMedical_edit" class="col-form-label form-label">Rollsheet Medical Information</label>
                                    <textarea id="inp_rollsheetMedical_edit" class="form-control" name="rollsheetMedical" dmx-bind:value="editStudentModal.editStudentDataDetail.data.rollSheetMedical"></textarea>
                                    <small class="form-text text-danger">This information will be shown on the instructors rollsheets. Add any important medical information the class instructor needs to
                                        know.</small>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="inp_additionalMedical_edit" class="col-form-label form-label">Additional Medical Information</label>
                                    <textarea id="inp_additionalMedical_edit" class="form-control" name="additionalMedical" dmx-bind:value="editStudentModal.editStudentDataDetail.data.additionalMedical"></textarea>
                                    <small class="form-text text-danger">This information will <b><u style=""><i>NOT</i></u> </b>be shown on the instructors rollsheets.<br></small>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3 pb-3 pt-3 border-top">
                            <div class="col d-flex justify-content-start">
                                <button id="ns_prevButton1" class="btn btn-light me-3" dmx-bind:disabled="ns_pageCounterEdit.value == 1" dmx-on:click="ns_pageCounterEdit.setValue(ns_pageCounterEdit.value - 1)">Previous</button>
                                <button id="ns_nextButton1" class="btn btn-info" dmx-bind:disabled="ns_pageCounterEdit.value == 3" dmx-on:click="ns_pageCounterEdit.setValue(ns_pageCounterEdit.value +1)">Next</button>
                            </div>
                        </div>
                    </form>
                </dmx-data-detail>

            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-between w-100"><button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button><button class="btn btn-primary" form="editStudentForm" dmx-on:click="editStudentDataDetail.editStudentForm.submit();familyDetails.load({familyid: query.id});getStudents.load({familyid: query.id});editStudentModal.hide()">Save &amp;
                        Exit</button>
                </div>


            </div>
        </div>
    </div>
</div>
<div class="modal" id="getGuardianDetailsModal" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <i class="bi-person-circle me-2 fs-4"></i>
                <h5 class="modal-title" dmx-text="getGuardianDetailsModal.dd_guardianDetails.data.firstName+' '+getGuardianDetailsModal.dd_guardianDetails.data.lastName">John Doe</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <dmx-data-detail id="dd_guardianDetails" dmx-bind:data="familyDetails.data.getGuardiansWContacts" key="id"></dmx-data-detail>
                <div class="row">
                    <div class="col-12">
                        <p class="small text-muted mb-0">Primary Guardian</p>
                        <p dmx-text="dd_guardianDetails.data.primaryGuardian === dd_guardianDetails.data.id ? 'Yes' : 'No. Edit this guardian to make them primary.'">Yes</p>

                    </div>
                    <div class="col-12">
                        <p class="small mb-1 text-muted">Phone Numbers</p>
                        <div id="rp_guardianPhones" is="dmx-repeat" dmx-bind:repeat="dd_guardianDetails.data.phoneNumbersArray">
                            <div class="row g-1">
                                <div class="col-auto">
                                    <p class="me-1 text-black-50 mb-1" dmx-text="appSettings.contactTypes[type].type">Type:</p>

                                </div>
                                <div class="col">
                                    <p dmx-text="phone" class="mb-1">0123 456 789</p>

                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-12 mt-3">
                        <p class="small mb-1 text-muted">Email Addresses</p>
                        <div id="rp_guardianEmails" is="dmx-repeat" dmx-bind:repeat="dd_guardianDetails.data.emailAddressesArray">
                            <div class="row g-0">
                                <div class="col">
                                    <p dmx-text="address" class="mb-0">qwerty@gmail.com</p>
                                </div>
                                <div class="col d-flex align-items-center justify-content-end">

                                    <button id="sendEmailBtn" class="btn btn-sm btn-link"><i class="bi-chat-right-text me-1"></i>Send Email
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-between w-100"><button type="button" class="btn btn-outline-primary" dmx-on:click="updateGuardianModal.guardianDetail.select(getGuardianDetailsModal.dd_guardianDetails.data.id);updateGuardianModal.show()"><i class="bi-pencil me-2"></i>Edit
                    </button><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>


            </div>
        </div>
    </div>
</div>
<div class="modal" id="updateGuardianModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-fullscreen-lg-down modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-white bg-secondary">
                <h5 class="modal-title">Update Guardian: {{updateGuardianModal.guardianDetail.data.firstName+' '+updateGuardianModal.guardianDetail.data.lastName}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <dmx-data-detail dmx-bind:data="familyDetails.data.getGuardiansWContacts" id="guardianDetail" key="id">
                    <h6 class="fw-bold">General Information</h6>
                    <form action="/api/families/guardians/updateGuardian" dmx-form-type="vertical" dmx-generator="bootstrap5" dmx-param:guardianid="updateGuardianModal.guardianDetail.data.id" id="guardianDetails" is="dmx-serverconnect-form" method="post" class="mb-3 pb-3 border-bottom" dmx-on:success="run([{run:{action:`familyDetails.load({familyid: query.familyid})`}},{wait:{delay:500}},{run:{action:`notifies1.success(\'Guardian \'+updateGuardianModal.guardianDetail.data.firstName+\' \'+updateGuardianModal.guardianDetail.data.lastName+\' has been successfully updated.\');updateGuardianModal.guardianDetail.guardianDetails.upd_guardSubmit_toggle.uncheck()`}}])" dmx-on:submit="upd_guardSubmit_toggle.check()" dmx-on:error="upd_guardSubmit_toggle.uncheck();notifies1.danger('Error: '+updateGuardianModal.guardianDetail.guardianDetails.lastError.status+' '+updateGuardianModal.guardianDetail.guardianDetails.lastError.message+' '+updateGuardianModal.guardianDetail.guardianDetails.lastError.response)">
                        <div class="row small">
                            <div class="col">
                                <div class="mb-3">
                                    <label class="mb-0 form-label" for="inp_firstName">First name</label>
                                    <input aria-describedby="inp_firstName_help" class="form-control" dmx-bind:value="guardianDetail.data.firstName" id="inp_firstName" name="firstName" placeholder="Enter First name" type="text">
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label class="mb-0 form-label" for="inp_lastName">Last name</label>
                                    <input aria-describedby="inp_lastName_help" class="form-control" dmx-bind:value="guardianDetail.data.lastName" id="inp_lastName" name="lastName" placeholder="Enter Last name" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="row row-cols-2 small">

                            <div class="col align-self-end d-flex align-items-stretch flex-column justify-content-end">
                                <label class="mb-0 form-label" for="inp_relationship">Relationship</label>
                                <select class="form-select" dmx-bind:options="getRelationships.data.query" dmx-bind:value="guardianDetail.data.relationship" id="inp_relationship" name="relationship" optiontext="type" optionvalue="id"></select>
                            </div>
                            <div class="col d-flex justify-content-end align-items-end">
                                <dmx-toggle id="upd_guardSubmit_toggle"></dmx-toggle>
                                <button type="submit" for="guardianDetail.guardianDetails" class="btn btn-primary" dmx-bind:disabled="updateGuardianModal.guardianDetail.guardianDetails.upd_guardSubmit_toggle.checked">
                                    <span class="spinner-border spinner-border-sm me-2" role="status" dmx-hide="!guardianDetails.upd_guardSubmit_toggle.checked">
                                    </span>
                                    Save changes
                                </button>
                            </div>
                        </div>
                    </form>

                    <div class="row" id="guardianPhones">
                        <dmx-value id="var_validationNewGuardianPhone" dmx-bind:value="false"></dmx-value>
                        <section class="position-absolute top-0 start-0 h-100 w-100 d-flex flex-column justify-content-center align-items-center bg-white visually-hidden offcanvas-validate-overlay" id="ns_validationScreen_guardianPhones" dmx-class:visually-hidden="var_validationNewGuardianPhone.value === false">
                            <div class="spinner-border text-primary" role="status">
                            </div>
                            <p class="mt-2">Validating Phone Number...</p>
                        </section>
                        <div class="col-12">
                            <div class="row mb-2">
                                <div class="col-auto align-self-center">
                                    <h6 class="fw-bold mb-0">Phone Numbers</h6>
                                </div>
                                <div class="col d-flex flex-row justify-content-end">
                                    <button id="addPhoneButton" class="btn btn-sm btn-outline-secondary" data-bs-target="#addPhoneNumberModal" dmx-on:click="dc_newPhoneNumber.toggle()" dmx-class:active="!dc_newPhoneNumber.collapsed"><i class="bi-telephone-plus me-2"></i>Add</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="collapse" id="dc_newPhoneNumber" is="dmx-bs5-collapse">
                                    <form action="/api/createGuardianPhone" id="addPhoneForm" is="dmx-serverconnect-form" method="post" class="p-3 border rounded mb-3" dmx-on:success="dc_newPhoneNumber.toggle();addPhoneForm.reset();notifies1.success('Phone created successfully.')" dmx-on:error="notifies1.danger('Status '+lastError.status+': '+lastError.message)">
                                        <h6 class="fw-bold">Create new phone number:</h6>


                                        <div class="mb-3">
                                            <label for="sel_gender" class="col-form-label form-label col-form-label-sm">Phone Number</label>
                                            <input type="hidden" name="guardianId" dmx-bind:value="guardianDetail.data.id">
                                            <input id="addPhone" name="phone" type="text" class="form-control" placeholder="Phone Number" data-msg-required="Phone number field required." required="">
                                            <label for="sel_gender" class="col-form-label form-label col-form-label-sm">Phone Type</label><select id="addContactType" class="form-select" dmx-bind:options="getContactTypes.data.contactTypes" required="" optiontext="type" optionvalue="id" name="type" data-msg-required="Phone type is required.">
                                                <option selected="" value="">Please Select...</option>
                                            </select>
                                        </div>

                                        <div class="d-flex justify-content-end">
                                            <button class="btn btn-sm btn-success" dmx-on:click="run([{run:{action:`var_validationNewGuardianPhone.setValue(true)`}},{wait:{delay:100}},{run:{action:`addPhone.validate();addContactType.validate()`}},{wait:{delay:100}},{condition:{if:`addPhone.invalid || addContactType.invalid`,then:{steps:{run:{action:`notifies1.danger(\'Something went wrong. Please fix errors specified.\')`}}},else:{steps:[{run:{action:`addPhoneForm.submit()`}},{run:{action:`addPhoneForm.reset()`}},{run:{action:`familyDetails.load({familyid: query.familyId})`}}]}}},{wait:{delay:500}},{run:{action:`guardianDetail.var_validationNewGuardianPhone.setValue(false)`}}])"><i class="bi-telephone-plus-fill me-2"></i>Add Phone</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col mb-3 pb-3 border-bottom">
                            <dmx-data-detail id="dd_guardianPhoneEdit" dmx-bind:data="familyDetails.data.getGuardiansWContacts" key="id"></dmx-data-detail>
                            <div id="rp_editPhoneNumbers" is="dmx-repeat" dmx-bind:repeat="guardianDetail.data.phoneNumbersArray">

                                <form id="editPhoneForm" dmx-bind:id="editPhoneForm_{{$index}}" method="post" is="dmx-serverconnect-form" action="/api/updateGuardianPhone" dmx-param:id="id" dmx-on:keyup.enter="preventDefault()" dmx-on:success="notifies1.success('Phone updated successfully.')">
                                    <div class="row mb-1 mt-1 pb-2 pt-1 align-items-center">
                                        <dmx-value id="var_phoneIsSame" dmx-bind:id="var_phoneIsSame_{{$index}}" dmx-bind:value="editPhone.value == phone &amp;&amp; (editPhoneType.value == type) ? true : false"></dmx-value>
                                        <dmx-value id="var_originalPhone" dmx-bind:id="var_originalPhone_$index" dmx-bind:value="phone"></dmx-value>
                                        <dmx-value id="var_originalType" dmx-bind:id="var_originalType_$index" dmx-bind:value="parseInt(type)"></dmx-value>
                                        <div class="col align-self-center">
                                            <div class="mb-0">
                                                <input dmx-bind:value="id" name="id" id="editPhoneId" dmx-bind:id="editPhoneId_{{$index}}" type="hidden">
                                                <input id="editPhone" dmx-bind:id="editPhone_{{$index}}" name="phone" type="text" class="form-control" placeholder="Phone Number" required="" dmx-bind:value="phone" data-rule-digits="">
                                            </div>
                                        </div>
                                        <div class="col align-self-center">
                                            <div class="mb-0">
                                                <select id="editPhoneType" dmx-bind:id="editPhoneType_{{$index}}" class="form-select" dmx-bind:options="getContactTypes.data.contactTypes" required="" optiontext="type" optionvalue="id" name="type" dmx-bind:value="type">
                                                    <option selected="" value="" disabled="">Please Select...</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-auto d-flex flex-row align-items-center">
                                            <button id="saveGuardPhoneEdit" dmx-bind:id="saveGuardPhoneEdit_{{$index}}" class="btn btn-primary me-1" dmx-class:invisible="var_phoneIsSame.value === true" dmx-on:click="run([{run:{action:`editPhoneForm.submit()`}},{wait:{delay:200}},{run:{action:`getGuardianContactDetails.load({guardianid: dd_guardianPhoneEdit.data.id});familyDetails.load({familyid: query.id});editPhoneNumberModal.update()`}}])"><i class="bi-save"></i></button>
                                            <button id="cancelGuardPhoneEdit" dmx-bind:id="cancelGuardPhoneEdit_{{$index}}" class="btn btn-outline-secondary me-1" dmx-on:click="editPhoneForm.reset()" dmx-class:invisible="var_phoneIsSame.value === true"><i class="bi-x-circle"></i></button>
                                            <button id="deleteGuardPhone" dmx-bind:id="deleteGuardPhone_{{$index}}" class="btn ps-1 pe-1 text-danger" dmx-on:click="run({'bootbox.confirm':{title:'Hold up!',message:`\'Are you sure you want to delete &quot;\'+phone +\'&quot;\'`,then:{steps:[{run:{action:`deleteGuardianPhone.load({id: id})`}},{wait:{delay:150}},{run:{action:`familyDetails.load({familyid: query.familyId},true)`}},{run:{action:`getGuardianContactDetails.load({guardianid: guardianId})`}},{run:{action:`editPhoneNumberModal.update()`}}]}}})"><i class="far fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div id="cr_noGuardianPhones" is="dmx-if" dmx-bind:condition="guardianDetail.data.phoneNumbersArray.length < 1">
                                <section>
                                    <div class="container p-4 border rounded">
                                        <p class="mb-0 text-center">Please add a phone number for this guardian.</p>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="guardianEmails">
                        <dmx-value id="var_validationNewGuardianEmail" dmx-bind:value="false"></dmx-value>
                        <section class="position-absolute top-0 start-0 h-100 w-100 d-flex flex-column justify-content-center align-items-center bg-white visually-hidden offcanvas-validate-overlay" id="ns_validationScreen1" dmx-class:visually-hidden="var_validationNewGuardianEmail.value === false">
                            <div class="spinner-border text-primary" role="status">
                            </div>
                            <p class="mt-2">Validating Emails...</p>
                        </section>
                        <div class="col  mb-3 pb-3 border-bottom">
                            <div class="row mb-2">
                                <div class="col align-self-center">
                                    <h6 class="fw-bold mb-0">Email Addresses</h6>
                                </div>
                                <div class="col d-flex flex-row justify-content-end">
                                    <button id="addEmailButton" class="btn btn-sm btn-outline-secondary" dmx-on:click="dc_newEmailAddress.toggle()" dmx-class:active="!dc_newEmailAddress.collapsed"><i class="bi-envelope me-2"></i>Add</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="collapse" id="dc_newEmailAddress" is="dmx-bs5-collapse">
                                    <form action="/api/createGuardianEmail" id="addEmailForm" is="dmx-serverconnect-form" method="post" class="p-3 border rounded mb-3" dmx-on:success="notifies1.success('Email successfully created.');familyDetails.load({},true)" dmx-on:error="notifies1.danger('Status '+lastError.status+': '+(lastError.response.code == 'ER_DUP_ENTRY' ? 'Email already exists.' : lastError.response.code))">
                                        <div class="mb-3">
                                            <h6 class="fw-bold">Create new email address:</h6>
                                            <label for="sel_gender" class="col-form-label form-label col-form-label-sm">Email Address</label>
                                            <input type="hidden" dmx-bind:value="guardianDetail.data.id" name="guardianId">
                                            <input id="addEmail" name="address" type="text" class="form-control" placeholder="Email" required="" data-rule-email="">
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button class="btn btn-sm btn-success" dmx-on:click="run([{run:{action:`guardianDetail.var_validationNewGuardianEmail.setValue(true)`}},{wait:{delay:100}},{run:{action:`guardianDetail.dc_newEmailAddress.addEmailForm.addEmail.validate()`}},{wait:{delay:100}},{condition:{if:`guardianDetail.dc_newEmailAddress.addEmailForm.addEmail.invalid`,then:{steps:{run:{action:`notifies1.danger(\'There are errors, please fix specified information.\')`}}},else:{steps:{run:{action:`guardianDetail.dc_newEmailAddress.addEmailForm.submit();guardianDetail.dc_newEmailAddress.addEmailForm.reset();guardianDetail.dc_newEmailAddress.toggle()`}}}}},{wait:{delay:500}},{run:{action:`guardianDetail.var_validationNewGuardianEmail.setValue(false)`}}])"><i class="bi-envelope me-2"></i>Create Email
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div id="rp_editEmails" is="dmx-repeat" dmx-bind:repeat="guardianDetail.data.emailAddressesArray">
                                <form id="editEmailForm" dmx-bind:id="editEmailForm_{{$index}}" method="post" is="dmx-serverconnect-form" dmx-param:id="id" action="/api/updateGuardianEmail" dmx-on:keyup.enter="preventDefault()" autocomplete="off">
                                    <div class="row mb-1 mt-1 pb-1 pt-1 align-items-center">
                                        <dmx-value id="var_emailIsSame" dmx-bind:id="var_emailIsSame_{{$index}}" dmx-bind:value="editEmail.value == address ? true : false"></dmx-value>
                                        <dmx-value id="var_originalEmail" dmx-bind:id="var_originalEmail_$index" dmx-bind:value="address"></dmx-value>
                                        <div class="col">
                                            <div class="mb-0">
                                                <input dmx-bind:value="id" name="id" id="editEmailId" dmx-bind:id="editEmailId_{{$index}}" type="hidden">
                                                <input id="editEmail" dmx-bind:id="editEmail_{{$index}}" name="address" type="text" class="form-control" placeholder="Email Address" required="" dmx-bind:value="address">
                                            </div>
                                        </div>
                                        <div class="col-auto d-flex flex-row align-items-center">
                                            <button id="saveGuardEmailEdit" dmx-bind:id="saveGuardEmailEdit_{{$index}}" class="btn btn-primary me-1" dmx-class:invisible="var_emailIsSame.value === true" dmx-on:click="run([{run:{action:`editEmailForm.submit()`}},{wait:{delay:200}},{run:{action:`getGuardianContactDetails.load({guardianid: dd_guardianEmailEdit.data.id});familyDetails.load({familyid: query.id});editEmailModal.update()`}}])">
                                                <i class="bi-save"></i>

                                            </button>
                                            <button id="cancelGuardEmailEdit" dmx-bind:id="cancelGuardEmailEdit_{{$index}}" class="btn btn-outline-secondary me-1" dmx-on:click="editEmailForm.reset()" dmx-class:invisible="var_emailIsSame.value === true">
                                                <i class="bi-x-circle"></i>

                                            </button>
                                            <button id="deleteGuardEmail" dmx-bind:id="deleteGuardEmail_{{$index}}" class="btn ps-1 pe-1 text-danger" dmx-on:click="run({'bootbox.confirm':{title:'Hold up!',message:`\'Are you sure you want to delete &quot;\'+address +\'&quot;\'`,then:{steps:[{run:{action:`deleteGuardianEmail.load({id: id})`}},{wait:{delay:150}},{run:{action:`familyDetails.load({familyid: query.familyId},true)`}},{run:{action:`getGuardianContactDetails.load({guardianid: guardianId})`}},{run:{action:`editEmailModal.update()`}}]}}})"><i class="far fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div id="cr_noGuardianEmails" is="dmx-if" dmx-bind:condition="guardianDetail.data.emailAddressesArray.length < 1">
                                <section>
                                    <div class="container p-4 border rounded">
                                        <p class="mb-0 text-center">Please add an email address for this guardian.</p>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                    <div class="row g-0">
                        <div class="col mb-3 pb-3 border-bottom">
                            <h6 class="fw-bold">Primary Guardian Status</h6>
                            <p class="mb-1" dmx-hide="guardianDetail.isPrimaryGuardian.value"><b>{{updateGuardianModal.guardianDetail.data.firstName+' '+updateGuardianModal.guardianDetail.data.lastName}} </b>is <b>NOT</b>&nbsp;currently the primary guardian for this family.</p>
                            <div dmx-bind:condition="!guardianDetail.isPrimaryGuardian.value" id="conditional1" is="dmx-if">
                                <button class="btn btn-sm btn-outline-primary" form="makePrimaryGuardianForm" id="makePrimaryGuardian" type="submit"><i class="bi-check-circle me-2"></i>Make Primary Guardian
                                </button>
                            </div>
                            <p class="text-danger small" dmx-hide="guardianDetail.isPrimaryGuardian.value">NB: When you set a primary guardian, most emails will default to this guardian's email addresses. This may be overridden in some circumstances.</p>
                            <dmx-value dmx-bind:value="guardianDetail.data.id == familyDetails.data.familyDetails.primaryGuardian ? true : false" id="isPrimaryGuardian"></dmx-value>

                            <div dmx-bind:condition="guardianDetail.isPrimaryGuardian.value" id="conditional2" is="dmx-if">
                                <p class="d-flex align-items-center mb-0">
                                    <i class="bi-check-circle-fill text-success fs-4 me-2"></i>{{updateGuardianModal.guardianDetail.data.firstName+' '+updateGuardianModal.guardianDetail.data.lastName}} is the Primary Guardian.
                                </p>
                            </div>
                            <div class="row">
                                <form id="makePrimaryGuardianForm" action="api/updateFamilyPrimaryGuardian" dmx-on:submit="run([{wait:{delay:300}},{run:{action:`familyDetails.load({familyid: query.familyid})`}}])" dmx-param:familyid="query.familyid" is="dmx-serverconnect-form" method="post">

                                    <input dmx-bind:value="guardianDetail.data.id" id="primaryGuardian" name="primaryGuardian" type="hidden" value="">

                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="guardianMisc">
                        <div class="col">
                            <h6 class="fw-bold">Miscellaneous</h6>

                        </div>
                        <div class="col d-flex justify-content-end">
                            <button id="btn2" class="btn btn-outline-primary border-0 btn-sm fw-bold" data-bs-toggle="collapse" data-bs-target="#dc_guardianMiscOptions">View</button>
                        </div>
                        <div class="col-break w-100"></div>
                        <div class="col">
                            <div class="collapse" id="dc_guardianMiscOptions" is="dmx-bs5-collapse">
                                <p>Would you like to delete this guardian?</p>


                                <form id="form_ug_deleteGuardian" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deleteGuardian" dmx-on:success="run([{run:{action:`updateGuardianModal.hide()`}},{wait:{delay:250}},{run:{action:`toasts.show({message: \'The guardian \'+updateGuardianModal.guardianDetail.data.firstName+\' \'+updateGuardianModal.guardianDetail.data.lastName+\' has been successfully deleted.\', delay: 10000, title: \'Successful.\', icon: \'/assets/images/logoBadge_50x.png\'});familyDetails.load({familyid: query.familyid})`}}])">
                                    <input id="hd_del_guardianId" name="guardianid" type="hidden" class="form-control" dmx-bind:value="guardianDetail.data.id">
                                    <button class="btn btn-danger text-light" dmx-on:click="run({confirm:{message:'Are you sure you want to delete this guardian? ',then:{steps:{run:{action:`updateGuardianModal.guardianDetail.dc_guardianMiscOptions.form_ug_deleteGuardian.submit()`}}},else:{steps:{run:{action:`notifies1.info(\'Guardian deletion cancelled.\')`}}}}})" id="deleteGuardianButton">
                                        <i class="bi-trash me-2"></i>Delete
                                    </button>
                                </form>
                            </div>
                        </div>


                    </div>
                </dmx-data-detail>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>


            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="paymentLineItemsModal" is="dmx-bs5-modal" tabindex="-1" dmx-on:hidden-bs-modal="run([{runJS:{function:'removeMergeTable'}},{run:{action:`ledgerStorage.remove(\'paymentLineItems\');ledgerStorage.remove(\'paymentTotal\');ledgerStorage.remove(\'paymentTitle\')`}}])" dmx-on:show-bs-modal="run({runJS:{function:'initMergeTable',args:['#paymentLineItemsTable','2, 3, 4, 5, 6, 7, 8, 9, 10, 11']}})">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-fullscreen" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">{{ledgerStorage.data.paymentTitle}}</h5>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <table class="table table-bordered align-middle visually-hidden table-hover table-sm border-dark" id="paymentLineItemsTable">
                                <thead class="table-light small">
                                    <tr>
                                        <th>Student</th>

                                        <th>Class Date</th>
                                        <th>Class</th>
                                        <th>Enrolment Total</th>
                                        <th>Paid</th>
                                    </tr>
                                </thead>
                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="ledgerStorage.data.paymentLineItems" id="rp_payLineItems" class="small">
                                    <tr>
                                        <td dmx-text="studentFirst +' '+studentLast"></td>

                                        <td dmx-text="classDate.formatDate('dd MMM y')"></td>
                                        <td dmx-text="levelName+' - '+dayName.trunc(3, true, '.')+' '+startTimeDisplay+' | '+instructorFirst +' '+instructorLast.trunc(1, 'true', '.')"></td>
                                        <td dmx-text="enr_grandTotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)"></td>
                                        <td dmx-text="amount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <h6>Total payment made: {{ledgerStorage.data.paymentTotal}}</h6>
                        </div>
                    </div>
                </div>



            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="enrChargeBreakdownModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true" dmx-on:show-bs-modal="run({runJS:{function:'initMergeTable',args:['#studentChargesTable']}})" dmx-on:hidden-bs-modal="run({runJS:{function:'removeMergeTable'}})">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-xxl-down" role="document">
        <div class="modal-content">
            <dmx-serverconnect id="sc_enrChargeBreakdown" noload url="/api/families/ledger/singleEnrolmentChargeBreakdown"></dmx-serverconnect>
            <div class="modal-header bg-primary text-light">
                <h5 class="modal-title">
                    {{sc_enrChargeBreakdown.data.studentClassBreakdown[0].studentInformation.firstName+' '+sc_enrChargeBreakdown.data.studentClassBreakdown[0].studentInformation.lastName}} - Class Charge Breakdown
                </h5>
            </div>
            <div class="modal-body" style="/* max-width: 1600px */ /* margin: 0 auto */">
                <h5 class="fw-bold mb-3">{{' Charges for: '+sc_enrChargeBreakdown.data.studentClassBreakdown[0].startofweek.formatDate('MMMM y')}}</h5>
                <table class="table table-bordered align-middle visually-hidden merge-table" id="studentChargesTable">
                    <thead class="small fw-bold table-light">
                        <tr>
                            <th>Week Starting</th>
                            <th>Class</th>
                            <th>Class date</th>
                            <th>Cost</th>
                            <th>Discount</th>
                            <th>Disc. value</th>
                            <th>Disc. Info</th>
                            <th>Subtotal</th>
                            <th>Family Discount</th>
                            <th>Disc. Value</th>
                            <th>Grand Total</th>
                        </tr>
                    </thead>
                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="sc_enrChargeBreakdown.data.studentClassBreakdown" id="tableRepeat1">
                        <tr>
                            <td dmx-text="startofweek.formatDate('dd MMM, y')" class="text-nowrap"></td>
                            <td dmx-text="classInformation.startTimeDisplay+' '+classLevel.name+' | '+instructorInformation.firstName+' '+instructorInformation.lastName.trunc(1, true, '.').uppercase()" class="text-nowrap"></td>
                            <td dmx-text="classDate.formatDate('ddd dd')" class="text-nowrap"></td>
                            <td dmx-text="baseRate"></td>
                            <td dmx-text="discType === 'Percentage' ? discVal + '%' : discVal"></td>
                            <td dmx-text="discAmt"></td>
                            <td dmx-text="discVal == 0 ? '' : _procedure"></td>
                            <td dmx-text="netAmt"></td>
                            <td dmx-text="fd_type === 'Percentage' ? fd_value + '%' : fd_value"></td>
                            <td dmx-text="fd_amt"></td>
                            <td dmx-text="enr_grandTotal"></td>
                        </tr>
                    </tbody>
                </table>
                <!-- <script>
                    $(function() {
                        $('#btnTableSimplify').click((e) => {
                            mergeTable();
                            var table = $('#studentChargesTable').rowMerge({
                            excludedColumns: [2,4,5,6,7,8,9,10,11],
                            });
                            table.merge();
                        });
                    });
                </script> -->

                <div class="d-flex flex-column justify-content-start align-items-start">

                    <p class="mb-1"><b>Before discounts subtotal: </b>{{sc_enrChargeBreakdown.data.classBreakdown.sum('baseRate').round(2)}}</p>
                    <p class="mb-1"><b>Value of discounts applied: </b>{{(sc_enrChargeBreakdown.data.classBreakdown.sum('discAmt')+sc_enrChargeBreakdown.data.classBreakdown.sum('fd_amt')).round(2)}}</p>
                    <h5><b>Grand Total: </b>{{sc_enrChargeBreakdown.data.classBreakdown.sum('enr_grandTotal')}}</h5>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="createGuardianModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="var_multiform_stepper.setValue(1);newGuardianId.setValue(null);createGuardianModalForm.reset();getNewGuardEmails.reset();familyDetails.load({familyid: query.familyid});ng_guardEmails.form_emailAddress.reset();ng_guardPhones.form_phoneNumbers.reset()">
    <div class="modal-dialog modal-lg modal-fullscreen-lg-down" role="document">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title">Create Guardian</h5>
                <button type="button" class="btn-close text-white" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body overflow-x-hidden">
                <dmx-serverconnect id="ng_getGuardDetails" url="/api/families/guardians/getGuardDetails_base"></dmx-serverconnect>
                <dmx-value id="var_multiform_stepper" dmx-bind:value="1"></dmx-value>
                <dmx-value id="newGuardianId" dmx-on:updated="ng_getGuardDetails.load({guardianid: value})"></dmx-value>

                <div class="container" is="dmx-if" id="cr_ng_name" dmx-bind:condition="createGuardianModal.var_multiform_stepper.value === 1">
                    <h6 class="fw-bold text-uppercase">name &amp; relationship</h6>

                    <form id="createGuardianModalForm" method="post" is="dmx-serverconnect-form" action="/api/families/guardians/createGuardian" dmx-on:success="var_multiform_stepper.setValue(2);newGuardianId.setValue(createGuardianModal.cr_ng_name.createGuardianModalForm.data.newguardianid)" dmx-on:error="notifies1.danger('An error occured! - '+createGuardianModal.cr_ng_name.createGuardianModalForm.lastError.status+' '+createGuardianModal.cr_ng_name.createGuardianModalForm.lastError.message+' - '+createGuardianModal.cr_ng_name.createGuardianModalForm.lastError.response)">

                        <input id="inp_familyid" type="hidden" class="form-control" dmx-bind:value="query.familyid" name="familyid">
                        <div class="row mb-2">
                            <div class="col">
                                <div class="mb-0">
                                    <label for="firstName" class="col-form-label">First Name</label><input id="firstName" name="firstName" type="text" class="form-control" placeholder="First Name" required="">

                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-0">
                                    <label for="lastName" class="mb-0 form-label col-form-label">Last Name</label><input id="lastName" name="lastName" type="text" class="form-control" placeholder="Last Name" required="">

                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-5">
                                <div class="mb-3">

                                    <label for="relationship" class="mb-0 form-label col-form-label">Relationship</label>
                                    <select id="relationship" class="form-select" name="relationship" dmx-bind:options="getRelationships.data.query" optiontext="type" optionvalue="id" required="">
                                        <option value="">Please select...</option>
                                    </select>

                                </div>

                            </div>
                            <div class="col align-self-end d-flex justify-content-end">
                                <button id="createGuardBtn" class="btn btn-primary" type="submit"><i class="bi-save me-2"></i>Create &amp; Next
                                </button>

                            </div>
                        </div>
                    </form>





                </div>

                <div is="dmx-animate" id="ng_guardDetails" showEffect="fadeIn" hideEffect="fadeOut" dmx-bind:visible="createGuardianModal.newGuardianId.value" dmx-bind:showduration="500" class="overflow-hidden" dmx-hide="!createGuardianModal.newGuardianId.value">
                    <section>
                        <div class="container pb-2 mb-4 border-bottom" is="dmx-animate" dmx-bind:visible="createGuardianModal.newGuardianId.value">
                            <div class="row">
                                <div class="col">
                                    <h5>Guardian Details</h5>
                                    <p class="small mb-2 pb-1 border-bottom text-danger">Made a mistake? These details can be changed after you've saved the guardian.</p>
                                    <div class="row">
                                        <div class="col-auto">
                                            <p class="small text-muted mb-1">Guardian Name:</p>

                                        </div>
                                        <div class="col">
                                            <p class="small mb-1" dmx-text="ng_getGuardDetails.data.query.firstName+' '+ng_getGuardDetails.data.query.lastName">John Doe</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto">
                                            <p class="small text-muted mb-1">Relationhip:</p>

                                        </div>
                                        <div class="col">
                                            <p class="small mb-1" dmx-text="appSettings.relationships[ng_getGuardDetails.data.query.relationship].name">Cousin Twice Removed</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <div is="dmx-animate" id="ng_guardEmails" class="overflow-hidden" dmx-bind:visible="createGuardianModal.var_multiform_stepper.value === 2" dmx-bind:showduration="500" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 2" showEffect="fadeInRight" hideEffect="fadeOut" dmx-bind:hideduration="250">
                    <section>
                        <div class="container">
                            <h6 class="fw-bold text-uppercase">Email Addresses</h6>
                            <form id="form_emailAddress" is="dmx-serverconnect-form" method="post" dmx-on:error="dc_errorEmail.show()" dmx-on:success="dc_errorEmail.hide();successNotifies.success('Email created successfully.');getNewGuardEmails.load({guardianid: createGuardianModal.newGuardianId.value});form_emailAddress.reset()" action="/api/families/guardians/checkInsertEmail">
                                <div class="row mb-2">
                                    <div class="col-10">
                                        <dmx-value id="var_checkEmailStatus" dmx-bind:value="checkEmailArray.data.var_continue"></dmx-value>
                                        <dmx-array id="arr_emailAddresses"></dmx-array>
                                        <div class="row mb-3 mb-0 small">
                                            <label for="email" class="mb-0 form-label col-form-label">Email Addresses</label>
                                            <div class="col-6"><input id="email" name="emailaddress" type="email" class="form-control" placeholder="Email" data-rule-email="" required="" data-msg-required="Email required." dmx-on:blur="email.validate()"></div>
                                            <div class="col-4"><select id="sel_emailType" class="form-select" dmx-bind:options="appSettings.contactTypes.emailContactTypes" optiontext="type" optionvalue="id" style="/* width: 140px */ /* max-width: 140px */" required="" data-msg-required="Email type required." name="type">
                                                    <option disabled selected value="">Type...</option>
                                                </select></div>
                                            <div class="col-auto">
                                                <input id="hd_guardianidEmail" name="guardianid" type="hidden" class="form-control" dmx-bind:value="createGuardianModal.newGuardianId.value">
                                                <button id="addEmailToArr" class="btn btn-primary" dmx-bind:disabled="createGuardianModalForm.email.invalid || createGuardianModalForm.email.value === '' || createGuardianModalForm.sel_emailType.invalid || createGuardianModalForm.sel_emailType.value === ''" type="submit">
                                                    <i class="bi-save2"></i>
                                                </button>

                                            </div>
                                            <legend class="col-form-label col-form-label-sm">*Press the add button to add emails.</legend>

                                        </div>



                                    </div>

                                </div>
                            </form>


                            <div class="collapse bg-danger text-light rounded-3" id="dc_errorEmail" is="dmx-bs5-collapse">
                                <p class="mb-0 lh-1 py-2 px-3" dmx-html="'<i class=&quot;bi-exclamation-triangle-fill me-2&quot;></i> Error:  '+form_emailAddress.lastError.status+' - '+form_emailAddress.lastError.message+' - '+form_emailAddress.lastError.response"><i class="bi-exclamation-triangle-fill me-2"></i>Error 409: Email address already exists.</p>
                            </div>
                            <div class="row mt-2">

                                <dmx-serverconnect id="getNewGuardEmails" url="/api/families/guardians/getGuardEmails" dmx-param:guardianid="createGuardianModal.newGuardianId.value"></dmx-serverconnect>
                                <div class="col-12" is="dmx-if" id="cr_ng_hasemails" dmx-bind:condition="getNewGuardEmails.data.emails.hasItems()">
                                    <table class="table table-sm small">
                                        <thead class="text-uppercase fw-bold">
                                            <tr>
                                                <th>Address</th>
                                                <th>Type</th>
                                                <th scope="row"></th>
                                            </tr>
                                        </thead>
                                        <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="getNewGuardEmails.data.emails" id="emailTableRepeat">
                                            <tr>
                                                <td dmx-text="address"></td>
                                                <td dmx-text="appSettings.contactTypes[type].type"></td>
                                                <td>
                                                    <form id="form_ng_deleteEmail" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deleteEmail" dmx-on:success="getNewGuardEmails.load({guardianid: createGuardianModal.newGuardianId.value})" dmx-on:error="">
                                                        <input id="inp_ng_del_emailid" name="emailid" type="hidden" class="form-control" dmx-bind:value="id">

                                                    </form>
                                                    <a href="javascript:void(0);" class="text-danger" dmx-on:click="run({confirm:{message:'Are you sure you want to delete this email?',then:{steps:{run:{action:`form_ng_deleteEmail.submit()`}}}}})">Delete</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                                <div class="col-12" is="dmx-if" id="cr_ng_noemails" dmx-bind:condition="!getNewGuardEmails.data.emails.hasItems()">
                                    <p class="text-center small text-danger p-4 border rounded-3">No emails added. Add emails in the form above.</p>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col d-flex justify-content-end"><button id="createGuardBtn1" class="btn btn-secondary" dmx-on:click="var_multiform_stepper.setValue(3)">Next<i class="bi-arrow-right ms-2"></i></button></div>
                            </div>
                        </div>

                    </section>
                </div>

                <div is="dmx-animate" id="ng_guardPhones" showEffect="fadeInRight" hideEffect="fadeOut" dmx-bind:visible="createGuardianModal.var_multiform_stepper.value === 3" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 3" dmx-bind:showduration="500" dmx-bind:hideduration="250">
                    <section>
                        <div class="container" dmx-animate-enter.duration:250="fadeInLeft" dmx-animate-leave.duration:250="fadeOutRight" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 3" dmx-show="createGuardianModal.var_multiform_stepper.value === 3">
                            <h6 class="fw-bold text-uppercase">PHONE NUMBERS</h6>
                            <div class="row">
                                <dmx-serverconnect id="getNewGardPhones" url="/api/families/guardians/getGuardPhones" dmx-param:guardianid="createGuardianModal.newGuardianId.value"></dmx-serverconnect>
                                <div class="col-12">
                                    <dmx-array id="arr_phoneNumbers"></dmx-array>
                                    <form action="/api/families/guardians/insertPhone" method="post" id="form_phoneNumbers" is="dmx-serverconnect-form" dmx-on:success="getNewGardPhones.load();form_phoneNumbers.reset()" dmx-on:error="notifies1.danger('Error: '+createGuardianModal.cr_ng_phones.form_phoneNumbers.lastError.status+': '+createGuardianModal.cr_ng_phones.form_phoneNumbers.lastError.message+' - '+createGuardianModal.cr_ng_phones.form_phoneNumbers.lastError.response)">
                                        <div class="row mb-3 mb-0 small">
                                            <label for="phone" class="mb-0 form-label col-form-label">Phone Numbers</label>
                                            <div class="col-6"><input id="phone" name="phone" type="text" class="form-control" placeholder="Phone" required="" data-rule-digits="" data-msg-required="Phone number required."></div>
                                            <div class="col-4"><select id="sel_phoneType" class="form-select" dmx-bind:options="appSettings.contactTypes.phoneContactTypes" optionvalue="id" optiontext="type" style="" required="" data-msg-required="Phone type required." name="type">
                                                    <option disabled selected value="">Type...</option>
                                                </select></div>
                                            <div class="col-auto"><input id="inp_guardianIdPhone" name="guardianId" type="hidden" class="form-control" dmx-bind:value="createGuardianModal.newGuardianId.value">
                                                <button id="addPhoneToArr" class="btn btn-primary" dmx-on:click="arr_phoneNumbers.addUniq(createGuardianModal.phone.value)" type="submit">
                                                    <i class="bi-save2"></i>
                                                </button>
                                            </div>

                                            <div class="input-group">



                                            </div>
                                            <legend class="col-form-label col-form-label-sm">*Press the add button to add phone numbers.</legend>
                                        </div>
                                    </form>


                                </div>
                                <div class="col-12" is="dmx-if" id="cr_ng_hasphones" dmx-bind:condition="getNewGardPhones.data.query.hasItems()">
                                    <div class="row">

                                        <div class="col">
                                            <table class="table table-sm small">
                                                <thead class="fw-bold text-uppercase">
                                                    <tr>
                                                        <th>Phone Number</th>
                                                        <th>Type</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="getNewGardPhones.data.query" id="ng_phonesTableRepeat">
                                                    <tr>
                                                        <td dmx-text="phone"></td>
                                                        <td dmx-text="appSettings.contactTypes[type].type"></td>
                                                        <td>
                                                            <form id="form_ng_deletePhone" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deletePhone" dmx-on:success="getNewGardPhones.load({guardianid: createGuardianModal.newGuardianId.value})" dmx-on:error="notifies1.danger('Error '+createGuardianModal.ng_guardPhones.form_phoneNumbers.lastError.status+': '+createGuardianModal.ng_guardPhones.form_phoneNumbers.lastError.message+' - '+createGuardianModal.ng_guardPhones.form_phoneNumbers.lastError.response)">
                                                                <input id="inp_ng_delPhoneId" name="phoneid" type="hidden" class="form-control" dmx-bind:value="id">
                                                            </form>
                                                            <button id="delPhoneNumber" class="btn btn-link text-danger btn-sm" dmx-on:click="run({confirm:{message:'Are you sure you want to delete this phone number?',then:{steps:{run:{action:`form_ng_deletePhone.submit()`}}}}})">Delete</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12" is="dmx-if" id="cr_ng_nophones" dmx-bind:condition="!getNewGardPhones.data.query.hasItems()">
                                    <p class="text-center small text-danger p-4 border rounded-3">No phone numbers added. Add phone numbers in the form above.</p>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col d-flex justify-content-between align-items-end">

                                    <button class="btn btn-outline-secondary" dmx-on:click="var_multiform_stepper.setValue(2)"><i class="bi-arrow-left me-2"></i>Back</button>
                                </div>
                            </div>
                        </div>

                    </section>
                </div>
            </div>
            <div class="modal-footer d-flex justify-content-between border-top">

                <button type="button" class="btn btn-outline-danger" dmx-on:click="run({confirm:{message:'Are you sure you want to cancel? This will delete the guardian you have just created, including any emails and phone numbers added.',then:{steps:{run:{action:`createGuardianModal.form_ng_cancelDeleteGuardian.submit()`}}},name:'confirmCancelGuardian'}})" dmx-hide="!createGuardianModal.newGuardianId.value">Cancel</button>
                <form id="form_ng_cancelDeleteGuardian" is="dmx-serverconnect-form" method="post" action="/api/families/guardians/deleteGuardian" dmx-on:success="run({run:{action:`createGuardianModal.hide();toasts.show({message: \'Successfully cancelled guardian creation.\', title: \'Cancelled.\', icon: \'/assets/images/logo/purple/favicon_purple-svg.svg\'})`}})">
                    <input id="inp_delGuardId" name="guardianid" type="hidden" class="form-control" dmx-bind:disabled="!createGuardianModal.newGuardianId.value" dmx-bind:value="createGuardianModal.newGuardianId.value">
                </form>

                <button class="btn btn-primary" dmx-hide="createGuardianModal.var_multiform_stepper.value !== 3" dmx-on:click="createGuardianModal.hide();toasts.show({message: 'Guardian successfully created. Refresh the page if you don\'t see them in the list.', delay: 10000, title: 'Success.', icon: '/assets/images/logo/purple/favicon_purple-svg.svg'})">Finish<i class="bi-check-circle ms-2"></i></button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editStudentNote" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hide-bs-modal="editNoteForm.reset();getFamilyID.remove('noteid')">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Note</h5>
                <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" dmx-param:noteid="query.noteid" id="editNoteForm" method="post" action="api/updateStudentNote" dmx-generator="bootstrap5" dmx-form-type="horizontal" dmx-on:success="run([{run:{action:`editStudentNote.hide()`}},{wait:{delay:300}},{run:{action:`familyDetails.load({familyid: query.familyid},true)`}},{run:{action:`getStudentNote_Single.reset()`}}])">
                    <input id="inp_noteid" name="noteid" type="hidden" class="form-control" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.id">

                    <div class="mb-3">
                        <label for="fam_noteContentTextArea" class="form-label">Edit Note Content</label>
                        <textarea id="noteContentTextArea" class="form-control" required="" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.content" name="content"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="fam_selectEditNotePriority" class="form-label">Priority of Note</label>
                        <select id="selectEditNotePriority" class="form-select form-select-lg" dmx-bind:value="getStudentNote_Single.data.singleStudentNote.priority" name="priority">
                            <option value="1">Lowest</option>
                            <option value="2">Low</option>
                            <option value="3">Medium</option>
                            <option value="4">High</option>
                            <option value="5">Critical</option>
                        </select>
                        <small id="select1Help" class="form-text text-muted">Please ensure you select the correct priority for the situation.</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" form="editNoteForm" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="weeklyChargeBreakdownModal" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg modal-fullscreen" role="document">
        <div class="modal-content">
            <dmx-serverconnect id="sc_enrChargeBreakdown1" noload="" url="/api/families/ledger/singleEnrolmentChargeBreakdown"></dmx-serverconnect>
            <div class="modal-header bg-info text-light">
                <h5 class="modal-title">
                    <font color="#6c757d"><span style="font-size: 15.75px; color: rgba(255,255,255,0.7);">{{sc_enrChargeBreakdown.data.studentInformation.firstName+' '+sc_enrChargeBreakdown.data.studentInformation.lastName}} - Class Charge Breakdown<br></span></font>{{sc_enrChargeBreakdown.data.classLevel.name+' - '+sc_enrChargeBreakdown.data.classInformation.dayname+' '+sc_enrChargeBreakdown.data.classInformation.startTimeDisplay+' - '+sc_enrChargeBreakdown.data.instructorInformation.firstName+' '+sc_enrChargeBreakdown.data.instructorInformation.lastName.trunc(1, true, '.').capitalize()}}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Modal body text goes here.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal pe-0 fade" id="editPhoneNumberModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="editPhoneForm.reset()">

    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-light">
                <h5 class="modal-title">Edit Phone Numbers: {{dd_guardianPhoneEdit.data.firstName+' '+dd_guardianPhoneEdit.data.lastName}}</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">







                <div id="cr_noPhoneNumbers" is="dmx-if" dmx-bind:condition="getGuardianContactDetails.data.getGuardianPhones.length === 0">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal pe-0 fade" id="editEmailModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="editPhoneForm.reset()">
    <dmx-data-detail id="dd_guardianEmailEdit" dmx-bind:data="familyDetails.data.getGuardiansWContacts" key="id"></dmx-data-detail>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-light bg-secondary">
                <h5 class="modal-title">Edit Emails: {{' '+dd_guardianEmailEdit.data.firstName+' '+dd_guardianEmailEdit.data.lastName}}</h5>
                <button type="button" class="btn-close text-light" aria-label="Close" data-bs-dismiss="modal">
                    <span aria-hidden="true" class="visually-hidden">×</span>
                </button>
            </div>
            <div class="modal-body">






                <div id="cr_noEmailAddresses" is="dmx-if" dmx-bind:condition="getGuardianContactDetails.data.getGuardianEmails.length === 0">
                    <section>
                        <div class="container p-4 border rounded">
                            <p class="mb-0 text-center">There are no email addresses to edit.</p>
                        </div>
                    </section>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<dmx-serverconnect id="familyDetails" url="api/familyParameters" dmx-param:familyid="query.familyid" dmx-on:done="getFees.load({familyid: query.familyid, monthtocount: '2021-06-01'})"></dmx-serverconnect>
<dmx-serverconnect id="checkEmail" noload url="/api/families/checkEmail" dmx-on:success="createGuardianModalForm.arr_emailAddresses.addUniq(createGuardianModalForm.hd_emailObj.value)"></dmx-serverconnect>






<dmx-serverconnect id="deleteGuardianPhone" url="/api/deleteGuardianPhone" noload></dmx-serverconnect>

<dmx-serverconnect id="createGuardian" url="api/createGuardian" dmx-param:familyid="query.familyid" noload=""></dmx-serverconnect>
<dmx-serverconnect id="deleteGuardian" url="/api/families/guardians/deleteGuardian" dmx-param:guardianid="" noload=""></dmx-serverconnect>
<dmx-serverconnect id="deleteFamily" url="/api/deleteFamily" dmx-param:familyid="" noload></dmx-serverconnect>
<dmx-serverconnect id="deleteFamilyNote" url="api/deleteFamilyNote" dmx-param:guardianid="updateGuardianModal.data_detail1.data.id" noload="" dmx-param:noteid=""></dmx-serverconnect>
<dmx-serverconnect id="getStudents" url="api/getStudentsInFamily" dmx-param:familyid="query.familyid"></dmx-serverconnect>


<dmx-serverconnect id="updateFamily" url="api/updateFamily" dmx-param:familyid="familyDetails.data.familyDetails.id" noload="" dmx-param:family_id="query.familyid"></dmx-serverconnect>

<dmx-serverconnect id="updatePrimaryGuardian" url="api/updateFamilyPrimaryGuardian" dmx-param:familyid="query.familyid" noload=""></dmx-serverconnect>
<dmx-serverconnect id="getStudentNote_Single" url="api/getStudentNote_Single" dmx-param:noteid=""></dmx-serverconnect>
<dmx-serverconnect id="getStudentNotes" url="api/getStudentNotes" dmx-param:studentid="id"></dmx-serverconnect>
<dmx-serverconnect id="getGuardianContactDetails" url="/api/getGuardianContactDetails" noload></dmx-serverconnect>
<dmx-serverconnect id="deleteGuardianEmail" url="/api/deleteGuardianEmail"></dmx-serverconnect>
<div class="container d-none" id="countries_states_scs">

    <dmx-serverconnect id="getCountries" url="/api/baseActions/getCountries"></dmx-serverconnect>
    <dmx-serverconnect id="getCountryStates" url="/api/baseActions/getCountryStates" noload dmx-param:countryid="" dmx-on:success="address_createModal.form_createAddress.sel_state.setValue(getstateid.data.stateid.id)">
    </dmx-serverconnect>
    <dmx-serverconnect id="getcountryid" url="/api/baseActions/google/places/get_countryid" dmx-param:country="" noload></dmx-serverconnect>
    <dmx-serverconnect id="getstateid" url="/api/baseActions/google/places/get_stateid" dmx-param:country="address_createModal.form_createAddress.inp_residenceAutocomplete.components.country.long" dmx-param:state="" noload></dmx-serverconnect>
</div>




<dmx-datetime id="currentDateVariable"></dmx-datetime>

<main class="d-flex flex-grow-1 flex-column p-4">
    <div class="row">
        <div class="col d-flex flex-column">
            <div class="row row-cols-1 g-0">
                <div class="col d-flex justify-content-between">
                    <a href="/families" class="btn btn-link text-body"><i class="bi-arrow-left-circle me-1"></i>Families List
                    </a>


                    <h3 class="fw-bolder" dmx-html="'Family:<span style=&quot;font-weight: normal;&quot;> '+familyDetails.data.primaryGuardian.firstName+' '+familyDetails.data.primaryGuardian.lastName+' </span>'">Family:<span style="font-weight: normal;"> </span></h3>

                </div>
                <div class="col my-3 p-2 bg-white border rounded-3 text-body d-flex justify-content-between">
                    <ul class="nav align-items-stretch flex-row justify-content-start gx-2" id="navtabs_parent" role="tablist">
                        <li class="nav-item col-auto">
                            <a class="nav-link active" id="navTabs1_1_tab" role="tab" aria-controls="navTabs1_1" aria-selected="true" style="" data-bs-toggle="tab" data-bs-target="#guardians" href="#guardians"><i class="bi-people me-1"></i>Family Overview</a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link" id="navTabs1_2_tab" href="#ledger" role="tab" aria-controls="navTabs1_2" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#ledger"><i class="bi-credit-card me-1"></i>Ledger

                            </a>
                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link" id="navTabs1_3_tab" href="#emails" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#emails"><i class="bi-envelope me-1"></i>Emails
                            </a>
                        </li>

                        <li class="nav-item col-auto">
                            <a class="nav-link" id="navTabs1_4_tab" href="#notes" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#notes"><i class="bi-stickies me-1"></i>Notes
                                <i class="bi-exclamation-circle-fill" dmx-class:pri-5-icon="familyDetails.data.familyNotes[0].maxPriority == 5" dmx-class:pri-4-icon="familyDetails.data.familyNotes[0].maxPriority == 4" dmx-class:pri-3-icon="familyDetails.data.familyNotes[0].maxPriority == 3" dmx-class:pri-2-icon="familyDetails.data.familyNotes[0].maxPriority == 2" dmx-class:pri-1-icon="familyDetails.data.familyNotes[0].maxPriority == 1" dmx-hide="familyDetails.data.familyNotes.length === 0"></i></a>

                        </li>
                        <li class="nav-item col-auto">
                            <a class="nav-link" id="navTabs1__tab" href="#logs" role="tab" aria-controls="navTabs1_3" aria-selected="false" style="" data-bs-toggle="tab" data-bs-target="#logs"><i class="bi-list me-1"></i>Logs
                            </a>
                        </li>
                    </ul>
                </div>
            </div>



        </div>
    </div>
    <div class="row d-flex flex-grow-1">

        <div class="col">

            <!-- <a class="badge rounded-1 text-end clickable" dmx-class:pri-5-solid="familyDetails.data.familyNotes[0].maxPriority === 5" dmx-class:pri-4-solid="familyDetails.data.familyNotes[0].maxPriority === 4" dmx-class:pri-3-solid="familyDetails.data.familyNotes[0].maxPriority === 3" dmx-class:pri-2-solid="familyDetails.data.familyNotes[0].maxPriority === 2" dmx-class:pri-1-solid="familyDetails.data.familyNotes[0].maxPriority === 1" dmx-hide="familyDetails.data.familyNotes.length === 0" data-bs-toggle="tab" data-bs-target="#navTabs1_4" href="#"><i class="bi-sticky-fill me-2"></i>{{topPriorityNotes.value}}</a> -->
            <div class="tab-content" id="navTabs1_content">
                <div class="tab-pane fade show active" id="guardians" role="tabpanel" aria-labelledby="navTabs1_1_tab">
                    <div class="row gx-2">
                        <div class="col-auto">
                            <div class="d-flex p-3 pt-2 bg-white border rounded-3 text-body d-flex flex-column">
                                <h6 class="fw-bold text-uppercase small">Create</h6>

                                <div class="row g-2">
                                    <div class="col-auto"><button id="addGuardianButton" class="btn align-self-end btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#createGuardianModal"><i class="bi-plus-circle me-2"></i>New Guardian</button></div>
                                    <div class="col-auto"><button id="createStudentButton" class="btn align-self-end btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#createStudentModal"><i class="bi-plus-circle me-2"></i>New Student</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="d-flex p-3 pt-2 bg-white border rounded-3 text-body d-flex flex-column">
                                <h6 class="fw-bold text-uppercase small">Modify</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <button id="btn_addresses" class="btn btn-sm btn-outline-secondary" data-bs-target="#address_createModal" dmx-on:click="run({condition:{if:`familyDetails.data.addresses.length > 0`,then:{steps:{run:{action:`address_createOrEdit.show()`}}},else:{steps:{run:{action:`address_createModal.show()`}}}}})"><i class="bi-map me-2"></i>Add/Edit Address</button>

                                    </div>
                                    <div class="col-auto"><button id="btn_discounts" class="btn btn-sm btn-outline-secondary"><i class="bi-percent me-2"></i>Special Discounts</button></div>
                                </div>
                            </div>

                        </div>




                    </div>
                    <div class="row">
                        <div class="col " is="dmx-if" id="cr_noaddress" dmx-bind:condition="familyDetails.data.addresses.length == 0">
                            <p class="border rounded-3 text-light bg-danger text-start mt-3 mb-0 pt-2 pb-2 ps-2 pe-2"><i class="bi-exclamation-diamond me-2"></i>No address for this family found. Addresses are used in receipts and other documents sent to the family.</p>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-7">
                            <div class="row row-cols-1 g-0">
                                <div class="col p-4 d-flex flex-column mb-4 border rounded-1 bg-white">
                                    <div class="row pb-3">
                                        <div class="col align-self-start">
                                            <h5 class="mb-0">Guardians</h5>

                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">

                                            <div class="table-responsive">
                                                <table class="table align-middle table-hover big-small">
                                                    <thead class="small table-white fw-bold text-uppercase border-bottom">
                                                        <tr>
                                                            <th scope="row" style="width: 1%; white-space: nowrap;"></th>
                                                            <th style="white-space: nowrap; width: 1%;">name</th>
                                                            <th style="">Relationship</th>
                                                            <th scope="row">Phones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="familyDetails.data.getGuardiansWContacts" id="guardianTableRepeat" class="table-white small">
                                                        <tr>
                                                            <td class="text-center align-middle">
                                                                <div class="pg-badge clickable user-select-none" dmx-hide="primaryGuardian !== id" dmx-bs-tooltip="'Primary Guardian'" data-bs-animation="false" data-bs-placement="top" data-bs-trigger="hover">P</div>
                                                            </td>
                                                            <td style="white-space: nowrap;" dmx-on:click="getGuardianDetailsModal.dd_guardianDetails.select(id);getGuardianDetailsModal.show()" class="clickable">
                                                                <p class="mb-0 text-decoration-underline">{{firstName + ' ' + lastName}}</p>
                                                            </td>
                                                            <td dmx-text="appSettings.relationships[relationship].name">Father</td>
                                                            <td>
                                                                <div class="row row-cols-1" is="dmx-repeat" id="rp_phones" dmx-bind:repeat="phoneNumbersArray">
                                                                    <div class="col" dmx-text="appSettings.contactTypes[type].type +': '+phone"></div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col p-4 d-flex flex-column mb-4 py-3 border rounded-1 bg-white">
                                    <div class="row pb-4 align-items-center">
                                        <div class="col align-self-center">
                                            <h5 class="mb-0">Students</h5>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="table-responsive">
                                                <table class="table align-middle table-hover big-small">
                                                    <thead class="small table-white fw-bold text-uppercase border-bottom">
                                                        <tr>
                                                            <th style="width: 1%; white-space: nowrap;">Id</th>
                                                            <th style="">Student</th>
                                                            <th>Age</th>
                                                            <th>Level</th>
                                                            <th>NOTES</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="familyDetails.data.loopThroughStudents" id="studentTableRepeat" class="table-white small">
                                                        <tr>
                                                            <td dmx-text="id">15466</td>
                                                            <td dmx-text="firstname +' '+lastname" class="text-decoration-underline clickable" dmx-on:click="browser1.goto('/families/familydetail/'+query.familyid+'/studentdetail/'+id)">Jeffrey Doe</td>
                                                            <td dmx-text="age">3y 4m</td>
                                                            <td dmx-text="appSettings.classLevelsByID[level].name">Duckling</td>
                                                            <td dmx-text="getStudentNotes.length > 0 ? (getStudentNotes.length +' Notes') : '-'" class="text-decoration-underline clickable">1 Note</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row g-0 row-cols-1" style="top: 1rem;">
                                <div class="col bg-white p-4 border rounded-3 mb-2" dmx-hide="familyDetails.data.addresses.length === 0">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h4 class="mb-0"><i class="bi-map me-2"></i>Addresses</h4>
                                        </div>
                                        <div class="col d-flex justify-content-end">
                                            <button class="btn btn-link p-0 mb-0 text-end">View All</button>
                                        </div>
                                    </div>


                                    <div class="row mt-3">
                                        <div class="col">
                                            <h6 class="fw-bold">Default Address</h6>

                                            <p class="mb-1" dmx-text="familyDetails.data.default_address.unit" dmx-hide="familyDetails.data.default_address.unit == '' || familyDetails.data.default_address.unit == null">Unit/Suite</p>
                                            <p class="mb-1" dmx-text="familyDetails.data.default_address.street1">Street 1</p>
                                            <p class="mb-1" dmx-text="familyDetails.data.default_address.street2" dmx-hide="familyDetails.data.default_address.street2 == '' || familyDetails.data.default_address.street2 == null">Street 2</p>
                                            <p class="mb-1" dmx-text="familyDetails.data.default_address.suburb">Suburb</p>
                                            <p class="mb-0" dmx-text="familyDetails.data.default_address.state_name+', '+familyDetails.data.default_address.postcode+' '+familyDetails.data.default_address.country_name">State, ZIP Postal Code, Country</p>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>


                    </div>



                </div>
                <div class="tab-pane fade" id="ledger" role="tabpanel">
                    <div class="row row-cols-1">
                        <div class="col border-bottom mb-3 pb-4 ps-3 pe-3">
                            <div class="row row-cols-6">
                                <div class="col-auto"><a id="btn4" class="btn border btn-light" dmx-bind:href="'/families/familydetail/'+query.familyid+'/payment'" dmx-on:click="selectedChargesStore.clear()">New Payment</a></div>
                                <div class="col-auto"><button id="btn5" class="btn border btn-light">Run a Charge</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="row row-cols-1" id="chargeCol">


                        <div class="col mb-4">


                            <h4 class="mb-3"><i class="bi-cart-plus-fill m-2"></i>Charges
                            </h4>
                            <div class="row row-cols-1 g-0" is="dmx-repeat" id="rp_familyChargesRepeat" dmx-bind:repeat="familyLedger.data.getStudentCharges">
                                <div class="col border rounded-small bg-white postition-relative mb-2" dmx-class:border-danger="chargeOverdue &amp;&amp; chargePaymentsTotal[0]['SUM(amount)'] < chargeAmount" dmx-class:border-3="chargeOverdue &amp;&amp; chargePaymentsTotal[0]['SUM(amount)'] < chargeAmount">
                                    <div class="row small clickable ms-n2 me-n2 p-3 align-items-center" dmx-on:click="dc_chargeStudentDetail.toggle(undefined)">
                                        <div class="col-auto align-self-center">
                                            <h5 class="mb-0 text-center"><i class="bi-triangle-fill text-warning" dmx-show="chargeOverdue === false &amp;&amp; chargePaymentsTotal < chargeAmount"></i>
                                                <i class="bi-exclamation-triangle-fill text-danger" dmx-show="chargeOverdue === true &amp;&amp; chargePaymentsTotal < chargeAmount"></i>
                                                <i class="bi-check-circle-fill text-success" dmx-show="chargePaymentsTotal === chargeAmount"></i>
                                            </h5>
                                        </div>
                                        <div class="col align-self-center">

                                            <p class="mb-0 text-muted small">Charge for:</p>
                                            <p class="mb-0 fw-bold text-uppercase" dmx-text="chargeFor.toDate().formatDate('MMM yyyy')">August 2021</p>
                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Total:</p>


                                            <p class="mb-0" dmx-text="chargeAmount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">75.54</p>

                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Paid:</p>

                                            <p class="mb-0 fw-bold" dmx-text="chargePaymentsTotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">0.00</p>
                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Remaining:</p>
                                            <p wappler-command="editContent" class="mb-0" dmx-text="chargePaymentsTotal == chargeAmount ? 'PAID' : (chargeAmount - chargePaymentsTotal).formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)" dmx-class:text-danger="chargePaymentsTotal > 0 &amp;&amp; chargePaymentsTotal != chargeAmount" dmx-class:fw-bold="chargePaymentsTotal > 0 &amp;&amp; chargePaymentsTotal != chargeAmount">75.54</p>
                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Due:</p>
                                            <p class="mb-0" dmx-text="dueDate.formatDate('dd MMM y') ">31 July 2021</p>
                                        </div>

                                    </div>
                                    <div class="collapse" id="dc_chargeStudentDetail" is="dmx-bs5-collapse">
                                        <ul class="nav nav-pills p-3 flex-row border-top border-bottom">
                                            <li class="nav-item">
                                                <a class="btn btn-outline-info text-body active rounded-1 border" id="chargeTab_1_tab" role="tab" aria-controls="chargeTab_1" aria-selected="true" style="" data-bs-toggle="tab" dmx-bind:data-bs-target="#chargeTab_1_{{$index}}" href="#">Payments
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="btn btn-outline-info text-body rounded-1 border" id="chargeTab_2_tab" role="tab" aria-controls="chargeTab_2" style="" data-bs-toggle="tab" href="#" dmx-bind:data-bs-target="#chargeTab_2_{{$index}}">Student Breakdown</a>
                                            </li>
                                        </ul>
                                        <div class="tab-content mt-3" id="chargeTab_content" dmx-bind:id="chargeTab_content_{{$index}}">
                                            <dmx-value id="var_chargid" dmx-bind:value="id"></dmx-value>
                                            <div class="tab-pane active fade show p-3" id="chargeTab_1" dmx-bind:id="chargeTab_1_{{$index}}" role="tabpanel" aria-labelledby="chargeTab_1_tab">
                                                <h5 class="mb-0">
                                                    Payments for this charge.
                                                </h5>
                                                <small class="text-muted fw-light small">Click payment for more information.</small>
                                                <table class="table table-bordered table-hover mt-3 align-middle">
                                                    <thead class="small fw-bold table-light">
                                                        <tr>
                                                            <th scope="row" style="width: 1%; /* white-space: nowrap */" class="text-center">Actions</th>
                                                            <th>ID:</th>
                                                            <th>Title</th>
                                                            <th>Date:</th>
                                                            <th>TXN Type:</th>
                                                            <th>Amount</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="paymentLineItemsList" id="tableRepeat3" class="small">
                                                        <tr>
                                                            <td>
                                                                <div class="row flex-nowrap g-1 align-items-center">
                                                                    <div class="col"><button id="viewPayDetails" class="btn btn-sm btn-light border" type="submit" dmx-on:click="run([{run:{action:`ledgerStorage.set(\'paymentLineItems\',lineItems)`}},{run:{action:`ledgerStorage.set(\'paymentTitle\',title == \'\' || null ? +\'Payment on \'+paymentdate : title)`}},{run:{action:`ledgerStorage.set(\'paymentTotal\',amount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2))`}},{wait:{delay:200}},{run:{action:`paymentLineItemsModal.show()`}}])" dmx-bs-tooltip="'Generate Receipt'" data-bs-animation="false" data-bs-trigger="hover"><i class="bi-eye"></i></button></div>
                                                                    <div class="col">
                                                                        <form id="generateReceiptFormfromCharges" is="dmx-serverconnect-form" method="post" action="/api/families/ledger/payreceipt_json">
                                                                            <input id="inp_familyid" name="familyid" type="hidden" class="form-control" dmx-bind:value="query.familyid">
                                                                            <input id="inp_host" name="host" type="hidden" class="form-control" dmx-bind:value="browser1.location.protocol+'//'+browser1.location.host">
                                                                            <input id="inp_paymentid" name="paymentid" type="hidden" class="form-control" dmx-bind:value="id"><button id="generatePayReceipt" class="btn btn-sm btn-light border" type="submit" dmx-bs-tooltip="'Generate Receipt'" data-bs-animation="false" data-bs-trigger="hover"><i class="bi-receipt"></i></button>
                                                                        </form>
                                                                    </div>
                                                                </div>



                                                            </td>
                                                            <td dmx-text="id" class="text-center"></td>
                                                            <td dmx-text="title"></td>
                                                            <td dmx-text="paymentdate.formatDate('dd/MM/yyyy')"></td>
                                                            <td dmx-text="pay_type"></td>
                                                            <td dmx-text="amount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)"></td>

                                                        </tr>
                                                    </tbody>
                                                </table>

                                            </div>
                                            <div class="tab-pane fade" id="chargeTab_2" dmx-bind:id="chargeTab_2_{{$index}}" role="tabpanel" aria-labelledby="chargeTab_1_tab">

                                                <h5 class="px-3">Student charge breakdown.</h5>

                                                <div id="rp_chargeStudents" class="row row-cols-1 p-3" is="dmx-repeat" dmx-bind:repeat="getEnrolmentChargeIds">
                                                    <dmx-value id="arr_chargeEnrolid" dmx-bind:value="[var_chargid.value, enrolid]"></dmx-value>
                                                    <div class="col">
                                                        <div class="row g-0">
                                                            <div class="col border bg-white postition-relative mb-3 rounded rounded-1 overflow-hidden">

                                                                <h6 class="py-3 px-3 mb-0 border-bottom" dmx-text="firstName+' '+lastName">Student Name</h6>
                                                                <div class="row row-cols-1 g-0" id="rp_studentChargeBreakdown" is="dmx-repeat" dmx-bind:repeat="allEnrolmentCharges">
                                                                    <div class="col py-2 px-3 align-self-center clickable border-bottom light-grey-hover" dmx-on:click="run([{run:{action:`enrChargeBreakdownModal.sc_enrChargeBreakdown.load({chargeid: var_chargid.value, enrolid: enrolid, studentid: student})`}},{wait:{delay:150}},{run:{action:`enrChargeBreakdownModal.show()`}}])">

                                                                        <div class="row small">
                                                                            <div class="align-self-center col-1">

                                                                                <p class="mb-0 small lh-sm text-muted">EID: {{enrolid}}</p>
                                                                            </div>
                                                                            <div class="col align-self-center">
                                                                                <p class="mb-0 text-muted small">Class:</p>



                                                                                <p class="mb-0" dmx-text="classLevelName +' - '+classDay.trunc(3, 'true', '.')+' '+classStartTime+' - '+instructorFirst+' '+instructorLast.trunc(1, true,'.')">Level - Day XX:XXam - Instructor Name</p>

                                                                            </div>
                                                                            <div class="col align-self-center">
                                                                                <p class="mb-0 text-muted small">Start Date:</p>

                                                                                <p class="mb-0" dmx-text="startDate.toDate().formatDate('dd MMMM yyyy')">01 Month 1900</p>


                                                                            </div>
                                                                            <div class="col align-self-center">
                                                                                <p class="mb-0 text-muted small" dmx-hide="dropDate === null">Drop Date:</p>
                                                                                <p class="mb-0" dmx-text="dropDate.formatDate('dd MMMM yyyy')">30 Month 1901</p>
                                                                            </div>
                                                                            <div class="col align-self-center">
                                                                                <p class="mb-0 text-end" dmx-text="classTotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">Enrolment Total</p>
                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                </div>

                                                                <div class="row g-0 pt-1 pb-1 ps-3 pe-3" dmx-on:click="dc_studentChargeBreakdown.toggle()">
                                                                    <div class="col align-self-center">
                                                                        <h6 class="mb-0 text-end fw-bold" dmx-text="'Total: '+enrolmentsTotal.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">Total</h6>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </div>


                                                    </div>



                                                </div>
                                            </div>
                                        </div>



                                    </div>

                                </div>
                            </div>

                        </div>
                        <div class="col" id="paymentsCol">
                            <h4 class="mb-3"><i class="bi-credit-card-fill m-2"></i>Payments
                            </h4>

                            <div class="row row-cols-1 g-0" dmx-hide="!familyLedger.data.familyPayments.hasItems()" is="dmx-repeat" id="rp_familyPayments" dmx-bind:repeat="familyLedger.data.familyPayments">
                                <div class="col border rounded-small bg-white postition-relative mb-2">
                                    <div class="row small clickable ms-n2 me-n2 p-3">


                                        <div class="col align-self-center">

                                            <p class="mb-0 text-muted small">Amount:</p>
                                            <p class="mb-0 fw-bold" dmx-text="amount.formatCurrency(localization.data.localization.currrency_symbol, appSettings.localization_num_separator, appSettings.localization_num_delimeter, 2)">0.00</p>
                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Date:</p>
                                            <p class="mb-0" dmx-text="paymentdate.formatDate('dd/MM/yyyy')">01/01/1970</p>
                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Charges paid to:</p>
                                            <p class="mb-0" dmx-text="'$'+chargeAmount">Unknown</p>
                                        </div>
                                        <div class="col align-self-center">
                                            <p class="mb-0 text-muted small">Payment Type:</p>
                                            <p class="mb-0" dmx-text="'$'+chargeAmount">Credit/Debit Card</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row row-cols-1 p-3 border rounded-1 position-relative bg-white g-0" dmx-show="!familyLedger.data.familyPayments.hasItems()">
                                <div class="col align-self-center">

                                    <h6 class="mb-0 text-center text-danger">No payment information.</h6>
                                    <p class="mb-0 text-muted small text-center">Once a payment is made, the information will show up here.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="emails" role="tabpanel">
                    <p>Est quis nulla laborum officia ad nisi ex nostrud culpa Lorem excepteur aliquip dolor aliqua irure ex. Nulla ut duis ipsum nisi elit fugiat commodo sunt reprehenderit laborum veniam eu veniam. Eiusmod minim exercitation
                        fugiat irure ex labore incididunt do fugiat commodo aliquip sit id deserunt reprehenderit aliquip nostrud. Amet ex cupidatat excepteur aute veniam incididunt mollit cupidatat esse irure officia elit do ipsum ullamco Lorem.
                        Ullamco ut ad minim do mollit labore ipsum laboris ipsum commodo sunt tempor enim incididunt. Commodo quis sunt dolore aliquip aute tempor irure magna enim minim reprehenderit. Ullamco consectetur culpa veniam sint cillum
                        aliqua incididunt velit ullamco sunt ullamco quis quis commodo voluptate. Mollit nulla nostrud adipisicing aliqua cupidatat aliqua pariatur mollit voluptate voluptate consequat non.</p>
                </div>

                <div class="tab-pane fade" id="notes" role="tabpanel">
                    <div class="row g-0">
                        <div class="col mb-3 p-3 bg-white border rounded-3 text-body d-flex justify-content-between">
                            <div class="row">
                                <div class="col-auto"><button id="addGuardianButton1" class="btn align-self-end btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#createFamilyNoteModal"><i class="bi-plus-circle me-2"></i>New Note</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-lg-stretch g-0">
                        <div class="col p-4 bg-white border rounded-3">

                            <div class="row align-items-stretch" is="dmx-repeat" id="repeat2" dmx-bind:repeat="familyDetails.data.familyNotes">
                                <div class="d-flex align-items-stretch flex-row flex-wrap justify-content-start col-lg-6 col-xxl-4">
                                    <div class="card mb-4 w-100 clickable" dmx-on:click="getFamilyID.set('familynoteid',id);editFamilyNoteModal.editFamilyNoteDetail.select(id);editFamilyNoteModal.show()">
                                        <div class="card-header" dmx-class:pri-1-solid="priority === 1" dmx-class:pri-2-solid="priority === 2" dmx-class:pri-3-solid="priority === 3" dmx-class:pri-4-solid="priority === 4" dmx-class:pri-5-solid="priority === 5">
                                            <div class="d-flex flex-row justify-content-between align-items-center">

                                                <h5 dmx-show="(priority == 1)" class="mb-0 fw-bolder">Lowest</h5>
                                                <h5 dmx-show="(priority == 2)" class="mb-0 fw-bolder">Low</h5>
                                                <h5 dmx-show="(priority == 3)" class="mb-0 fw-bolder">Medium</h5>
                                                <h5 dmx-show="(priority == 4)" class="mb-0 fw-bolder">High</h5>
                                                <h5 dmx-show="(priority == 5)" class="mb-0 fw-bolder"><i class="fas fa-exclamation-triangle fa-fw me-2"></i>Critical
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <h4 class="card-title">{{subject}}</h4>
                                            <p class="card-text" dmx-html="content.replace('<br>', ' ').stripTags().trunc(100, 'true', '...')">Note details.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="tab-pane fade" id="logs" role="tabpanel">
                    <p>Est quis nulla laborum officia ad nisi ex nostrud culpa Lorem excepteur aliquip dolor aliqua irure ex. Nulla ut duis ipsum nisi elit fugiat commodo sunt reprehenderit laborum veniam eu veniam. Eiusmod minim exercitation
                        fugiat irure ex labore incididunt do fugiat commodo aliquip sit id deserunt reprehenderit aliquip nostrud. Amet ex cupidatat excepteur aute veniam incididunt mollit cupidatat esse irure officia elit do ipsum ullamco Lorem.
                        Ullamco ut ad minim do mollit labore ipsum laboris ipsum commodo sunt tempor enim incididunt. Commodo quis sunt dolore aliquip aute tempor irure magna enim minim reprehenderit. Ullamco consectetur culpa veniam sint cillum
                        aliqua incididunt velit ullamco sunt ullamco quis quis commodo voluptate. Mollit nulla nostrud adipisicing aliqua cupidatat aliqua pariatur mollit voluptate voluptate consequat non.</p>
                </div>
            </div>
        </div>

    </div>

</main>
<script defer="true">
    // Deeplinking bootstrap tabs
    let url = location.href.replace(/\/$/, '');
    if (location.hash) {
        const hash = url.split('#');
        const currentTab = document.querySelector('#navtabs_parent a[href="#' + hash[1] + '"]');
        const curTab = new bootstrap.Tab(currentTab);
        curTab.show();
        url = location.href.replace(/\/#/, '#');
        history.replaceState(null, null, url);
        setTimeout(() => {
        window.scrollTop = 0;
        }, 400);
    }
    // change url based on selected tab
    const selectableTabList = [].slice.call(document.querySelectorAll('a[data-bs-toggle="tab"]'));
    selectableTabList.forEach((selectableTab) => {
    const selTab = new bootstrap.Tab(selectableTab);
    selectableTab.addEventListener('click', function () {
    var newUrl;
    const hash = selectableTab.getAttribute('href');
    if (hash == '#home-tab') {
    newUrl = url.split('#')[0];
    } else {
    newUrl = url.split('#')[0] + hash;
    }
    history.replaceState(null, null, newUrl);
    });
    });
</script>