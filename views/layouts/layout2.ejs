<!doctype html>
<html>

<head>
    <script src="/dmxAppConnect/dmxAppConnect.js"></script>
    <base href="/">
    <meta charset="UTF-8">

    <title>SSA CRM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="/dmxAppConnect/dmxBootstrap5Navigation/dmxBootstrap5Navigation.js" defer=""></script>
    <script src="/dmxAppConnect/dmxRouting/dmxRouting.js" defer=""></script>
    <script src="/dmxAppConnect/dmxStateManagement/dmxStateManagement.js" defer=""></script>
    <script src="/dmxAppConnect/dmxDataTraversal/dmxDataTraversal.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxDropzone/dmxDropzone.css" />
    <script src="/dmxAppConnect/dmxDropzone/dmxDropzone.js" defer=""></script>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/backgrounds.css">
    <link rel="stylesheet" href="css/icons.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous" />
    <link rel="stylesheet" href="/dmxAppConnect/dmxBootstrap5TableGenerator/dmxBootstrap5TableGenerator.css" />
    <script src="/dmxAppConnect/dmxFormatter/dmxFormatter.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBrowser/dmxBrowser.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxPreloader/dmxPreloader.css" />
    <script src="/dmxAppConnect/dmxPreloader/dmxPreloader.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap5PagingGenerator/dmxBootstrap5PagingGenerator.js" defer=""></script>
    <script src="/dmxAppConnect/dmxDatastore/dmxDatastore.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap5Modal/dmxBootstrap5Modal.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap5Collapse/dmxBootstrap5Collapse.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxValidator/dmxValidator.css" />
    <script src="/dmxAppConnect/dmxValidator/dmxValidator.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxAutocomplete/dmxAutocomplete.css" />
    <script src="/dmxAppConnect/dmxAutocomplete/dmxAutocomplete.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootbox/bootbox.all.min.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootbox/dmxBootbox.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxDatePicker/daterangepicker.min.css" />
    <script src="/dmxAppConnect/dmxDatePicker/daterangepicker.min.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxDatePicker/dmxDatePicker.css" />
    <script src="/dmxAppConnect/dmxDatePicker/dmxDatePicker.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap5Tooltips/dmxBootstrap5Tooltips.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap5Alert/dmxBootstrap5Alert.js" defer=""></script>

    <link rel="stylesheet" href="/dmxAppConnect/dmxAnimateCSS/animate.min.css" />
    <script src="/dmxAppConnect/dmxAnimateCSS/dmxAnimateCSS.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxNotifications/dmxNotifications.css" />
    <script src="/dmxAppConnect/dmxNotifications/dmxNotifications.js" defer=""></script>
    <link rel="stylesheet" href="/bootstrap/5/css/bootstrap.min.css" />
    <script src="/dmxAppConnect/dmxBootstrap5Offcanvas/dmxBootstrap5Offcanvas.js" defer=""></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" integrity="sha384-NUDU7Qr8dfscXBIhA0px/bRl3cgNrOT9l/WPm15DzH5xnBs4fL4vgRiXURs98/ID" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/@fullcalendar/core@4.4.2/main.min.css" />
    <script src="https://unpkg.com/@fullcalendar/core@4.4.2/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/core@4.4.2/locales-all.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/interaction@4.4.2/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/daygrid@4.4.2/main.min.js"></script>
    <script src="/dmxAppConnect/dmxCalendar/dmxCalendar.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap4Modal/dmxBootstrap4Modal.js" defer=""></script>
    <script src="/dmxAppConnect/dmxMasonry/dmxMasonry.js" defer=""></script>
    <script src="/dmxAppConnect/dmxMoment/dmxMoment.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap5Popovers/dmxBootstrap5Popovers.js" defer=""></script>
    <link rel="stylesheet" href="Connect/dmxDatePicker/bgthemes/dark-calendar.css" />
    <script src="/dmxAppConnect/dmxDownload/dmxDownload.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap4Collapse/dmxBootstrap4Collapse.js" defer=""></script>
    <script src="/dmxAppConnect/dmxBootstrap4PagingGenerator/dmxBootstrap4PagingGenerator.js" defer=""></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxBootstrap4TableGenerator/dmxBootstrap4TableGenerator.css" />
</head>

<body id="standardHeaderFooter" style="min-height: 100vh;" class="main-section pe-0" is="dmx-app" dmx-on:ready="run({runJS:{function:'payTypesPsel'}})">
    <dmx-notifications id="notifies1" newest-on-top="true" closable="true" position="bottom" opacity="1" align="left"></dmx-notifications>
    <dmx-serverconnect id="localization" url="/api/baseActions/localization" dmx-param:localizationid="appSettings.localization"></dmx-serverconnect>
    <dmx-serverconnect id="getLevels" url="/api/getLevels" dmx-on:done="appSettings.load({})"></dmx-serverconnect>

    <dmx-serverconnect id="mySQLUsers" url="/api/sqlCurrentUser"></dmx-serverconnect>
    <dmx-serverconnect id="appSettings" url="/api/baseActions/getAppSettings" dmx-on:done="run({runJS:{function:'appSettingsObject',name:'setSettingsObject'}})" noload>
    </dmx-serverconnect>
    <dmx-serverconnect id="paymentTypes" url="/api/baseActions/paymentTypes"></dmx-serverconnect>
    <dmx-serverconnect id="getCountries" url="/api/baseActions/getCountries"></dmx-serverconnect>
    <dmx-serverconnect id="getAllStaff" url="/api/staff/getAllStaff" dmx-on:done="run([{runJS:{function:'baseValues',args:[`getAllStaff.data.instructors.getInstructors`,'instructors']}},{runJS:{function:'baseValues',args:[`getAllStaff.data.allStaff`,'allStaff']}}])"></dmx-serverconnect>
    <dmx-serverconnect id="logout" noload url="/api/loginSecurity/logout" dmx-on:success="browser1.goto('/public')"></dmx-serverconnect>
    <dmx-query-manager id="queryManager"></dmx-query-manager>
    <dmx-session-manager id="sessionStorage"></dmx-session-manager>
    <dmx-serverconnect id="userDetails" url="api/loginSecurity/userDetails"></dmx-serverconnect>
    <dmx-serverconnect id="getAllStudentsAndFamilies" url="/api/getAllStudentsAndFamilies" noload></dmx-serverconnect>
    <dmx-serverconnect id="getRelationships" url="/api/getRelationships"></dmx-serverconnect>

    <dmx-serverconnect id="getContactTypes" url="/api/getContactTypes"></dmx-serverconnect>
    <div class="modal fade" id="searchAllModal" is="dmx-bs5-modal" tabindex="-1" role="dialog" nocloseonclick="true" dmx-on:hidden-bs-modal="queryManager.remove('searchtextfilter')" dmx-on:hide-bs-modal="globalSearchForm.reset()">
        <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
            <div class="modal-content">
                <dmx-value id="searchType"></dmx-value>
                <dmx-value id="var_fulltextConvert"></dmx-value>
                <div class="modal-header">
                    <h5 class="modal-title">Search Results for "{{var_fulltextConvert.value}}"</h5>
                    <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal">
                        <span aria-hidden="true" class="visually-hidden">Ã—</span>
                    </button>
                </div>
                <div class="modal-body" style="background: #fdfdfd;">
                    <section class="pb-4">
                        <div class="d-flex flex-column">
                            <label for="inp_searchModal" class="col-form-label">Search</label>
                            <input id="inp_searchModal" name="inp_searchModal" type="text" class="form-control form-control-lg me-2" style="font-size: 0.9rem;" dmx-bind:value="var_fulltextConvert.value" dmx-on:keyup.enter="run([{runJS:{function:'fulltextConvert',args:[`value`],name:'fullTextConvert'}},{run:{action:`queryManager.set(\'searchtextfilter\',fullTextConvert);searchAllModal.var_fulltextConvert.setValue(value)`}},{wait:{delay:200}},{run:{action:`getAllStudentsAndFamilies.load({searchtextfilter: query.searchtextfilter})`}}])">
                        </div>

                    </section>
                    <section>
                        <div id="rp_families" is="dmx-repeat" dmx-bind:repeat="getAllStudentsAndFamilies.data.studentsAndFamilies" key="family">
                            <div class="row row-cols-1 border mb-3 pb-2 no-gutters shadow-light overflow-hidden bg-white" dmx-animate-enter.duration:500="fadeInUp" dmx-animate-leave.duration:300="fadeOut">

                                <div class="col py-3 px-2">
                                    <div class="row border-bottom align-items-center">

                                        <div class="col d-flex flex-row align-items-center">

                                            <a href="javascript:void(0);" class="btn btn-light circle-button mx-1" dmx-bind:href="'/families/familydetail/'+family"><i class="fas fa-user-friends fa-sm"></i></a>
                                            <h5 class="fw-light mb-0 ms-2">{{' '+primaryGuardian.firstName+' '+primaryGuardian.lastName}}<br>
                                                <p class="small fw-light mb-0 mt-1" style="color: #aaa !important; font-size: 0.75rem;">{{guardians.values(`' ' + firstName +' '+lastName`)}}</p>
                                            </h5>
                                        </div>
                                        <div class="d-flex col-12 align-items-stretch flex-column">
                                            <div class="row no-gutters px-1 mt-2">
                                                <div class="align-self-end col-1">
                                                    <p class="small mb-0">Action</p>
                                                </div>
                                                <div class="col-3 align-self-end ps-2">
                                                    <p class="small mb-0">Name</p>
                                                </div>
                                                <div class="align-self-end col-2">
                                                    <p class="small mb-0">Level</p>

                                                </div>
                                                <div class="align-self-end col-2">
                                                    <p class="small mb-0">Age</p>
                                                </div>
                                                <div class="align-self-end col-2">
                                                    <p class="small mb-0">Date of Birth</p>
                                                </div>
                                            </div>

                                        </div>
                                    </div>



                                    <div class="row row-cols-1" is="dmx-repeat" id="rp_studentsInFamily" dmx-bind:repeat="students">

                                        <dmx-value id="var_studentRelevance" dmx-bind:value="score/students.max(`score`) ? score/students.max(`score`)*100 : 0"></dmx-value>
                                        <div class="col">
                                            <div class="row no-gutters px-1">


                                                <div class="align-self-center py-2 col-1 d-flex flex-row">
                                                    <a id="studentInfoButton" class="btn circle-button-small btn-light me-1" dmx-bind:href="'/students/studentDetail/'+id"><i class="fas fa-info-circle fa-xs"></i></a>
                                                    <a id="enrolStudentButton" class="btn circle-button-small btn-light" dmx-bind:href="'/students/studentDetail/'+id" dmx-hide="searchType.value !== 'enrolment'"><i class="fas fa-user-plus fa-xs"></i></a>
                                                </div>
                                                <div class="py-2 ps-2 align-self-center col-3" dmx-text="firstName+' '+lastName">Student Full Name</div>
                                                <div class="py-2 align-self-center col-2" dmx-text="level">Level</div>
                                                <div class="align-self-center col-2" dmx-text="age">10y 1m</div>
                                                <div class="py-2 align-self-center col-2" dmx-text="dob.toDate().formatDate('dd-MM-yyyy')">Date of Birth</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div is="dmx-browser" id="browser1"></div>



    <main class="d-flex flex-column align-items-stretch min-vh-100" style="background-color: #f2f5f7;">

        <div class="row w-100 g-0 flex-grow-1">
            <div class="col-auto d-flex p-0 bg-white sidebar flex-column" style="z-index: 1009;">
                <div class="row g-0 topbar border-bottom ps-4 position-relative justify-content-start" dmx-hide="browser1.location.pathparts.contains('payment')" style="background-color: #5758c2;">
                    <div class="col align-self-center d-flex justify-content-start"><img src="/assets/images/logo_light.png" width="120" style="opacity: 0.9;" class="img-fluid"></div>

                </div>
                <nav class="navbar sidebar flex-grow-1 flex-column align-items-stretch p-0 justify-content-start shadow-sm">
                    <div class="container-fluid p-0">
                        <div class="navbar flex-row justify-content-end align-items-stretch w-100 p-0" id="mainNavSidebar">
                            <div class="px-0 container-fluid">
                                <h6 class="text-uppercase fw-bold text-black-50 nav-subheader">NAVIGATION</h6>
                                <ul class="navbar-nav flex-column align-items-stretch justify-content-center w-100">
                                    <li class="nav-item text-muted">
                                        <a class="nav-link text-start active" href="/" dmx-class:disabled="active === true"><i class="bi-kanban ms-1 me-2"></i>
                                            Dashboard
                                        </a>

                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="familyNavLink" href="/families" dmx-class:disabled="active === true"><i class="bi-people ms-1 me-2"></i>
                                            Families

                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="/students" class="nav-link" dmx-class:disabled="active === true"><i class="bi-person-bounding-box ms-1 me-2"></i>
                                            Students

                                        </a>
                                    </li>
                                    <li class="nav-item">

                                        <a class="nav-link" href="/classes"><i class="bi-diagram-3 ms-1 me-2"></i>
                                            Classes

                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#"><i class="bi-flag ms-1 me-2"></i>Reports</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="javascript.void(0);" dmx-class:disabled="active === true"><i class="bi-person-circle ms-1 me-2"></i>Users
                                        </a>

                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="/settings" dmx-class:disabled="active === true"><i class="bi-gear ms-1 me-2"></i>Settings
                                        </a>

                                    </li>

                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="col d-flex flex-column position-relative">


                <dmx-preloader id="preloaderStandard" spinner="foldingCube" size="30" dmx-style:height.important="'calc(100vh-70px)'" dmx-style:width.important="'100%'" dmx-style:top.important="'70px'">
                </dmx-preloader>

                <div class="row g-0 topbar border-bottom position-relative justify-content-start" dmx-hide="browser1.location.pathparts.contains('payment')" style="background-color: #5758c2;">

                    <div class="col d-flex flex-row justify-content-start align-items-center">
                        <div class="dropdown align-self-stretch d-flex">
                            <button id="dd_quickCreate" class="btn text-light change-chevron align-self-stretch focus-white-10 hover-white-10 rounded-0 text-start border-0" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="bi-plus-circle-dotted me-2"></i>Quick Splash</button>
                            <div class="dropdown-menu" aria-labelledby="dropdown1">
                                <a class="dropdown-item" href="#"><i class="bi-people me-2"></i>Create Family</a>
                                <a class="dropdown-item" href="#"><i class="bi-person-bounding-box me-2"></i>Create Student</a>
                                <a class="dropdown-item" href="#"><i class="bi-cart-plus me-2"></i>Make Payment</a>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-row justify-content-end col align-items-stretch">

                        <div class="d-flex justify-content-center align-items-center text-dark flex-row-reverse p-4 border-start clickable hover-white-10" style="border-left-color: rgba(255,255,255,0.2) !important;" dmx-on:click="logout.load()" id="logoutBtnHeader">


                            <p class="my-0 text-light" dmx-html="'<i class=&quot;bi-person-badge me-2&quot;></i>'+userDetails.data.loggedInUser.firstName+' '+userDetails.data.loggedInUser.lastName.trunc(1, true, '.')"><i class="bi-person-badge me-2"></i>User N.</p>
                        </div>


                    </div>
                </div>
                <div class="row g-0 flex-1 position-relative">

                    <div class="col" style="padding-bottom: 150px;">
                        <div is="dmx-view" id="content" class="d-flex h-100">

                            <%- await include(content, locals); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>



    <script src="/js/custom.js" defer="true"></script>
    <!-- <script src="/js/tuitioncalc.js"></script> -->
    <script src="/bootstrap/5/js/bootstrap.bundle.min.js"></script>
    <script>

    </script>
</body>

</html>