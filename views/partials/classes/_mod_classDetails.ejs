<!-- Wappler include head-page="layouts/layout2" appconnect="local" is="dmx-app" bootstrap5="local" bootstrap_icons="cdn" fontawesome_5="cdn" jquery_35="cdn" moment_2="local with locales" id="mod_classdetails" components="{dmxDataTraversal:{},dmxBootstrap5Modal:{},dmxDatePicker:{},dmxAnimateCSS:{}}" href="/partials/classes/_mod_x2_newEnrolment" -->
<div class="modal px-3 fade" id="classDetailsModal" is="dmx-bs5-modal" tabindex="-1" dmx-on:hidden-bs-modal="var_classdetails_page.setValue(1)">
    <%- await include('/partials/classes/_mod_x2_newEnrolment', Object.assign({}, locals)) %>
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <dmx-value id="var_classdetails_page" dmx-bind:value="1"></dmx-value>
                <div class="modal-header border-bottom">
                    <h5 class="modal-title"><i class="fas fa-swimmer me-2 fa-fw fa-sm"></i>Class Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-header border-bottom px-4">
                    <div class="row w-100">
                        <div class="col">
                            <h3 dmx-html="'<i class=&quot;far fa-arrow-alt-circle-right fa-sm me-2&quot;></i>' + appSettings.days_array[sc_GET_CLASS_details.data.query.day]+' - '+sc_GET_CLASS_details.data.query.startTimeDisplay+' '+appSettings.classLevelsByID[sc_GET_CLASS_details.data.query.classlevel_uuid].name+' - '+appSettings.instructorsById[sc_GET_CLASS_details.data.query.instructor_uuid].trunc_name" class="mb-0 fw-800"><i class="far fa-arrow-alt-circle-right fa-sm me-2"></i>Monday - 8:30am Duckling - Troy F.</h3>
                        </div>
                        <div class="d-flex justify-content-end align-items-center col-auto">
                            <button id="btn_classdetail_modal_editClass" class="btn btn-secondary"><i class="fas fa-pen fa-sm fa-fw me-1"></i>Edit Class
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-body light-blue-bg" dmx-show="var_classdetails_page.value==1">
                    <dmx-data-detail id="dd_classdetails" dmx-bind:data="classesBase.data.nextavail.classes" key="uuid"></dmx-data-detail>
                    <dmx-serverconnect id="sc_GET_CLASS_details" url="/api/classes/GET_CLASS_details" noload></dmx-serverconnect>
                    <section class="p-4 bg-white pdl-surface-shadow rounded-3">
                        <div class="row mb-3">
                            <div class="col-12">
                                <p class="mb-1 fw-bold">Create Enrolment</p>
                            </div>
                            <div class="col-auto">

                                <button id="btn_newEnrolment" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-active-outline btn-sm icon-hover-white" dmx-on:click="run([{assign:{value:`!dd_classdetails.data.details.nextavailable_permanent ? false : true`,name:'var_availabilities'}},{assign:{value:`waitlists.length>0`,name:'var_waitlists'}},{assign:{value:`true`,name:'var_continue'}},{condition:{if:`var_availabilities===false`,then:{steps:[{assign:{value:'<p>You\'re about to overbook this class.<br> Are you sure you want to continue?</p>',name:'var_overbook_message'}},{runJS:{function:'swal_confirm',args:['warning','OVERBOOKING WARNING',`true`,'Cancel',`false`,'','OVERBOOK',`false`,`false`,`var_overbook_message`],name:'overbook_confirm'}},{condition:{if:`overbook_confirm === false`,then:{steps:{assign:{value:`false`,name:'var_continue'}}}}}]}}},{condition:{if:`var_waitlists===true&amp;&amp;var_continue===true`,then:{steps:[{assign:{value:'<p>This class has waitlisted students.<br> Are you sure you want to enrol ahead of the waitlists?</p>',name:'var_waitlist_message'}},{runJS:{function:'swal_confirm',args:['warning','Waitlists Active',`true`,'Cancel',`false`,'','Continue Anyway',`false`,`false`,`var_waitlist_message`],name:'waitlist_confirm'}},{condition:{if:`waitlist_confirm === false`,then:{steps:{assign:{value:`false`,name:'var_continue'}}}}}]}}},{condition:{if:`var_continue === true`,then:{steps:[{condition:{if:`var_availabilities===false`,then:{steps:[{run:{action:`makeup_enroltype_toggle.disable(true);casual_enroltype_toggle.disable(true)`,disabled:true}},{run:{action:`classDetailsModal.makeup_enroltype_toggle.disable();classDetailsModal.casual_enroltype_toggle.disable()`}}]}}},{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'active\')`,disabled:true}},{run:{action:`classDetailsModal.dd_classdetails_searchenrol.var_enroltype.setValue(\'active\')`}},{run:{action:`dd_classdetails_searchenrol.select(sc_GET_CLASS_details.data.query.uuid);var_newenrol_startdate.setValue(dd_classdetails.data.details.nextavailable_permanent||dateAndTime_days.datetime.formatDate(\'yyyy-MM-dd\'))`,disabled:true}},{run:{action:`dd_classdetails_searchenrol.select(sc_GET_CLASS_details.data.query.uuid);var_newenrol_startdate.setValue(dd_classdetails.data.details.nextavailable_permanent||dateAndTime_days.datetime.formatDate(\'yyyy-MM-dd\'))`}},{run:{action:`show();classDetailsModal.hide()`,disabled:true}},{run:{action:`classDetailsModal.var_classdetails_page.setValue(2)`}}]}}}])"><i class="fas fa-check-circle me-2 text-active-light"></i>New Active</button>
                                <button id="btn_trialEnrolment" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-trial-outline btn-sm icon-hover-white" dmx-on:click="run([{assign:{value:`!dd_classdetails.data.details.nextavailable_permanent ? false : true`,name:'var_availabilities'}},{assign:{value:`waitlists.length>0`,name:'var_waitlists'}},{assign:{value:`true`,name:'var_continue'}},{condition:{if:`var_availabilities===false`,then:{steps:[{assign:{value:'<p>This class is currently overbooked.<br> Are you sure you want to continue?</p>',name:'var_overbook_message'}},{runJS:{function:'swal_confirm',args:['warning','OVERBOOKING WARNING',`true`,'Cancel',`false`,'','OVERBOOK',`false`,`false`,`var_overbook_message`],name:'overbook_confirm'}},{condition:{if:`overbook_confirm === false`,then:{steps:{assign:{value:`false`,name:'var_continue'}}}}}]}}},{condition:{if:`var_waitlists===true&amp;&amp;var_continue===true`,then:{steps:[{assign:{value:'<p>This class has waitlisted students.<br> Are you sure you want to enrol ahead of the waitlists?</p>',name:'var_waitlist_message'}},{runJS:{function:'swal_confirm',args:['warning','Waitlists Active',`true`,'Cancel',`false`,'','Continue Anyway',`false`,`false`,`var_waitlist_message`],name:'waitlist_confirm'}},{condition:{if:`waitlist_confirm === false`,then:{steps:{assign:{value:`false`,name:'var_continue'}}}}}]}}},{condition:{if:`var_continue === true`,then:{steps:[{condition:{if:`var_availabilities===false`,then:{steps:{run:{action:`makeup_enroltype_toggle.disable(true);casual_enroltype_toggle.disable(true)`}}}}},{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'trial\')`}},{run:{action:`dd_classdetails_searchenrol.select(var_classid.value)`}},{run:{action:`show()`}}]}}}])"><i class="fas fa-question-circle me-2 text-trial-light"></i>New Trial</button>
                                <button id="btn_newMakeup" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-makeup-outline btn-sm" dmx-on:click="run({condition:{if:`dd_classdetails.data.details.makeup.length===0`,then:{steps:{'bootbox.confirm':{buttons:{confirm:{label:'OVERBOOK',className:'btn-danger'},cancel:{label:'Cancel'}},message:'There are no makeup availabilities for this class in the future. Would you like to overbook this class?',title:'Overbook Warning',then:{steps:[{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'makeup\')`}},{run:{action:`dd_classdetails_searchenrol.select(var_classid.value)`}},{run:{action:`show()`}}]}}}},else:{steps:[{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'makeup\')`}},{run:{action:`dd_classdetails_searchenrol.select(var_classid.value)`}},{run:{action:`show()`}}]}}})" dmx-bind:disabled="dd_classdetails.data.details.makeup_response.code === 101 || details.makeup_response.code === 102"><i class="fas fa-arrow-alt-circle-up me-2"></i>New Makeup</button>
                                <button id="btn_newCasual" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-casual-outline btn-sm" dmx-on:click="run({condition:{if:`dd_classdetails.data.details.makeup.length === 1`,then:{steps:{'bootbox.confirm':{buttons:{confirm:{label:'OVERBOOK',className:'btn-danger'},cancel:{label:'Cancel'}},message:'There are no availabilities for casual enrolments this class. Would you like to overbook this class?',title:'Overbook Warning',then:{steps:[{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'casual\')`}},{run:{action:`dd_classdetails_searchenrol.select(var_classid.value)`}},{run:{action:`show()`}}]}}}},else:{steps:[{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'casual\')`}},{run:{action:`dd_classdetails_searchenrol.select(var_classid.value)`}},{run:{action:`show()`}}]}}})" dmx-bind:disabled="dd_classdetails.data.details.makeup_response.code === 101 || details.makeup_response.code === 102"><i class="fas fa-bookmark me-2"></i>New Casual</button>
                                <button id="btn_newWaitlist" dmx-bind:id="btn_newEnrolment_{{$index}}" class="btn btn-sm btn-waitlist-outline" dmx-on:click="run([{condition:{if:`!dd_classdetails.data.details.nextavailable_permanent`,then:{steps:{run:{action:`active_enroltype_toggle.disable(true);trial_enroltype_toggle.disable(true);makeup_enroltype_toggle.disable(true);casual_enroltype_toggle.disable(true)`}}}}},{run:{action:`dd_classdetails_searchenrol.var_enroltype.setValue(\'waitlist\')`}},{run:{action:`dd_classdetails_searchenrol.select(var_classid.value)`}},{run:{action:`show()`}}])">
                                    <i class="fas fa-history me-2"></i>New Waitlist
                                </button>
                                <div class="row" dmx-hide="details.makeup_response.code === 100">
                                    <div class="col mt-2 fw-500">
                                        <p class="fst-italic small text-muted mb-0" dmx-show="details.makeup_response.code === 101">New Makeup and New Casual enrolment buttons have been disabled to prevent overbooking.</p>
                                        <p class="fst-italic small text-muted mb-0" dmx-show="details.makeup_response.code === 102">New Makeup and New Casual enrolment buttons have been disabled because your dates are too far into the future.</p>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive" dmx-hide="dd_classdetails.data.details.total===0">
                            <table class="table table-bordered">
                                <tbody dmx-hide="dd_classdetails.data.details.enrolments.active_enrols.length==0">
                                    <tr>
                                        <th colspan="4" class="text-active py-2"><i class="fas fa-check-circle me-2 fa-fw fa-sm text-active-light"></i>Active Enrolments</th>
                                    </tr>
                                    <tr class="small">
                                        <th></th>
                                        <th>Student</th>
                                        <th>Start Date</th>
                                        <th>Drop Date</th>
                                    </tr>
                                    <tr dmx-repeat:rp_active_enrols_class_details="dd_classdetails.data.details.enrolments.active_enrols" class="light-grey-hover">
                                        <td style="width: 1%; white-space: nowrap; padding-right: 1rem;" class="tc_td_min align-middle">
                                            <div class="dropdown no-caret">
                                                <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown2" class="btn dropdown-toggle no-caret btn-sm btn-outline-light" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown">
                                                    <i class="fas fa-chevron-down text-muted fa-sm"></i>
                                                </button>
                                                <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({uuid: uuid, enrolment_uuid: enrolment_uuid});editEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-pencil"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Edit Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({uuid: uuid, enrolment_uuid: enrolment_uuid});dropEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-arrow-down-circle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Drop Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({uuid: uuid, enrolment_uuid: enrolment_uuid});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-shuffle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                Transfer Enrolment
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+family" dmx-hide="family == '' || family == null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-people"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Go to Family<i class="bi-box-arrow-up-right ms-2 small"></i></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="align-middle" dmx-html="'<i class=&quot;fas fa-check-circle me-2 fa-fw fa-sm text-active-light&quot;></i>'+firstName +' '+lastName" style="padding-left: 20px !important;"></td>
                                        <td dmx-text="startDate.formatDate('dd MMM yyyy')" dmx-class:fw-bold="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" dmx-class:fst-italic="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" class="align-middle"></td>
                                        <td dmx-text="dropDate.formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                    </tr>
                                </tbody>
                                <tbody dmx-hide="dd_classdetails.data.details.enrolments.trial_enrols.length == 0">
                                    <tr>
                                        <th colspan="4" class="text-trial py-2"><i class="fas fa-question-circle me-2 fa-fw fa-sm text-trial-light"></i>Trial Enrolments</th>
                                    </tr>
                                    <tr class="small">
                                        <th></th>
                                        <th>Student</th>
                                        <th>Start Date</th>
                                        <th>Drop Date</th>
                                    </tr>
                                    <tr dmx-repeat:rp_trial_enrols_class_details="dd_classdetails.data.details.enrolments.trial_enrols" class="light-grey-hover">
                                        <td class="tc_td_min">
                                            <div class="dropdown no-caret">
                                                <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown" class="btn dropdown-toggle no-caret btn-sm btn-outline-light" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v text-muted"></i></button>
                                                <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                    <a class="dropdown-item border-bottom bg-primary text-white" href="#">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-stars"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                Upgrade to Active
                                                            </div>
                                                        </div>
                                                    </a>

                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-pencil"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Edit Enrolment</p>
                                                            </div>
                                                        </div>

                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-arrow-down-circle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Drop Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-shuffle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                Transfer Enrolment
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+family" dmx-hide="family == '' || family == null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-people"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Go to Family<i class="bi-box-arrow-up-right ms-2 small"></i></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- <button id="btn_trEnr_details" dmx-bind:id="btn_trEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                                                                                                                            dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap"></i></button>
                                                                                                                                                                        <button id="btn_trEnr_drop" dmx-bind:id="btn_trEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down"></i></button>
                                                                                                                                                                        <button id="btn_trEnr_transfer" dmx-bind:id="btn_trEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random"></i></button> -->
                                        </td>
                                        <td dmx-html="'<i class=&quot;fas fa-question-circle me-2 text-trial-light&quot;></i>'+firstName +' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                        <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" dmx-class:fw-bold="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" dmx-class:fst-italic="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" class="align-middle"></td>
                                        <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                    </tr>
                                </tbody>
                                <tbody dmx-hide="dd_classdetails.data.details.enrolments.makeup_enrols.length == 0">
                                    <tr>
                                        <th colspan="4" class="text-makeup py-2"><i class="fas fa-arrow-alt-circle-up me-2 fa-fw fa-sm text-makeup-light"></i>Makeup Enrolments</th>
                                    </tr>
                                    <tr class="small">
                                        <th></th>
                                        <th>Student</th>
                                        <th>Start Date</th>
                                        <th>Drop Date</th>
                                    </tr>
                                    <tr dmx-repeat:rp_makeup_enrols_class_details="dd_classdetails.data.details.enrolments.makeup_enrols" class="light-grey-hover">
                                        <td class=" tc_td_min align-middle">
                                            <div class="dropdown no-caret">
                                                <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown3" class="btn dropdown-toggle no-caret btn-sm btn-outline-light" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v text-muted"></i></button>
                                                <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-pencil"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Edit Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-arrow-down-circle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Drop Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-shuffle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                Transfer Enrolment
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+family" dmx-hide="family == '' || family == null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-people"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Go to Family<i class="bi-box-arrow-up-right ms-2 small"></i></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- <button id="btn_muEnr_details" dmx-bind:id="btn_muEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                                                                                                                        dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap fa-fw"></i></button>
                                                                                                                                                                    <button id="btn_muEnr_drop" dmx-bind:id="btn_muEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down fa-fw"></i></button>
                                                                                                                                                                    <button id="btn_muEnr_transfer" dmx-bind:id="btn_muEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random fa-fw"></i></button> -->
                                        </td>
                                        <td dmx-html="'<i class=&quot;fas fa-arrow-alt-circle-up me-2 fa-fw fa-sm text-makeup-light&quot;></i>'+firstName+' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                        <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" dmx-class:fw-bold="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" dmx-class:fst-italic="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" class=" align-middle"></td>
                                        <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                    </tr>
                                </tbody>
                                <tbody dmx-hide="dd_classdetails.data.details.enrolments.casual_enrols.length == 0">
                                    <tr>
                                        <th colspan="4" class="text-casual py-2"><i class="fas fa-bookmark me-2 fa-fw fa-sm text-casual-light"></i>Casual Enrolments</th>
                                    </tr>
                                    <tr class="small">
                                        <th></th>
                                        <th>Student</th>
                                        <th>Start Date</th>
                                        <th>Drop Date</th>
                                    </tr>
                                    <tr dmx-repeat:rp_casual_enrols_class_details="dd_classdetails.data.details.enrolments.casual_enrols" class="light-grey-hover">
                                        <td class=" tc_td_min align-middle">
                                            <div class="dropdown no-caret">
                                                <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown1" class="btn dropdown-toggle no-caret btn-sm btn-outline-light" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v text-muted"></i></button>
                                                <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-pencil"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Edit Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});dropEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-arrow-down-circle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Drop Enrolment</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});transferEnrolmentModal.show()" dmx-class:border-bottom="student.family != '' || student.family != null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-shuffle"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                Transfer Enrolment
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+family" dmx-hide="family == '' || family == null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-people"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Go to Family<i class="bi-box-arrow-up-right ms-2 small"></i></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- <button id="btn_waEnr_details" dmx-bind:id="btn_waEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                                                                                                                        dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap fa-fw"></i></button>
                                                                                                                                                                    <button id="btn_waEnr_drop" dmx-bind:id="btn_waEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down fa-fw"></i></button>
                                                                                                                                                                    <button id="btn_waEnr_transfer" dmx-bind:id="btn_waEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random fa-fw"></i></button> -->
                                        </td>
                                        <td class=" align-middle" style="padding-left: 20px !important;: ;" dmx-html="'<i class=&quot;fas fa-bookmark me-2 fa-fw fa-sm text-casual-light&quot;></i>'+firstName+' '+lastName"></td>
                                        <td dmx-text="startDate.toDate().formatDate('dd MMM yyyy')" dmx-class:fw-bold="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" dmx-class:fst-italic="(startDate.toTimestamp() > dr_endDate.value.toTimestamp())" class=" align-middle"></td>
                                        <td dmx-text="dropDate.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                    </tr>
                                </tbody>
                                <tbody dmx-hide="dd_classdetails.data.waitlists.length == 0">
                                    <tr>
                                        <th colspan="4" class="text-waitlist py-2"><i class="fas fa-history me-2 fa-fw fa-sm text-waitlist-light"></i>Waitlist Enrolments</th>
                                    </tr>
                                    <tr class="small">
                                        <th></th>
                                        <th>Student</th>
                                        <th>Start Date</th>
                                        <th>Drop Date</th>
                                    </tr>
                                    <tr dmx-repeat:rp_waitlist_class_details="dd_classdetails.data.waitlists" class="light-grey-hover">
                                        <td class=" tc_td_min align-middle">
                                            <div class="dropdown no-caret">
                                                <button dmx-bind:id="enrolmentDropdown_{{id}}" id="dropdown" class="btn dropdown-toggle no-caret btn-sm btn-outline-light" type="button" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v text-muted"></i></button>
                                                <div class="dropdown-menu shadow-light rounded-small" aria-labelledby="dropdown2">
                                                    <a class="dropdown-item border-bottom bg-primary text-white" href="#" dmx-on:click="run({condition:{if:`details.active == 0`,then:{steps:{'bootbox.confirm':{buttons:{confirm:{label:'OVERBOOK',className:'btn-danger'},cancel:{label:'Cancel'}},message:'There are no availabilities for this class in the future. Would you like to overbook this class?',title:'Overbook Warning',then:{steps:[{run:{action:`upgradeWaitlistModal.dd_uw_classDetails.select(var_classid.value)`}},{run:{action:`upgradeWaitlistModal.dd_uw_waitlistDetails.select(id)`}},{run:{action:`upgradeWaitlistModal.form_upgradeWaitlist.var_uw_details.setValue(details.active.formatDate(\'yyyy-MM-dd\')`}},{run:{action:`upgradeWaitlistModal.var_uw_studentDetailsObject.setValue($value)`}},{run:{action:`upgradeWaitlistModal.show()`}}]},name:'Overbooking'}}},else:{steps:[{run:{action:`upgradeWaitlistModal.dd_uw_classDetails.select(var_classid.value)`}},{run:{action:`upgradeWaitlistModal.dd_uw_waitlistDetails.select(id)`}},{run:{action:`upgradeWaitlistModal.form_upgradeWaitlist.var_uw_details.setValue(details.active.formatDate('yyyy-MM-dd'))`}},{run:{action:`upgradeWaitlistModal.var_uw_studentDetailsObject.setValue($value)`}},{run:{action:`upgradeWaitlistModal.show()`}}]}}})">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-stars"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                Upgrade to Active
                                                            </div>
                                                        </div>
                                                    </a><a class="dropdown-item border-bottom" href="javascript:void(0);" dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-pencil"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Edit Waitlist</p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item border-bottom" href="#" dmx-on:click="run({'bootbox.confirm':{buttons:{confirm:{label:'Delete Waitlist',className:'btn-danger'},cancel:{}},message:`\'Are you sure you want to delete \'+firstName +\' \'+lastName+\'\\\'s waitlist entry? Deleted waitlists are unrecoverable.\'`,title:'Are you sure?',then:{steps:{run:{action:`form_deleteWaitlist.submit()`}}}}})">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-slash-circle-fill text-danger"></i>
                                                            </div>
                                                            <div class="col-auto">

                                                                <p class="mb-0">Cancel Waitlist</p>
                                                                <form id="form_deleteWaitlist" is="dmx-serverconnect-form" action="/api/classes/waitlist/deleteWaitlist" method="post" dmx-on:success="run([{run:{action:`notifies1.success(\'Waitlist deleted.\')`}},{wait:{delay:500}},{run:{action:`classesBase.load()`}}])">
                                                                    <input id="inp_delWait_id" name="id" type="hidden" class="form-control" dmx-bind:value="id">
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <a class="dropdown-item" target="_blank" dmx-bind:href="'/families/familydetail/'+family" dmx-hide="family == '' || family == null">
                                                        <div class="row flex-nowrap">
                                                            <div class="col-1">
                                                                <i class="bi-people"></i>
                                                            </div>
                                                            <div class="col-auto">
                                                                <p class="mb-0">Go to Family<i class="bi-box-arrow-up-right ms-2 small"></i></p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- <button id="btn_waEnr_details" dmx-bind:id="btn_waEnr_details_{{id}}_{{$index}}" class="btn btn-light circle-button-small"
                                                                                                                                                                                                                                                                                                dmx-on:click="GET_ENROLMENT_single.load({enrolmentid: id});editEnrolmentModal.show()"><i class="fas fa-graduation-cap fa-fw"></i></button>
                                                                                                                                                                                                                                                                                            <button id="btn_waEnr_drop" dmx-bind:id="btn_waEnr_drop_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-arrow-alt-circle-down fa-fw"></i></button>
                                                                                                                                                                                                                                                                                            <button id="btn_waEnr_transfer" dmx-bind:id="btn_waEnr_transfer_{{id}}_{{$index}}" class="btn btn-light circle-button-small"><i class="fas fa-random fa-fw"></i></button> -->
                                        </td>
                                        <td dmx-text="firstName +' '+lastName" class=" align-middle" style="padding-left: 20px !important;: ;"></td>
                                        <td dmx-text="request_date.toDate().formatDate('dd MMM yyyy')" class=" align-middle"></td>
                                        <td dmx-text="notes" class=" align-middle"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row g-0" dmx-show="dd_classdetails.data.details.total===0">
                            <div class="col p-4 border rounded-3">
                                <h6 class="mb-0 text-danger fw-600 text-center">No enrolments found for this class.</h6>
                            </div>
                        </div>
                    </section>

                </div>
                <div class="modal-body light-blue-bg" dmx-show="var_classdetails_page.value==2">
                    <button id="btn_back" class="btn mb-3 btn-primary" dmx-on:click="var_classdetails_page.setValue(1)"><i class="far fa-arrow-alt-circle-left me-1 fa-sm fa-fw"></i>Go Back</button>
                    <dmx-data-detail id="dd_classdetails_searchenrol" dmx-bind:data="classesBase.data.nextavail.classes" key="uuid">
                        <dmx-value id="var_enroltype" dmx-bind:value="active_enroltype_toggle.checked ? 'active' : waitlist_enroltype_toggle.checked ? 'waitlist' : trial_enroltype_toggle.checked ? 'trial' : makeup_enroltype_toggle.checked ? 'makeup' : 'casual'"></dmx-value>
                    </dmx-data-detail>

                    <section>

                        <div class="row g-0 mb-3 p-3 bg-white rounded-3 pdl-surface-shadow">
                            <div class="col">

                                <h6>Enrolment Details</h6>
                                <div class="row mb-1 pb-2 border-bottom g-0">
                                    <div class="col d-flex justify-content-start">
                                        <input type="radio" class="btn-check" name="radio_enrolsearch_enroltype" id="active_enroltype_toggle" autocomplete="off" checked dmx-bind:checked="dd_classdetails_searchenrol.var_enroltype.value === 'active'" value="active">
                                        <label class="btn btn-sm me-2 btn-active-outline" for="active_enroltype_toggle" dmx-on:click="dd_classdetails_searchenrol.var_enroltype.setValue('active')">Active Enrolment</label>

                                        <input type="radio" class="btn-check" name="radio_enrolsearch_enroltype" id="trial_enroltype_toggle" autocomplete="off" checked dmx-bind:checked="dd_classdetails_searchenrol.var_enroltype.value === 'trial'" value="trial">
                                        <label class="btn btn-sm me-2 btn-trial-outline" for="trial_enroltype_toggle" dmx-on:click="dd_classdetails_searchenrol.var_enroltype.setValue('trial')">Trial Enrolment</label>

                                        <input type="radio" class="btn-check" name="radio_enrolsearch_enroltype" id="makeup_enroltype_toggle" autocomplete="off" dmx-bind:checked="dd_classdetails_searchenrol.var_enroltype.value === 'makeup'" value="makeup" dmx-bind:disabled="dd_classdetails_searchenrol.data.details.makeup_response.code === 101 || dd_classdetails_searchenrol.data.details.makeup_response.code === 102">
                                        <label class="btn btn-sm me-2 btn-makeup-outline" for="makeup_enroltype_toggle" dmx-on:click="dd_classdetails_searchenrol.var_enroltype.setValue('makeup')">Makeup</label>

                                        <input type="radio" class="btn-check" name="radio_enrolsearch_enroltype" id="casual_enroltype_toggle" autocomplete="off" dmx-bind:checked="dd_classdetails_searchenrol.var_enroltype.value === 'casual'" value="casual" dmx-bind:disabled="dd_classdetails_searchenrol.data.details.makeup_response.code === 101 || dd_classdetails_searchenrol.data.details.makeup_response.code === 102">
                                        <label class="btn btn-sm me-2 btn-casual-outline" for="casual_enroltype_toggle" dmx-on:click="dd_classdetails_searchenrol.var_enroltype.setValue('casual')">Casual</label>

                                        <input type="radio" class="btn-check" name="radio_enrolsearch_enroltype" id="waitlist_enroltype_toggle" autocomplete="off" dmx-bind:checked="dd_classdetails_searchenrol.var_enroltype.value === 'waitlist'" value="waitlist">
                                        <label class="btn btn-sm me-2 btn-outline-dark" for="waitlist_enroltype_toggle" dmx-on:click="dd_classdetails_searchenrol.var_enroltype.setValue('waitlist')">Waitlist</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <dmx-value id="var_newenrol_startdate"></dmx-value>
                                        <label for="inp_searchModal" class="col-form-label">Start Date</label>
                                        <input id="inp_newEnrolStartDate" class="form-control" is="dmx-date-picker" placeholder="dd/mm/yyyy" onkeydown="return false" format="Do MMM YYYY" dmx-bind:mindate="dateAndTime_days.datetime.addDays(-7)" step="7" dmx-bind:value="var_newenrol_startdate.value||dateAndTime_days.datetime.formatDate('yyyy-MM-dd')" dmx-bind:maxdate="(appSettings.enrol_availability_end_of_week==1)? dateAndTime_days.datetime.addWeeks(appSettings.enrol_availability_max_weeks.toNumber()).addDays((7 - dateAndTime_days.datetime.getDay() - 1)).formatDate('yyyy-MM-dd') : dateAndTime_days.datetime.addWeeks(appSettings.enrol_availability_max_weeks.toNumber()).formatDate('yyyy-MM-dd')">
                                        <p class="mb-0 mt-1 small fw-600 text-danger"><i class="fas fa-exclamation-triangle me-1 fa-fw fa-sm"></i>Always double check your start date.</p>
                                    </div>
                                    <div class="col">
                                        <label for="inp_searchModal" class="col-form-label float-start">Drop Date</label>
                                        <p class="small text-danger float-start ms-3 mb-0 clickable user-select-none" style="padding-top: calc(.375rem + 1px); padding-bottom: calc(.375rem + 1px);" dmx-on:click="inp_newEnrolDropDate.setValue(null)" dmx-hide="!inp_newEnrolDropDate.value"><i class="far fa-times-circle fa-xs me-1"></i>Clear</p>
                                        <input id="inp_newEnrolDropDate" class="form-control mb-1" is="dmx-date-picker" placeholder="dd/mm/yyyy" onkeydown="return false" format="Do MMM YYYY" dmx-bind:mindate="inp_newEnrolStartDate.value" step="7">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-0 mb-3 p-3 bg-white rounded-3 pdl-surface-shadow">
                            <div class="col">
                                <div class="row">
                                    <div class="col-12">
                                        <h6>Family Search</h6>
                                        <div class="input-group">

                                            <span class="input-group-text bg-info text-white border-0"><i class="fas fa-search"></i></span>
                                            <input id="inp_searchModal" name="inp_searchModal" type="text" class="form-control" style="" dmx-bind:value="var_fulltextConvert.value" autocomplete="off" dmx-on:updated.debounce:500="run([{runJS:{function:'fulltextConvert',args:[`value`],name:'fullTextConvert'}},{run:{action:`queryManager.set(\'searchtextfilter\',fullTextConvert);searchAll_ResultsModal.var_fulltextConvert.setValue(value)`}},{wait:{delay:200}},{run:{action:`GET_FAMILIES_STUDENTS_FT_search.load({searchtextfilter: query.searchtextfilter})`}}])" placeholder="Search for families or students">

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </section>
                    <section class="mb-3 p-3 bg-white rounded-3 pdl-surface-shadow" dmx-show="GET_FAMILIES_STUDENTS_FT_search.data.studentsAndFamilies.length > 0">
                        <div class="row row-cols-1 gx-0" id="rp_families" is="dmx-repeat" dmx-bind:repeat="GET_FAMILIES_STUDENTS_FT_search.data.studentsAndFamilies">
                            <div class="col mb-3 ">
                                <div class="row gx-0">

                                    <div class="col">
                                        <div class="row gx-2">

                                            <div class="col-auto align-self-stretch d-flex"><a href="#" class="btn btn-outline-light text-body rounded-1 d-flex align-items-center" dmx-bs-tooltip="'Go to Family'" data-bs-trigger="hover" data-bs-placement="top" dmx-bind:href="'/families/familydetail/'+family" target="_blank">
                                                    <i class="fas fa-users"></i>
                                                </a></div>
                                            <div class="col d-flex flex-column align-items-start justify-content-center">
                                                <h5 class="mb-0" dmx-text="(primaryGuardian) ? primaryGuardian.firstName+' '+primaryGuardian.lastName : 'No primary guardian found.'">Jane Doe</h5>
                                                <p class="mb-0 mt-1 small text-muted" style="">{{guardians.values(`' ' + firstName +' '+lastName`)}}</p>



                                            </div>

                                        </div>
                                        <div class="row mt-2 g-0">
                                            <div class="col">
                                                <table class="table small align-middle table-bordered">
                                                    <thead class="fw-bold border-bottom">
                                                        <tr>
                                                            <th scope="row" class="collapse-cell"></th>
                                                            <th>Student</th>
                                                            <th>Level</th>
                                                            <th>Gender</th>
                                                            <th>Dob</th>
                                                            <th>Age</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="students" id="tb_es_repeatStudents">
                                                        <tr>
                                                            <td class="collapse-cell">

                                                                <dmx-serverconnect id="sc_checkenrolexists" url="/api/classes/enrolments/CHECK_ENROLMENT_exists" dmx-param:enrolmenttype="1" dmx-param:student_uuid="uuid" dmx-param:startdate="2022-03-23" dmx-param:class_uuid="dd_classdetails_searchenrol.data.uuid" dmx-param:family_uuid="family" noload=""></dmx-serverconnect>
                                                                <button id="addActive" class="btn btn-sm btn-active-outline p-1 px-2" dmx-on:click="run([{serverConnect:{url:'/api/classes/enrolments/CHECK_ENROLMENT_exists',site:'SSA-CRM',params:{student_uuid:`uuid`,class_uuid:`dd_classdetails_searchenrol.data.uuid`,student_firstname:`firstName`,student_lastname:`lastName`,startdate:`inp_newEnrolStartDate.value||dateAndTime_days.datetime.formatDate(\'yyyy-MM-dd\')`},name:'sc'}},{assign:{value:`false`,name:'var_book_anyway'}},{assign:{value:`false`,name:'var_enrolment_error'}},{condition:{if:`sc.data.exists===true`,then:{steps:[{runJS:{function:'swal_alert',args:['error','Enrolment Conflict',`sc.data.html_response`,'']}},{assign:{value:`true`,name:'var_enrolment_error'}}]}}},{condition:{if:`var_enrolment_error===false`,then:{steps:[{run:{action:`newEnrolmentModal.var_classDetailsObject.setValue(dd_classdetails_searchenrol.data);newEnrolmentModal.createEnrolmentForm.inp_ne_startDate.setValue(inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'))`}},{run:{action:`newEnrolmentModal.var_ne_enrolType.setValue(1);newEnrolmentModal.createEnrolmentForm.inp_hd_ne_dummyenrol_json.setValue([&quot;classday&quot;,dd_classdetails_searchenrol.data.classday ,&quot;classType&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;classtype_uuid&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;baseRate&quot;, dd_classdetails_searchenrol.data.baseRate,&quot;shortName&quot;,dd_classdetails_searchenrol.data.shortName,&quot;firstName&quot;, firstName,&quot;lastName&quot;, lastName,&quot;instructor_uuid&quot;, dd_classdetails_searchenrol.data.instructor_uuid,&quot;classlevel_uuid&quot;, dd_classdetails_searchenrol.data.classlevel_uuid,&quot;startTimeDisplay&quot;,dd_classdetails_searchenrol.data.startTimeDisplay,&quot;enrolmentType&quot;, 1,&quot;dropDate&quot;, inp_newEnrolDropDate.value.formatDate(\'yyyy-MM-dd\'),&quot;isValid&quot;, 1,&quot;startDate&quot;, inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'),&quot;student_uuid&quot;, uuid,&quot;class_uuid&quot;, dd_classdetails_searchenrol.data.uuid,&quot;uuid&quot;,\'dummy\'].objectFromArray().jsonStringify())`}},{run:{action:`newEnrolmentModal.sc_quote.load({enrolmentType: 1, student_uuid: uuid, class_uuid: dd_classdetails_searchenrol.data.uuid, family_uuid: family, enabledummyenrol: 1, dummyenroljson: [&quot;classday&quot;,dd_classdetails_searchenrol.data.classday ,&quot;classType&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;classtype_uuid&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;baseRate&quot;, dd_classdetails_searchenrol.data.baseRate,&quot;shortName&quot;,dd_classdetails_searchenrol.data.shortName,&quot;firstName&quot;, firstName,&quot;lastName&quot;, lastName,&quot;instructor_uuid&quot;, dd_classdetails_searchenrol.data.instructor_uuid,&quot;classlevel_uuid&quot;, dd_classdetails_searchenrol.data.classlevel_uuid,&quot;startTimeDisplay&quot;,dd_classdetails_searchenrol.data.startTimeDisplay,&quot;enrolmentType&quot;, 1,&quot;dropDate&quot;, inp_newEnrolDropDate.value.formatDate(\'yyyy-MM-dd\'),&quot;isValid&quot;, 1,&quot;startDate&quot;, inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'),&quot;student_uuid&quot;, uuid,&quot;class_uuid&quot;, dd_classdetails_searchenrol.data.uuid,&quot;uuid&quot;,\'dummy\'].objectFromArray().jsonStringify(), startdate: inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'), dropDate: inp_newEnrolDropDate.value.formatDate(\'yyyy-MM-dd\')})`}},{wait:{delay:200}},{run:{action:`newEnrolmentModal.var_studentDetailsObject.setValue($value);newEnrolmentModal.var_tuitionquote.setValue(sc_quote.data.exec_tuitioncalc.repeat)`}},{run:{action:`hide()`}},{run:{action:`newEnrolmentModal.show()`}}]}}}])" dmx-show="dd_classdetails_searchenrol.var_enroltype.value === 'active'"><i class="fas fa-user-plus fa-sm me-1 fa-fw"></i>Add

                                                                </button>

                                                                <button id="addTrial" class="btn btn-sm btn-trial-outline p-1 px-2" dmx-on:click="run([{serverConnect:{url:'/api/classes/enrolments/CHECK_ENROLMENT_exists',site:'SSA-CRM',params:{student_uuid:`uuid`,class_uuid:`dd_classdetails_searchenrol.data.uuid`,student_firstname:`firstName`,student_lastname:`lastName`,startdate:`inp_newEnrolStartDate.value||dateAndTime_days.datetime.formatDate(\'yyyy-MM-dd\')`},name:'sc'}},{assign:{value:`false`,name:'var_book_anyway'}},{assign:{value:`false`,name:'var_enrolment_error'}},{condition:{if:`sc.data.exists===true`,then:{steps:[{runJS:{function:'swal_alert',args:['error','Enrolment Conflict',`sc.data.html_response`,'']}},{assign:{value:`true`,name:'var_enrolment_error'}}]}}},{condition:{if:`var_enrolment_error===false`,then:{steps:[{run:{action:`newEnrolmentModal.var_classDetailsObject.setValue(dd_classdetails_searchenrol.data);newEnrolmentModal.createEnrolmentForm.inp_ne_startDate.setValue(inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'))`}},{run:{action:`newEnrolmentModal.var_ne_enrolType.setValue(3);newEnrolmentModal.createEnrolmentForm.inp_hd_ne_dummyenrol_json.setValue([&quot;classday&quot;,dd_classdetails_searchenrol.data.classday ,&quot;classType&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;classtype_uuid&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;baseRate&quot;, dd_classdetails_searchenrol.data.baseRate,&quot;shortName&quot;,dd_classdetails_searchenrol.data.shortName,&quot;firstName&quot;, firstName,&quot;lastName&quot;, lastName,&quot;instructor_uuid&quot;, dd_classdetails_searchenrol.data.instructor_uuid,&quot;classlevel_uuid&quot;, dd_classdetails_searchenrol.data.classlevel_uuid,&quot;startTimeDisplay&quot;,dd_classdetails_searchenrol.data.startTimeDisplay,&quot;enrolmentType&quot;, 3,&quot;dropDate&quot;, inp_newEnrolDropDate.value.formatDate(\'yyyy-MM-dd\'),&quot;isValid&quot;, 1,&quot;startDate&quot;, inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'),&quot;student_uuid&quot;, uuid,&quot;class_uuid&quot;, dd_classdetails_searchenrol.data.uuid,&quot;uuid&quot;,\'dummy\'].objectFromArray().jsonStringify())`}},{run:{action:`newEnrolmentModal.sc_quote.load({enrolmentType: 1, student_uuid: uuid, class_uuid: dd_classdetails_searchenrol.data.uuid, family_uuid: family, enabledummyenrol: 1, dummyenroljson: [&quot;classday&quot;,dd_classdetails_searchenrol.data.classday ,&quot;classType&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;classtype_uuid&quot;, dd_classdetails_searchenrol.data.classtype_uuid,&quot;baseRate&quot;, dd_classdetails_searchenrol.data.baseRate,&quot;shortName&quot;,dd_classdetails_searchenrol.data.shortName,&quot;firstName&quot;, firstName,&quot;lastName&quot;, lastName,&quot;instructor_uuid&quot;, dd_classdetails_searchenrol.data.instructor_uuid,&quot;classlevel_uuid&quot;, dd_classdetails_searchenrol.data.classlevel_uuid,&quot;startTimeDisplay&quot;,dd_classdetails_searchenrol.data.startTimeDisplay,&quot;enrolmentType&quot;, 3,&quot;dropDate&quot;, inp_newEnrolDropDate.value.formatDate(\'yyyy-MM-dd\'),&quot;isValid&quot;, 1,&quot;startDate&quot;, inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'),&quot;student_uuid&quot;, uuid,&quot;class_uuid&quot;, dd_classdetails_searchenrol.data.uuid,&quot;uuid&quot;,\'dummy\'].objectFromArray().jsonStringify(), startdate: inp_newEnrolStartDate.value.formatDate(\'yyyy-MM-dd\'), dropDate: inp_newEnrolDropDate.value.formatDate(\'yyyy-MM-dd\')})`}},{wait:{delay:200}},{run:{action:`newEnrolmentModal.var_studentDetailsObject.setValue($value);newEnrolmentModal.var_tuitionquote.setValue(sc_quote.data.exec_tuitioncalc.repeat)`}},{run:{action:`hide()`}},{run:{action:`newEnrolmentModal.show()`}}]}}}])" dmx-show="dd_classdetails_searchenrol.var_enroltype.value=='trial'"><i class="fas fa-question-circle fa-sm me-1 fa-fw"></i>Add
                                                                </button>
                                                                <button id="addMakeup" class="btn btn-sm btn-makeup-outline p-1 px-2" dmx-on:click="run([{run:{action:`newEnrolmentModal.createEnrolmentForm.inp_ne_startDate.setValue(dd_classdetails_searchenrol.data.details.makeup[0].date.formatDate(\'yyyy-MM-dd\'));newEnrolmentModal.createEnrolmentForm.inp_ne_dropDate.setValue(dd_classdetails_searchenrol.data.details.makeup[0].date.formatDate(\'yyyy-MM-dd\'))`}},{run:{action:`newEnrolmentModal.var_studentDetailsObject.setValue($value);newEnrolmentModal.var_classDetailsObject.setValue(dd_classdetails_searchenrol.data);newEnrolmentModal.var_ne_enrolType.setValue(2)`}},{run:{action:`hide();newEnrolmentModal.show()`}}])" dmx-show="dd_classdetails_searchenrol.var_enroltype.value === 'makeup'"><i class="fas fa-arrow-alt-circle-up fa-sm me-1 fa-fw"></i>Add
                                                                </button><button id="addCasual" class="btn btn-sm btn-casual-outline p-1 px-2" dmx-on:click="run([{run:{action:`newEnrolmentModal.createEnrolmentForm.inp_ne_startDate.setValue(dd_classdetails_searchenrol.data.details.makeup[0].date.formatDate(\'yyyy-MM-dd\'));newEnrolmentModal.createEnrolmentForm.inp_ne_dropDate.setValue(dd_classdetails_searchenrol.data.details.makeup[0].date.formatDate(\'yyyy-MM-dd\'))`}},{run:{action:`newEnrolmentModal.var_studentDetailsObject.setValue($value);newEnrolmentModal.var_classDetailsObject.setValue(dd_classdetails_searchenrol.data);newEnrolmentModal.var_ne_enrolType.setValue(5)`}},{run:{action:`hide();newEnrolmentModal.show()`}}])" dmx-show="dd_classdetails_searchenrol.var_enroltype.value === 'casual'"><i class="fas fa-bookmark fa-sm me-1 fa-fw"></i>Add
                                                                </button><button id="addWaitlist" class="btn btn-sm btn-waitlist-outline p-1 px-2" dmx-on:click="run([{run:{action:`hide()`}},{run:{action:`newWaitlistModal.var_wl_classDetailsObject.setValue(dd_classdetails_searchenrol.data);newWaitlistModal.var_wl_studentDetailsObject.setValue($value)`}},{run:{action:`newWaitlistModal.show()`}}])" dmx-show="dd_classdetails_searchenrol.var_enroltype.value === 'waitlist'"><i class="fas fa-history fa-sm me-1 fa-fw"></i>Add
                                                                </button>



                                                            </td>
                                                            <td dmx-text="firstName +' '+lastName">Jane Doe</td>
                                                            <td dmx-text="level">Ducklings</td>
                                                            <td dmx-text="gender">Female</td>
                                                            <td dmx-text="dob.formatDate('dd-MM-yyyy')">13-12-2019</td>
                                                            <td dmx-text="age">1y 11m</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>



                                    </div>
                                </div>
                            </div>

                        </div>
                    </section>
                </div>
                <div class="modal-footer border-top">
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
</div>