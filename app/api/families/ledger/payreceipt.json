{
  "meta": {
    "$_GET": [
      {
        "type": "number",
        "name": "paymentid"
      },
      {
        "type": "text",
        "name": "familyname"
      },
      {
        "type": "number",
        "name": "paymenttotal"
      },
      {
        "type": "array",
        "name": "record",
        "sub": [
          {
            "type": "text",
            "name": "studentname"
          },
          {
            "type": "text",
            "name": "classname"
          },
          {
            "type": "date",
            "name": "classdate"
          },
          {
            "type": "number",
            "name": "lineremaining"
          },
          {
            "type": "number",
            "name": "linepaid"
          },
          {
            "type": "number",
            "name": "id"
          }
        ]
      },
      {
        "type": "date",
        "name": "paymentdate"
      },
      {
        "type": "text",
        "name": "paymenttype"
      },
      {
        "type": "text",
        "name": "reference"
      },
      {
        "type": "text",
        "name": "notes"
      },
      {
        "type": "text",
        "name": "paymenttitle"
      },
      {
        "type": "text",
        "name": "host"
      }
    ]
  },
  "exec": {
    "steps": [
      {
        "name": "host",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{$_GET.host}}"
        }
      },
      {
        "name": "outputfolder",
        "module": "core",
        "action": "setvalue",
        "options": {
          "key": "outputfolder",
          "value": "public/assets/pdf"
        }
      },
      {
        "name": "styles",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "\n<link rel=\"stylesheet\" href=\"/bootstrap/5/css/bootstrap.min.css\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css\" integrity=\"sha384-NUDU7Qr8dfscXBIhA0px/bRl3cgNrOT9l/WPm15DzH5xnBs4fL4vgRiXURs98/ID\" crossorigin=\"anonymous\">"
        }
      },
      {
        "name": "paymentdetails",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "<div class=\"row\">\n    <div class=\"col\">\n      <h4 class=\"fw-bold mb-4\">Payment Details</h4>\n    </div>\n</div>\n<div class=\"row row-cols-1\" id=\"payment\">\n<div class=\"col\">\n    <div class=\"row\">\n    <div class=\"col pb-3 mb-3 border-bottom\">\n        <div class=\"mb-3 row\">\n        <label for=\"inp_title\" class=\"col-sm-2\">Title:</label>\n        <div class=\"col-sm-4 align-self-center\">\n            <p class=\"mb-0\">{{$_GET.paymenttitle}}</p>\n        </div>\n        </div>\n        <div class=\"mb-3 row\">\n        <label for=\"inp_paymentdateDisplay\" class=\"col-sm-2\">Payment Date:</label>\n        <div class=\"col-sm-3 align-self-center\">\n            <p class=\"mb-0\">{{$_GET.paymentdate)}}</p>\n        </div>\n        </div>\n        <div class=\"mb-3 row\">\n        <label for=\"inp_amount\" class=\"col-sm-2\">Amount:</label>\n        <div class=\"col-sm-2\">\n            <p class=\"mb-0\">{{$_GET.paymenttotal}}</p>\n        </div>\n        </div>\n        <div class=\"mb-3 row\">\n        <label for=\"inp_paymentType\" class=\"col-sm-2\"> Payment type:</label>\n\n        <div class=\"col-sm-3\">\n            <p class=\"mb-0\">{{$_GET.paymenttype}}</p>\n\n        </div>\n        </div>\n        <div class=\"mb-3 row\">\n        <label for=\"inp_payref\" class=\"col-sm-2\">Reference:</label>\n        <div class=\"col-sm-10\">\n            <p class=\"mb-0\">{{$_GET.reference || 'N/A'}}</p>\n\n        </div>\n        </div>\n        <div class=\"mb-3 row\">\n        <label for=\"inp_notes\" class=\"col-sm-2\">Notes:</label>\n        <div class=\"col-sm-10\">\n            <p class=\"mb-0\">{{$_GET.notes || 'N/A'}}</p>\n        </div>\n        </div>\n\n    </div>\n    </div>\n</div>\n</div>"
        }
      },
      {
        "name": "tablehead",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "<table class=\"table table-bordered\">\n<thead class=\"small table-light align-middle lh-1\">\n<tr>\n<th>Id</th>\n<th>Class date</th>\n<th>Class Details</th>\n<th>Student</th>\n<th>Paid</th>\n<th>Remaining balance</th>\n</tr>\n</thead>\n<tbody>"
        }
      },
      {
        "name": "tablerow",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{null}}",
          "key": "tablerow"
        }
      },
      {
        "name": "repeat",
        "module": "core",
        "action": "repeat",
        "options": {
          "repeat": "{{$_GET.record}}",
          "outputFields": [],
          "exec": {
            "steps": {
              "name": "tablerow",
              "module": "core",
              "action": "setvalue",
              "options": {
                "value": "<tr><td>{{id}}\n  </td>\n  <td>\n    {{classdate}}\n  </td>\n  <td>\n    {{classname}}\n  </td>\n  <td>\n    {{studentname}}\n  </td>\n  <td>\n    {{linepaid}}\n  </td>\n  <td>\n    {{lineremaining}}\n  </td>\n</tr>",
                "key": "tablerow"
              }
            }
          }
        },
        "meta": [
          {
            "name": "$index",
            "type": "number"
          },
          {
            "name": "$number",
            "type": "number"
          },
          {
            "name": "$name",
            "type": "text"
          },
          {
            "name": "$value",
            "type": "object"
          },
          {
            "name": "studentname",
            "type": "text"
          },
          {
            "name": "classname",
            "type": "text"
          },
          {
            "name": "classdate",
            "type": "date"
          },
          {
            "name": "lineremaining",
            "type": "number"
          },
          {
            "name": "linepaid",
            "type": "number"
          },
          {
            "name": "id",
            "type": "number"
          }
        ],
        "outputType": "array"
      },
      {
        "name": "table_row_repeat",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{tablerow}}"
        }
      },
      {
        "name": "tablefoot",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "</tbody>\n</table>"
        }
      },
      {
        "name": "studentTable",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{tablehead+tablerow+table_row_repeat+tablefoot}}"
        }
      },
      {
        "name": "paymentreceipt",
        "module": "HtmlToPDF",
        "action": "ConvertToPDF",
        "options": {
          "folderName": "{{outputfolder}}",
          "fileName": "{{$_GET.paymentdate.formatDate('yyyyMMdd')+'_'+$_GET.familyname}}",
          "orientation": "P",
          "headerMargin": 98,
          "bodyHTML": "{{styles+paymentdetails+studentTable}}",
          "bodyMarginLeft": 10,
          "bodyMarginTop": 10,
          "bodyMarginRight": 10,
          "bodyMarginBottom": 10
        },
        "meta": [
          {
            "name": "FileName",
            "type": "text"
          },
          {
            "name": "FilePath",
            "type": "text"
          }
        ],
        "output": true
      }
    ]
  }
}