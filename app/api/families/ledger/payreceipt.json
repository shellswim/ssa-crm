{
  "meta": {
    "$_GET": [
      {
        "type": "number",
        "name": "paymentid"
      },
      {
        "type": "text",
        "name": "familyname"
      },
      {
        "type": "number",
        "name": "paymenttotal"
      },
      {
        "type": "array",
        "name": "record",
        "sub": [
          {
            "type": "text",
            "name": "studentname"
          },
          {
            "type": "text",
            "name": "classname"
          },
          {
            "type": "date",
            "name": "classdate"
          },
          {
            "type": "number",
            "name": "lineremaining"
          },
          {
            "type": "number",
            "name": "linepaid"
          },
          {
            "type": "number",
            "name": "id"
          }
        ]
      },
      {
        "type": "date",
        "name": "paymentdate"
      },
      {
        "type": "text",
        "name": "paymenttype"
      },
      {
        "type": "text",
        "name": "reference"
      },
      {
        "type": "text",
        "name": "notes"
      },
      {
        "type": "text",
        "name": "paymenttitle"
      },
      {
        "type": "text",
        "name": "host"
      }
    ]
  },
  "exec": {
    "steps": [
      {
        "name": "",
        "module": "core",
        "action": "condition",
        "options": {
          "if": "{{$_GET.host.contains('localhost')}}",
          "then": {
            "steps": {
              "name": "host",
              "module": "core",
              "action": "setvalue",
              "options": {
                "value": "http://5dbd3e3d50fc:3000",
                "key": "host"
              },
              "meta": [],
              "outputType": "text"
            }
          },
          "else": {
            "steps": {
              "name": "host",
              "module": "core",
              "action": "setvalue",
              "options": {
                "value": "{{$_GET.host}}",
                "key": "host"
              },
              "meta": [],
              "outputType": "text"
            }
          }
        },
        "outputType": "boolean"
      },
      {
        "name": "outputfolder",
        "module": "core",
        "action": "setvalue",
        "options": {
          "key": "outputfolder",
          "value": "public/assets/pdf"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "styles",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "<link href=\"{{host}}/bootstrap/5/css/bootstrap.min.css\" rel=\"stylesheet\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css\" integrity=\"sha384-NUDU7Qr8dfscXBIhA0px/bRl3cgNrOT9l/WPm15DzH5xnBs4fL4vgRiXURs98/ID\" crossorigin=\"anonymous\">\n<link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n<link href=\"https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap\" rel=\"stylesheet\">",
          "key": "styles"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "paymentdetails",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "<div class=\"row mb-4 pb-5 border-bottom\">\n\t<div class=\"col\">\n\t\t<img src=\"{{host}}/assets/images/businesslogo.png\" style=\"width: 180px;\">\n\t</div>\n    <div class=\"col d-flex align-items-end justify-content-end\">\n      <h2 class=\"fw-bold\"><i class=\"bi-check2-circle me-2 text-success\"></i>Payment Reciept</h2>\n    </div>\n</div>\n<div class=\"row row-cols-1 mb-3 pb-3 border-bottom\" id=\"payment\">\n<div class=\"col-auto\">\n    <div class=\"row\">\n    <div class=\"col pb-3 mb-3 small\">\n        <div class=\"mb-1 row\">\n        <label for=\"inp_title\" class=\"col fw-bold\">Title:</label>\n        <div class=\"col-auto align-self-center\">\n            <p class=\"mb-0\">{{$_GET.paymenttitle}}Â </p>\n        </div>\n        </div>\n        <div class=\"mb-1 row\">\n        <label for=\"inp_paymentdateDisplay\" class=\"col fw-bold\">Payment Date:</label>\n        <div class=\"col-auto align-self-center\">\n            <p class=\"mb-0\">{{$_GET.paymentdate}}</p>\n        </div>\n        </div>\n        <div class=\"mb-1 row\">\n        <label for=\"inp_amount\" class=\"col fw-bold\">Amount:</label>\n        <div class=\"col-auto\">\n            <p class=\"mb-0\">{{$_GET.paymenttotal}}</p>\n        </div>\n        </div>\n        <div class=\"mb-1 row\">\n        <label for=\"inp_paymentType\" class=\"col fw-bold\"> Payment type:</label>\n\n        <div class=\"col-auto\">\n            <p class=\"mb-0\">{{$_GET.paymenttype}}</p>\n\n        </div>\n        </div>\n        <div class=\"mb-1 row\">\n        <label for=\"inp_payref\" class=\"col fw-bold\">Reference:</label>\n        <div class=\"col-auto\">\n            <p class=\"mb-0\">{{$_GET.reference || 'N/A'}}</p>\n\n        </div>\n        </div>\n        <div class=\"row\">\n        <label for=\"inp_notes\" class=\"col fw-bold\">Notes:</label>\n        <div class=\"col-auto\">\n            <p class=\"mb-0\">{{$_GET.notes || 'N/A'}}</p>\n        </div>\n        </div>\n\n    </div>\n    </div>\n</div>\n</div>",
          "key": "paymentdetails"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "tablehead",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "<h6>Classes paid:</h6>\n\t<div class=\"container-sm px-0 mx-0\">\n<table class=\"table small\">\n<thead class=\"small table-light align-middle lh-1\">\n<tr>\n<th>Id</th>\n<th>Class Date</th>\n<th>Class Details</th>\n<th>Student</th>\n<th>Paid</th>\n<th>Remaining</th>\n</tr>\n</thead>\n<tbody>",
          "key": "tablehead"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "tablerow",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{null}}",
          "key": "tablerow"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "repeat",
        "module": "core",
        "action": "repeat",
        "options": {
          "repeat": "{{$_GET.record}}",
          "outputFields": [],
          "exec": {
            "steps": {
              "name": "tablerow",
              "module": "core",
              "action": "setvalue",
              "options": {
                "value": "<tr><td>{{id}}\n  </td>\n  <td>\n    {{classdate}}\n  </td>\n  <td>\n    {{classname}}\n  </td>\n  <td>\n    {{studentname}}\n  </td>\n  <td>\n    {{linepaid}}\n  </td>\n  <td>\n    {{lineremaining}}\n  </td>\n</tr>",
                "key": "tablerow"
              },
              "meta": [],
              "outputType": "text"
            }
          }
        },
        "meta": [
          {
            "name": "$index",
            "type": "number"
          },
          {
            "name": "$number",
            "type": "number"
          },
          {
            "name": "$name",
            "type": "text"
          },
          {
            "name": "$value",
            "type": "object"
          },
          {
            "name": "studentname",
            "type": "text"
          },
          {
            "name": "classname",
            "type": "text"
          },
          {
            "name": "classdate",
            "type": "date"
          },
          {
            "name": "lineremaining",
            "type": "number"
          },
          {
            "name": "linepaid",
            "type": "number"
          },
          {
            "name": "id",
            "type": "number"
          }
        ],
        "outputType": "array"
      },
      {
        "name": "table_row_repeat",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{tablerow}}",
          "key": "table_row_repeat"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "tablefoot",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "</tbody>\n</table>\n</div>",
          "key": "tablefoot"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "studentTable",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{tablehead+table_row_repeat+tablefoot}}",
          "key": "studentTable"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "fullhtml",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{styles+paymentdetails+studentTable}}",
          "key": "fullhtml"
        },
        "meta": [],
        "outputType": "text"
      },
      {
        "name": "paymentreceipt",
        "module": "HtmlToPDF",
        "action": "ConvertToPDF",
        "options": {
          "folderName": "{{outputfolder}}",
          "fileName": "{{$_GET.paymentdate.formatDate('yyyyMMdd')+'_'+$_GET.familyname}}",
          "orientation": "P",
          "headerMargin": 98,
          "bodyHTML": "{{fullhtml}}",
          "bodyMarginLeft": 10,
          "bodyMarginTop": 10,
          "bodyMarginRight": 10,
          "bodyMarginBottom": 10
        },
        "meta": [
          {
            "name": "FileName",
            "type": "text"
          },
          {
            "name": "FilePath",
            "type": "text"
          }
        ],
        "output": true
      }
    ]
  }
}