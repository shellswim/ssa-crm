/*!
 DMXzone Download
 Version: 1.0.2
 (c) 2021 DMXzone.com
 @build 2021-02-12 16:05:31
 */
dmx.Component("download",{initialData:{progress:{position:0,total:0,percent:0},lastError:{status:0,message:""}},attributes:{timeout:{type:Number,default:0},url:{type:String,default:""},filename:{type:String,default:""}},methods:{abort:function(){this.abort()},download:function(t){this.download(t)}},events:{done:Event,error:Event,start:Event,progress:ProgressEvent},render:function(t){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.onload.bind(this)),this.xhr.addEventListener("abort",this.onabort.bind(this)),this.xhr.addEventListener("error",this.onerror.bind(this)),this.xhr.addEventListener("timeout",this.ontimeout.bind(this)),this.xhr.addEventListener("progress",this.onprogress.bind(this))},update:function(t){},abort:function(){this.xhr.abort()},download:function(t){if(this.url=t||this.props.url,this.xhr.abort(),this.trigger("start"),this.cors(this.url))this.xhr.open("GET",this.url),this.xhr.responseType="blob",this.xhr.send();else{var e=document.createElement("a");e.href=this.url,e.download=this.props.filename||this.url.replace(/.*\//,"").replace(/\?.*/,"")||"download",e.rel="noopener",e.target="_blank",e.dispatchEvent(new MouseEvent("click"))}},reset:function(){this.set({progress:{position:0,total:0,percent:0},error:{status:0,message:"",response:null}})},getFilename:function(){var t=this.xhr.getResponseHeader("Content-Disposition"),e=t&&t.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);return this.props.filename||!(!e||!e[1])&&e[1].replace(/['"]/g,"")||this.url.replace(/.*\//,"").replace(/\?.*/,"")||"download"},onload:function(){if(this.reset(),this.trigger("done"),200<=this.xhr.status&&this.xhr.status<300){var t=this.xhr.response,e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=this.getFilename(),e.rel="noopener",setTimeout(function(){URL.revokeObjectURL(e.href)},4e4),setTimeout(function(){e.dispatchEvent(new MouseEvent("click"))},0)}else this.set("error",{status:this.xhr.status,message:this.xhr.statusText}),this.trigger("error")},onabort:function(){this.reset(),this.trigger("done")},onerror:function(){this.reset(),this.set("error",{status:0,message:"Failed to download"}),this.trigger("error"),this.trigger("done")},ontimeout:function(){this.reset(),this.set("error",{status:0,message:"Download timeout"}),this.trigger("error"),this.trigger("done")},onprogress:function(t){var e=t.loaded||t.position,r=t.lengthComputable?Math.ceil(t.loaded/t.total*100):0;this.set("progress",{position:e,total:t.total,percent:r}),this.trigger("progress",{lengthComputable:t.lengthComputable,loaded:e,total:t.total})},cors:function(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&e.status<300},trigger:function(t,e){var r=this.dispatchEvent.bind(this);requestAnimationFrame(function(){r(t,e)})}});
//# sourceMappingURL=../maps/dmxDownload.js.map
